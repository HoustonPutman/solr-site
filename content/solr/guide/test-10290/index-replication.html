<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Index Replication | Apache Solr Reference Guide</title>

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-solr.css">
<link rel="stylesheet" href="css/ref-guide.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Apache Solr Reference Guide" href="https://home.apache.org/~ctargett/RefGuidePOC/jekyll-full/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // we do *NOT* want cookies used to save the current stage of the sidebar
                             // instead the code in sidebar.html will ensure that the current page
                             // (and it's ancestors) are "active" on page load
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="apache-solr-reference-guide.html">&nbsp;<span class="projectTitle"> Solr Ref Guide 7.0</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- Link to Solr website -->
                <li><a href="https://lucene.apache.org/solr/news" target="_blank">Solr News</a></li>
                <!-- Solr Resources dropdown -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solr Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                       <li><a href="https://lucene.apache.org/solr/7_0_0//solr-core/index.html" target="_blank">Solr Javadocs</a></li>
                       <li><a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git" target="_blank">Lucene/Solr Source Code</a></li>
                       <li><a href="https://lucene.apache.org/solr/resources.html#community" target="_blank">Solr Community Links</a></li>
                    </ul>
                </li>
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Index Replication">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div class="col-lg-12">&nbsp;</div>
  <!-- Content Row -->
  <div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
      

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Apache Solr Reference Guide <!-- TODO: version from site.data --></li>
  
  <li class="sb-level1">
    <a href="about-this-guide.html">About This Guide</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="getting-started.html">Getting Started</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="installing-solr.html">Installing Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr.html">Running Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-quick-overview.html">A Quick Overview</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-step-closer.html">A Step Closer</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-control-script-reference.html">Solr Control Script Reference</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-solr.html">Upgrading Solr</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="using-the-solr-administration-user-interface.html">Using the Solr Administration User Interface</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-the-solr-admin-ui.html">Overview of the Solr Admin UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="getting-assistance.html">Getting Assistance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="logging.html">Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cloud-screens.html">Cloud Screens</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collections-core-admin.html">Collections / Core Admin</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="java-properties.html">Java Properties</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="thread-dump.html">Thread Dump</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collection-specific-tools.html">Collection-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="analysis-screen.html">Analysis Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="dataimport-screen.html">Dataimport Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="documents-screen.html">Documents Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="files-screen.html">Files Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-screen.html">Query Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="stream-screen.html">Stream Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-browser-screen.html">Schema Browser Screen</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="core-specific-tools.html">Core-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="ping.html">Ping</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="plugins-stats-screen.html">Plugins &amp; Stats Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="replication-screen.html">Replication Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="segments-info.html">Segments Info</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="documents-fields-and-schema-design.html">Documents, Fields, and Schema Design</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-documents-fields-and-schema-design.html">Overview of Documents, Fields, and Schema Design</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-field-types.html">Solr Field Types</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="field-type-definitions-and-properties.html">Field Type Definitions and Properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-types-included-with-solr.html">Field Types Included with Solr</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-currencies-and-exchange-rates.html">Working with Currencies and Exchange Rates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-dates.html">Working with Dates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-enum-fields.html">Working with Enum Fields</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-external-files-and-processes.html">Working with External Files and Processes</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-properties-by-use-case.html">Field Properties by Use Case</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="defining-fields.html">Defining Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="copying-fields.html">Copying Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="dynamic-fields.html">Dynamic Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="other-schema-elements.html">Other Schema Elements</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schema-api.html">Schema API</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="putting-the-pieces-together.html">Putting the Pieces Together</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="docvalues.html">DocValues</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schemaless-mode.html">Schemaless Mode</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="understanding-analyzers-tokenizers-and-filters.html">Understanding Analyzers, Tokenizers, and Filters</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="analyzers.html">Analyzers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-tokenizers.html">About Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-filters.html">About Filters</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="tokenizers.html">Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="filter-descriptions.html">Filter Descriptions</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="charfilterfactories.html">CharFilterFactories</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="language-analysis.html">Language Analysis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="phonetic-matching.html">Phonetic Matching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-your-analyzer.html">Running Your Analyzer</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="indexing-and-basic-data-operations.html">Indexing and Basic Data Operations</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-solr-indexing.html">Introduction to Solr Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="post-tool.html">Post Tool</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-index-handlers.html">Uploading Data with Index Handlers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="transforming-and-indexing-custom-json.html">Transforming and Indexing Custom JSON</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-solr-cell-using-apache-tika.html">Uploading Data with Solr Cell using Apache Tika</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="updating-parts-of-documents.html">Updating Parts of Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="de-duplication.html">De-Duplication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="content-streams.html">Content Streams</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uima-integration.html">UIMA Integration</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="searching.html">Searching</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-searching-in-solr.html">Overview of Searching in Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="velocity-search-ui.html">Velocity Search UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="relevance.html">Relevance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-syntax-and-parsing.html">Query Syntax and Parsing</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="common-query-parameters.html">Common Query Parameters</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-standard-query-parser.html">The Standard Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-dismax-query-parser.html">The DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-extended-dismax-query-parser.html">The Extended DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="function-queries.html">Function Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="local-parameters-in-queries.html">Local Parameters in Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="other-parsers.html">Other Parsers</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="faceting.html">Faceting</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blockjoin-faceting.html">BlockJoin Faceting</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="highlighting.html">Highlighting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spell-checking.html">Spell Checking</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-re-ranking.html">Query Re-Ranking</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="learning-to-rank.html">Learning To Rank</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="transforming-result-documents.html">Transforming Result Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="suggester.html">Suggester</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="morelikethis.html">MoreLikeThis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="pagination-of-results.html">Pagination of Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collapse-and-expand-results.html">Collapse and Expand Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-grouping.html">Result Grouping</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-clustering.html">Result Clustering</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spatial-search.html">Spatial Search</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-terms-component.html">The Terms Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-term-vector-component.html">The Term Vector Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-stats-component.html">The Stats Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-query-elevation-component.html">The Query Elevation Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="response-writers.html">Response Writers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="velocity-response-writer.html">Velocity Response Writer</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="near-real-time-searching.html">Near Real Time Searching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="realtime-get.html">RealTime Get</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="exporting-result-sets.html">Exporting Result Sets</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="streaming-expressions.html">Streaming Expressions</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="graph-traversal.html">Graph Traversal</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="parallel-sql-interface.html">Parallel SQL Interface</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="solr-jdbc-dbvisualizer.html">Solr JDBC - DbVisualizer</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-squirrel-sql.html">Solr JDBC - SQuirreL SQL</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-apache-zeppelin.html">Solr JDBC - Apache Zeppelin</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-python-jython.html">Solr JDBC - Python/Jython</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-r.html">Solr JDBC - R</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="the-well-configured-solr-instance.html">The Well-Configured Solr Instance</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="configuring-solrconfig-xml.html">Configuring solrconfig.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="datadir-and-directoryfactory-in-solrconfig.html">DataDir and DirectoryFactory in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="lib-directives-in-solrconfig.html">Lib Directives in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-factory-definition-in-solrconfig.html">Schema Factory Definition in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="indexconfig-in-solrconfig.html">IndexConfig in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="initparams-in-solrconfig.html">InitParams in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="updatehandlers-in-solrconfig.html">UpdateHandlers in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-settings-in-solrconfig.html">Query Settings in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requestdispatcher-in-solrconfig.html">RequestDispatcher in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="update-request-processors.html">Update Request Processors</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="codec-factory.html">Codec Factory</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-cores-and-solr-xml.html">Solr Cores and solr.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="format-of-solr-xml.html">Format of solr.xml</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="defining-core-properties.html">Defining core.properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="coreadmin-api.html">CoreAdmin API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-sets.html">Config Sets</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuration-apis.html">Configuration APIs</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blob-store-api.html">Blob Store API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-api.html">Config API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="request-parameters-api.html">Request Parameters API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="managed-resources.html">Managed Resources</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="implicit-requesthandlers.html">Implicit RequestHandlers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-plugins.html">Solr Plugins</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="adding-custom-plugins-in-solrcloud-mode.html">Adding Custom Plugins in SolrCloud Mode</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="jvm-settings.html">JVM Settings</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="managing-solr.html">Managing Solr</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="taking-solr-to-production.html">Taking Solr to Production</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="securing-solr.html">Securing Solr</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="authentication-and-authorization-plugins.html">Authentication and Authorization Plugins</a>
            
            <ul>
              
              <li class="sb-level4">
                <a href="basic-authentication-plugin.html">Basic Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="hadoop-authentication-plugin.html">Hadoop Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="kerberos-authentication-plugin.html">Kerberos Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="rule-based-authorization-plugin.html">Rule-Based Authorization Plugin</a>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class="sb-level3">
            <a href="enabling-ssl.html">Enabling SSL</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr-on-hdfs.html">Running Solr on HDFS</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="making-and-restoring-backups.html">Making and Restoring Backups</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuring-logging.html">Configuring Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-jmx-with-solr.html">Using JMX with Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="mbean-request-handler.html">MBean Request Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="performance-statistics-reference.html">Performance Statistics Reference</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="metrics-reporting.html">Metrics Reporting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="v2-api.html">v2 API</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="solrcloud.html">SolrCloud</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="getting-started-with-solrcloud.html">Getting Started with SolrCloud</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="how-solrcloud-works.html">How SolrCloud Works</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="shards-and-indexing-data-in-solrcloud.html">Shards and Indexing Data in SolrCloud</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="distributed-requests.html">Distributed Requests</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="read-and-write-side-fault-tolerance.html">Read and Write Side Fault Tolerance</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solrcloud-configuration-and-parameters.html">SolrCloud Configuration and Parameters</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="setting-up-an-external-zookeeper-ensemble.html">Setting Up an External ZooKeeper Ensemble</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="using-zookeeper-to-manage-configuration-files.html">Using ZooKeeper to Manage Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="zookeeper-access-control.html">ZooKeeper Access Control</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="collections-api.html">Collections API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="parameter-reference.html">Parameter Reference</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="command-line-utilities.html">Command Line Utilities</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solrcloud-with-legacy-configuration-files.html">SolrCloud with Legacy Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="configsets-api.html">ConfigSets API</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="rule-based-replica-placement.html">Rule-based Replica Placement</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cross-data-center-replication-cdcr-.html">Cross Data Center Replication (CDCR)</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="legacy-scaling-and-distribution.html">Legacy Scaling and Distribution</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-scaling-and-distribution.html">Introduction to Scaling and Distribution</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="index-replication.html">Index Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="merging-indexes.html">Merging Indexes</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="client-apis.html">Client APIs</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-client-apis.html">Introduction to Client APIs</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="choosing-an-output-format.html">Choosing an Output Format</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="client-api-lineup.html">Client API Lineup</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-javascript.html">Using JavaScript</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-python.html">Using Python</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solrj.html">Using SolrJ</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solr-from-ruby.html">Using Solr From Ruby</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="major-changes-from-solr-5-to-solr-6.html">Major Changes from Solr 5 to Solr 6</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-a-solr-cluster.html">Upgrading a Solr Cluster</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="indexupgrader-tool.html">IndexUpgrader Tool</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="further-assistance.html">Further Assistance</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="solr-glossary.html">Solr Glossary</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="errata.html">Errata</a>
    
  </li>
  
</ul>


<!-- set the 'active' class on the current page and ancestors -->
<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("#mysidebar a[href='index-replication.html']").parents('li').toggleClass("active", true);</script>
<!-- set the 'current' class on the current page and 'current-tree' on the current page + it's ancestors -->
<!-- this can let us do css highlighting of the current page in the sidebar even if/when the user clicks around in the sidebar causing other sidebar elements to be 'active' -->
<script>
  $("#mysidebar a[href='index-replication.html']").parent('li').toggleClass("current", true);
  $("#mysidebar a[href='index-replication.html']").parents('li').toggleClass("current-tree", true);
</script>

    </div>
    <!-- Content Column -->
    <div class="col-md-9">
      <div class="post-header">
   <h1 class="post-title-main">Index Replication</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

<div id="main-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Index Replication distributes complete copies of a master index to one or more slave servers. The master server continues to manage updates to the index. All querying is handled by the slaves. This division of labor enables Solr to scale to provide adequate responsiveness to queries against large search volumes.</p>
</div>
<div class="paragraph">
<p>The figure below shows a Solr configuration using index replication. The master server&#8217;s index is replicated on the slaves.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/index-replication/worddav2b7e14725d898b4104cdd9c502fc77cd.png" alt="image" width="159" height="235">
</div>
</div>
<div class="paragraph">
<p><em>A Solr index can be replicated across multiple slave servers, which then process requests.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-IndexReplicationinSolr">Index Replication in Solr</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Solr includes a Java implementation of index replication that works over HTTP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration affecting replication is controlled by a single file, <code>solrconfig.xml</code></p>
</li>
<li>
<p>Supports the replication of configuration files as well as index files</p>
</li>
<li>
<p>Works across platforms with same configuration</p>
</li>
<li>
<p>No reliance on OS-dependent file system features (eg: hard links)</p>
</li>
<li>
<p>Tightly integrated with Solr; an admin page offers fine-grained control of each aspect of replication</p>
</li>
<li>
<p>The Java-based replication feature is implemented as a request handler. Configuring replication is therefore similar to any normal request handler.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Replication In SolrCloud</div>
<div class="paragraph">
<p>Although there is no explicit concept of "master/slave" nodes in a <a href="solrcloud.html#solrcloud">SolrCloud</a> cluster, the <code>ReplicationHandler</code> discussed on this page is still used by SolrCloud as needed to support "shard recovery" – but this is done in a peer to peer manner. When using SolrCloud, the <code>ReplicationHandler</code> must be available via the <code>/replication</code> path. Solr does this implicitly unless overridden explicitly in your <code>solrconfig.xml</code>, but If you wish to override the default behavior, make certain that you do not explicitly set any of the "master" or "slave" configuration options mentioned below, or they will interfere with normal SolrCloud operation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-ReplicationTerminology">Replication Terminology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The table below defines the key terms associated with Solr replication.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Lucene index is a directory of files. These files make up the searchable and returnable data of a Solr Core.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The copying of an index from the master server to all slaves. The distribution process takes advantage of Lucene&#8217;s index file structure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts and Deletes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As inserts and deletes occur in the index, the directory remains unchanged. Documents are always inserted into newly created files. Documents that are deleted are not removed from the files. They are flagged in the file, deletable, and are not removed from the files until the index is optimized.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Master and Slave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Solr replication master is a single node which receives all updates initially and keeps everything organized. Solr replication slave nodes receive no updates directly, instead all changes (such as inserts, updates, deletes, etc.) are made against the single master node. Changes made on the master are distributed to all the slave nodes which service all query requests from the clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An update is a single change request against a single Solr instance. It may be a request to delete a document, add a new document, change a document, delete all documents matching a query, etc. Updates are handled synchronously within an individual Solr instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A process that compacts the index and merges segments in order to improve query performance. Optimization should only be run on the master nodes. An optimized index may give query performance gains compared to an index that has become fragmented over a period of time with many updates. Distributing an optimized index requires a much longer time than the distribution of new segments to an un-optimized index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A self contained subset of an index consisting of some documents and data structures related to the inverted index of terms in those documents.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mergeFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A parameter that controls the number of segments in an index. For example, when mergeFactor is set to 3, Solr will fill one segment with documents until the limit maxBufferedDocs is met, then it will start a new segment. When the number of segments specified by mergeFactor is reached (in this example, 3) then Solr will merge all the segments into a single index file, then begin writing new documents to a new segment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing hard links to the data files of an index. Snapshots are distributed from the master nodes when the slaves pull them, "smart copying" any segments the slave node does not have in snapshot directory that contains the hard links to the most recent index data files.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-ConfiguringtheReplicationHandler">Configuring the ReplicationHandler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to <code>ReplicationHandler</code> configuration options specific to the master/slave roles, there are a few special configuration options that are generally supported (even when using SolrCloud).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxNumberOfBackups</code> an integer value dictating the maximum number of backups this node will keep on disk as it receives <code>backup</code> commands.</p>
</li>
<li>
<p>Similar to most other request handlers in Solr you may configure a set of "<a href="requesthandlers-and-searchcomponents-in-solrconfig.html#RequestHandlersandSearchComponentsinSolrConfig-SearchHandlers">defaults, invariants, and/or appends</a>" parameters corresponding with any request parameters supported by the <code>ReplicationHandler</code> when <a href="#IndexReplication-HTTPAPICommandsfortheReplicationHandler">processing commands</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="IndexReplication-ConfiguringtheReplicationRequestHandleronaMasterServer">Configuring the Replication RequestHandler on a Master Server</h3>
<div class="paragraph">
<p>Before running a replication, you should set the following parameters on initialization of the handler:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicateAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String specifying action after which replication should occur. Valid values are commit, optimize, or startup. There can be multiple values for this parameter. If you use "startup", you need to have a "commit" and/or "optimize" entry also if you want to trigger replication on future commits or optimizes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">backupAfter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String specifying action after which a backup should occur. Valid values are commit, optimize, or startup. There can be multiple values for this parameter. It is not required for replication, it just makes a backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxNumberOfBackups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer specifying how many backups to keep. This can be used to delete all but the most recent N backups.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">confFiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration files to replicate, separated by a comma.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commitReserveDuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If your commits are very frequent and your network is slow, you can tweak this parameter to increase the amount of time taken to download 5Mb from the master to a slave. The default is 10 seconds.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The example below shows a possible 'master' configuration for the <code>ReplicationHandler</code>, including a fixed number of backups and an invariant setting for the <code>maxWriteMBPerSec</code> request parameter to prevent slaves from saturating its network interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>requestHandler name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/replication&quot;</span> class<span style="color: #666666">=</span><span style="color: #BA2121">&quot;solr.ReplicationHandler&quot;</span><span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span>lst name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;master&quot;</span><span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replicateAfter&quot;</span><span style="color: #666666">&gt;</span>optimize<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;backupAfter&quot;</span><span style="color: #666666">&gt;</span>optimize<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;confFiles&quot;</span><span style="color: #666666">&gt;</span>schema<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">,</span>stopwords<span style="color: #666666">.</span><span style="color: #7D9029">txt</span><span style="color: #666666">,</span>elevate<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;commitReserveDuration&quot;</span><span style="color: #666666">&gt;00:00:10&lt;/</span>str<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;/</span>lst<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span><span style="color: #B00040">int</span> name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;maxNumberOfBackups&quot;</span><span style="color: #666666">&gt;2&lt;/</span><span style="color: #B00040">int</span><span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span>lst name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;invariants&quot;</span><span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;maxWriteMBPerSec&quot;</span><span style="color: #666666">&gt;16&lt;/</span>str<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;/</span>lst<span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;/</span>requestHandler<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="IndexReplication-Replicatingsolrconfig.xml">Replicating <code>solrconfig.xml</code></h4>
<div class="paragraph">
<p>In the configuration file on the master server, include a line like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;confFiles&quot;</span><span style="color: #666666">&gt;</span>solrconfig_slave<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">:</span>solrconfig<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">,</span>x<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">,</span>y<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This ensures that the local configuration <code>solrconfig_slave.xml</code> will be saved as <code>solrconfig.xml</code> on the slave. All other files will be saved with their original names.</p>
</div>
<div class="paragraph">
<p>On the master server, the file name of the slave configuration file can be anything, as long as the name is correctly identified in the <code>confFiles</code> string; then it will be saved as whatever file name appears after the colon ':'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="IndexReplication-ConfiguringtheReplicationRequestHandleronaSlaveServer">Configuring the Replication RequestHandler on a Slave Server</h3>
<div class="paragraph">
<p>The code below shows how to configure a ReplicationHandler on a slave.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>requestHandler name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/replication&quot;</span> class<span style="color: #666666">=</span><span style="color: #BA2121">&quot;solr.ReplicationHandler&quot;</span><span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span>lst name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;slave&quot;</span><span style="color: #666666">&gt;</span>

    <span style="color: #666666">&lt;!--</span> fully qualified url <span style="color: #008000; font-weight: bold">for</span> the replication handler of master<span style="color: #666666">.</span> It is
         possible to pass on <span style="color: #008000; font-weight: bold">this</span> as a request param <span style="color: #008000; font-weight: bold">for</span> the fetchindex command <span style="color: #666666">--&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;masterUrl&quot;</span><span style="color: #666666">&gt;</span>http<span style="color: #666666">:</span><span style="color: #408080; font-style: italic">//remote_host:port/solr/core_name/replication&lt;/str&gt;</span>

    <span style="color: #666666">&lt;!--</span> Interval in which the slave should poll master<span style="color: #666666">.</span>  Format is HH<span style="color: #666666">:</span>mm<span style="color: #666666">:</span>ss <span style="color: #666666">.</span>
         If <span style="color: #008000; font-weight: bold">this</span> is absent slave does not poll automatically<span style="color: #666666">.</span>

         But a fetchindex can be triggered from the admin or the http API <span style="color: #666666">--&gt;</span>

    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;pollInterval&quot;</span><span style="color: #666666">&gt;00:00:20&lt;/</span>str<span style="color: #666666">&gt;</span>

    <span style="color: #666666">&lt;!--</span> THE FOLLOWING PARAMETERS ARE USUALLY NOT REQUIRED<span style="color: #666666">--&gt;</span>

    <span style="color: #666666">&lt;!--</span> To use compression <span style="color: #008000; font-weight: bold">while</span> transferring the index files<span style="color: #666666">.</span> The possible
         values are internal<span style="color: #666666">|</span>external<span style="color: #666666">.</span>  If the value is <span style="border: 1px solid #FF0000">&#39;</span>external<span style="border: 1px solid #FF0000">&#39;</span> make sure
         that your master Solr has the settings to honor the accept<span style="color: #666666">-</span>encoding header<span style="color: #666666">.</span>
         See here <span style="color: #008000; font-weight: bold">for</span> details<span style="color: #666666">:</span> http<span style="color: #666666">:</span><span style="color: #408080; font-style: italic">//wiki.apache.org/solr/SolrHttpCompression</span>
         If it is <span style="border: 1px solid #FF0000">&#39;</span>internal<span style="border: 1px solid #FF0000">&#39;</span> everything will be taken care of automatically<span style="color: #666666">.</span>
         USE THIS ONLY IF YOUR BANDWIDTH IS LOW<span style="color: #666666">.</span>
         THIS CAN ACTUALLY SLOWDOWN REPLICATION IN A LAN <span style="color: #666666">--&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;compression&quot;</span><span style="color: #666666">&gt;</span>internal<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>

    <span style="color: #666666">&lt;!--</span> The following values are used when the slave connects to the master to
         download the index files<span style="color: #666666">.</span>  Default values implicitly set as <span style="color: #666666">5000</span>ms and
         <span style="color: #666666">10000</span>ms respectively<span style="color: #666666">.</span> The user DOES NOT need to specify these unless the
         bandwidth is extremely low or <span style="color: #008000; font-weight: bold">if</span> there is an extremely high latency <span style="color: #666666">--&gt;</span>

    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;httpConnTimeout&quot;</span><span style="color: #666666">&gt;5000&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;httpReadTimeout&quot;</span><span style="color: #666666">&gt;10000&lt;/</span>str<span style="color: #666666">&gt;</span>

    <span style="color: #666666">&lt;!--</span> If HTTP Basic authentication is enabled on the master<span style="color: #666666">,</span> then the slave
         can be configured with the following <span style="color: #666666">--&gt;</span>

    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;httpBasicAuthUser&quot;</span><span style="color: #666666">&gt;</span>username<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;httpBasicAuthPassword&quot;</span><span style="color: #666666">&gt;</span>password<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;/</span>lst<span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;/</span>requestHandler<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-SettingUpaRepeaterwiththeReplicationHandler">Setting Up a Repeater with the ReplicationHandler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A master may be able to serve only so many slaves without affecting performance. Some organizations have deployed slave servers across multiple data centers. If each slave downloads the index from a remote data center, the resulting download may consume too much network bandwidth. To avoid performance degradation in cases like this, you can configure one or more slaves as repeaters. A repeater is simply a node that acts as both a master and a slave.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To configure a server as a repeater, the definition of the Replication <code>requestHandler</code> in the <code>solrconfig.xml</code> file must include file lists of use for both masters and slaves.</p>
</li>
<li>
<p>Be sure to set the <code>replicateAfter</code> parameter to commit, even if <code>replicateAfter</code> is set to optimize on the main master. This is because on a repeater (or any slave), a commit is called only after the index is downloaded. The optimize command is never called on slaves.</p>
</li>
<li>
<p>Optionally, one can configure the repeater to fetch compressed files from the master through the compression parameter to reduce the index download time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a ReplicationHandler configuration for a repeater:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>requestHandler name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/replication&quot;</span> class<span style="color: #666666">=</span><span style="color: #BA2121">&quot;solr.ReplicationHandler&quot;</span><span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span>lst name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;master&quot;</span><span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replicateAfter&quot;</span><span style="color: #666666">&gt;</span>commit<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;confFiles&quot;</span><span style="color: #666666">&gt;</span>schema<span style="color: #666666">.</span><span style="color: #7D9029">xml</span><span style="color: #666666">,</span>stopwords<span style="color: #666666">.</span><span style="color: #7D9029">txt</span><span style="color: #666666">,</span>synonyms<span style="color: #666666">.</span><span style="color: #7D9029">txt</span><span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;/</span>lst<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;</span>lst name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;slave&quot;</span><span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;masterUrl&quot;</span><span style="color: #666666">&gt;</span>http<span style="color: #666666">:</span><span style="color: #408080; font-style: italic">//master.solr.company.com:8983/solr/core_name/replication&lt;/str&gt;</span>
    <span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;pollInterval&quot;</span><span style="color: #666666">&gt;00:00:60&lt;/</span>str<span style="color: #666666">&gt;</span>
  <span style="color: #666666">&lt;/</span>lst<span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;/</span>requestHandler<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-CommitandOptimizeOperations">Commit and Optimize Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a commit or optimize operation is performed on the master, the RequestHandler reads the list of file names which are associated with each commit point. This relies on the <code>replicateAfter</code> parameter in the configuration to decide which types of events should trigger replication.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting on the Master</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggers replication whenever a commit is performed on the master index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggers replication whenever the master index is optimized.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggers replication whenever the master index starts up.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The replicateAfter parameter can accept multiple arguments. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replicateAfter&quot;</span><span style="color: #666666">&gt;</span>startup<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replicateAfter&quot;</span><span style="color: #666666">&gt;</span>commit<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;</span>str name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;replicateAfter&quot;</span><span style="color: #666666">&gt;</span>optimize<span style="color: #666666">&lt;/</span>str<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-SlaveReplication">Slave Replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The master is totally unaware of the slaves. The slave continuously keeps polling the master (depending on the <code>pollInterval</code> parameter) to check the current index version of the master. If the slave finds out that the master has a newer version of the index it initiates a replication process. The steps are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The slave issues a <code>filelist</code> command to get the list of the files. This command returns the names of the files as well as some metadata (for example, size, a lastmodified timestamp, an alias if any).</p>
</li>
<li>
<p>The slave checks with its own index if it has any of those files in the local index. It then runs the filecontent command to download the missing files. This uses a custom format (akin to the HTTP chunked encoding) to download the full content or a part of each file. If the connection breaks in between, the download resumes from the point it failed. At any point, the slave tries 5 times before giving up a replication altogether.</p>
</li>
<li>
<p>The files are downloaded into a temp directory, so that if either the slave or the master crashes during the download process, no files will be corrupted. Instead, the current replication will simply abort.</p>
</li>
<li>
<p>After the download completes, all the new files are moved to the live index directory and the file&#8217;s timestamp is same as its counterpart on the master.</p>
</li>
<li>
<p>A commit command is issued on the slave by the Slave&#8217;s ReplicationHandler and the new index is loaded.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="IndexReplication-ReplicatingConfigurationFiles">Replicating Configuration Files</h3>
<div class="paragraph">
<p>To replicate configuration files, list them using using the <code>confFiles</code> parameter. Only files found in the <code>conf</code> directory of the master&#8217;s Solr instance will be replicated.</p>
</div>
<div class="paragraph">
<p>Solr replicates configuration files only when the index itself is replicated. That means even if a configuration file is changed on the master, that file will be replicated only after there is a new commit/optimize on master&#8217;s index.</p>
</div>
<div class="paragraph">
<p>Unlike the index files, where the timestamp is good enough to figure out if they are identical, configuration files are compared against their checksum. The <code>schema.xml</code> files (on master and slave) are judged to be identical if their checksums are identical.</p>
</div>
<div class="paragraph">
<p>As a precaution when replicating configuration files, Solr copies configuration files to a temporary directory before moving them into their ultimate location in the conf directory. The old configuration files are then renamed and kept in the same <code>conf/</code> directory. The ReplicationHandler does not automatically clean up these old files.</p>
</div>
<div class="paragraph">
<p>If a replication involved downloading of at least one configuration file, the ReplicationHandler issues a core-reload command instead of a commit command.</p>
</div>
</div>
<div class="sect2">
<h3 id="IndexReplication-ResolvingCorruptionIssuesonSlaveServers">Resolving Corruption Issues on Slave Servers</h3>
<div class="paragraph">
<p>If documents are added to the slave, then the slave is no longer in sync with its master. However, the slave will not undertake any action to put itself in sync, until the master has new index data. When a commit operation takes place on the master, the index version of the master becomes different from that of the slave. The slave then fetches the list of files and finds that some of the files present on the master are also present in the local index but with different sizes and timestamps. This means that the master and slave have incompatible indexes. To correct this problem, the slave then copies all the index files from master to a new index directory and asks the core to load the fresh index from the new directory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-HTTPAPICommandsfortheReplicationHandler">HTTP API Commands for the ReplicationHandler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the HTTP commands below to control the ReplicationHandler&#8217;s operations.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>master_host:port</em>/solr/<em>core_name</em>/replication?command=enablereplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables replication on the master for all its slaves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>master_host:port</em>/solr/<em>core_name</em>/replication?command=disablereplication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables replication on the master for all its slaves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>host:port</em>/solr/<em>core_name</em>/replication?command=indexversion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the version of the latest replicatable index on the specified master or slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>slave_host:port</em>/solr/<em>core_name</em>/replication?command=fetchindex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forces the specified slave to fetch a copy of the index from its master. If you like, you can pass an extra attribute such as masterUrl or compression (or any other parameter which is specified in the <code>&lt;lst name="slave"&gt;</code> tag) to do a one time replication from a master. This obviates the need for hard-coding the master in the slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>slave_host:port</em>/solr/<em>core_name</em>/replication?command=abortfetch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborts copying an index from a master to the specified slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>slave_host:port</em>/solr/<em>core_name</em>/replication?command=enablepoll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the specified slave to poll for changes on the master.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>slave_host:port</em>/solr/<em>core_name</em>/replication?command=disablepoll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables the specified slave from polling for changes on the master.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>slave_host:port</em>/solr/<em>core_name</em>/replication?command=details</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves configuration details and current status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>host:port</em>/solr/<em>core_name</em>/replication?command=filelist&amp;generation=&lt;<em>generation-number</em>&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves a list of Lucene files present in the specified host&#8217;s index. You can discover the generation number of the index by running the <code>indexversion</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://<em>master_host:port</em>/solr/<em>core_name</em>/replication?command=backup</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Creates a backup on master if there are committed index data in the server; otherwise, does nothing. This command is useful for making periodic backups.</p>
</div>
<div class="paragraph">
<p>supported request parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>numberToKeep:</code> request parameter can be used with the backup command unless the <code>maxNumberOfBackups</code> initialization parameter has been specified on the handler – in which case <code>maxNumberOfBackups</code> is always used and attempts to use the <code>numberToKeep</code> request parameter will cause an error.</p>
</li>
<li>
<p><code>name</code> : (optional) Backup name . The snapshot will be created in a directory called snapshot.&lt;name&gt; within the data directory of the core . By default the name is generated using date in <code>yyyyMMddHHmmssSSS</code> format. If <code>location</code> parameter is passed , that would be used instead of the data directory</p>
</li>
<li>
<p><code>location</code>: Backup location</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http:// <em>master_host:port</em> /solr/<em>core_name</em>/replication?command=deletebackup</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Delete any backup created using the <code>backup</code> command .</p>
</div>
<div class="paragraph">
<p>request parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name: The name of the snapshot . A snapshot with the name snapshot.&lt;name&gt; must exist .If not, an error is thrown</p>
</li>
<li>
<p>location: Location where the snapshot is created</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="IndexReplication-DistributionandOptimization">Distribution and Optimization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optimizing an index is not something most users should generally worry about - but in particular users should be aware of the impacts of optimizing an index when using the <code>ReplicationHandler</code>.</p>
</div>
<div class="paragraph">
<p>The time required to optimize a master index can vary dramatically. A small index may be optimized in minutes. A very large index may take hours. The variables include the size of the index and the speed of the hardware.</p>
</div>
<div class="paragraph">
<p>Distributing a newly optimized index may take only a few minutes or up to an hour or more, again depending on the size of the index and the performance capabilities of network connections and disks. During optimization the machine is under load and does not process queries very well. Given a schedule of updates being driven a few times an hour to the slaves, we cannot run an optimize with every committed snapshot.</p>
</div>
<div class="paragraph">
<p>Copying an optimized index means that the <strong>entire</strong> index will need to be transferred during the next snappull. This is a large expense, but not nearly as huge as running the optimize everywhere. Consider this example: on a three-slave one-master configuration, distributing a newly-optimized index takes approximately 80 seconds <em>total</em>. Rolling the change across a tier would require approximately ten minutes per machine (or machine group). If this optimize were rolled across the query tier, and if each slave node being optimized were disabled and not receiving queries, a rollout would take at least twenty minutes and potentially as long as an hour and a half. Additionally, the files would need to be synchronized so that the <em>following</em> the optimize, snappull would not think that the independently optimized files were different in any way. This would also leave the door open to independent corruption of indexes instead of each being a perfect copy of the master.</p>
</div>
<div class="paragraph">
<p>Optimizing on the master allows for a straight-forward optimization operation. No query slaves need to be taken out of service. The optimized index can be distributed in the background as queries are being normally serviced. The optimization can occur at any time convenient to the application providing index updates.</p>
</div>
<div class="paragraph">
<p>While optimizing may have some benefits in some situations, a rapidly changing index will not retain those benefits for long, and since optimization is an intensive process, it may be better to consider other options, such as lowering the merge factor (discussed in the section on <a href="indexconfig-in-solrconfig.html#IndexConfiginSolrConfig-mergeFactor">Index Configuration</a>).</p>
</div>
</div>
</div>
</div>

<!-- Adds tags, if any -->
    <div class="tags">
        
    </div>

<!-- Adds nav links on each page -->
    
    
    <div class="scrollnav">
      
      <a class="btn btn-primary prev" href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
      
      
      <a class="btn btn-primary next" href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
      
    </div>
    

</div>

<!-- Adds comments from Apache's Comment system -->

<div id="comments_thread">
</div>
<script type="text/javascript" src="https://comments.apache.org/show_comments.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=index-replication" async="true">
</script>
<noscript>
<iframe width="100%" height="500" src="https://comments.apache.org/iframe.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=index-replication"></iframe>
</noscript>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Apache Software Foundation. All rights reserved. <br />
 Site last generated: 2017-04-26 <br />
<p><img src="solr-sunOnly-small.png" alt="Apache Solr"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</div>

</body>

</html>

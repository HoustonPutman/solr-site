<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Streaming Expressions | Apache Solr Reference Guide</title>

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-solr.css">
<link rel="stylesheet" href="css/ref-guide.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Apache Solr Reference Guide" href="https://home.apache.org/~ctargett/RefGuidePOC/jekyll-full/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // we do *NOT* want cookies used to save the current stage of the sidebar
                             // instead the code in sidebar.html will ensure that the current page
                             // (and it's ancestors) are "active" on page load
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="apache-solr-reference-guide.html">&nbsp;<span class="projectTitle"> Solr Ref Guide 7.0</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- Link to Solr website -->
                <li><a href="https://lucene.apache.org/solr/news" target="_blank">Solr News</a></li>
                <!-- Solr Resources dropdown -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solr Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                       <li><a href="https://lucene.apache.org/solr/7_0_0//solr-core/index.html" target="_blank">Solr Javadocs</a></li>
                       <li><a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git" target="_blank">Lucene/Solr Source Code</a></li>
                       <li><a href="https://lucene.apache.org/solr/resources.html#community" target="_blank">Solr Community Links</a></li>
                    </ul>
                </li>
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Streaming Expressions">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div class="col-lg-12">&nbsp;</div>
  <!-- Content Row -->
  <div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
      

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Apache Solr Reference Guide <!-- TODO: version from site.data --></li>
  
  <li class="sb-level1">
    <a href="about-this-guide.html">About This Guide</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="getting-started.html">Getting Started</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="installing-solr.html">Installing Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr.html">Running Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-quick-overview.html">A Quick Overview</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-step-closer.html">A Step Closer</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-control-script-reference.html">Solr Control Script Reference</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-solr.html">Upgrading Solr</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="using-the-solr-administration-user-interface.html">Using the Solr Administration User Interface</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-the-solr-admin-ui.html">Overview of the Solr Admin UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="getting-assistance.html">Getting Assistance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="logging.html">Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cloud-screens.html">Cloud Screens</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collections-core-admin.html">Collections / Core Admin</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="java-properties.html">Java Properties</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="thread-dump.html">Thread Dump</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collection-specific-tools.html">Collection-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="analysis-screen.html">Analysis Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="dataimport-screen.html">Dataimport Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="documents-screen.html">Documents Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="files-screen.html">Files Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-screen.html">Query Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="stream-screen.html">Stream Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-browser-screen.html">Schema Browser Screen</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="core-specific-tools.html">Core-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="ping.html">Ping</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="plugins-stats-screen.html">Plugins &amp; Stats Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="replication-screen.html">Replication Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="segments-info.html">Segments Info</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="documents-fields-and-schema-design.html">Documents, Fields, and Schema Design</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-documents-fields-and-schema-design.html">Overview of Documents, Fields, and Schema Design</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-field-types.html">Solr Field Types</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="field-type-definitions-and-properties.html">Field Type Definitions and Properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-types-included-with-solr.html">Field Types Included with Solr</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-currencies-and-exchange-rates.html">Working with Currencies and Exchange Rates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-dates.html">Working with Dates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-enum-fields.html">Working with Enum Fields</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-external-files-and-processes.html">Working with External Files and Processes</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-properties-by-use-case.html">Field Properties by Use Case</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="defining-fields.html">Defining Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="copying-fields.html">Copying Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="dynamic-fields.html">Dynamic Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="other-schema-elements.html">Other Schema Elements</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schema-api.html">Schema API</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="putting-the-pieces-together.html">Putting the Pieces Together</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="docvalues.html">DocValues</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schemaless-mode.html">Schemaless Mode</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="understanding-analyzers-tokenizers-and-filters.html">Understanding Analyzers, Tokenizers, and Filters</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="analyzers.html">Analyzers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-tokenizers.html">About Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-filters.html">About Filters</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="tokenizers.html">Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="filter-descriptions.html">Filter Descriptions</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="charfilterfactories.html">CharFilterFactories</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="language-analysis.html">Language Analysis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="phonetic-matching.html">Phonetic Matching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-your-analyzer.html">Running Your Analyzer</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="indexing-and-basic-data-operations.html">Indexing and Basic Data Operations</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-solr-indexing.html">Introduction to Solr Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="post-tool.html">Post Tool</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-index-handlers.html">Uploading Data with Index Handlers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="transforming-and-indexing-custom-json.html">Transforming and Indexing Custom JSON</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-solr-cell-using-apache-tika.html">Uploading Data with Solr Cell using Apache Tika</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="updating-parts-of-documents.html">Updating Parts of Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="de-duplication.html">De-Duplication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="content-streams.html">Content Streams</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uima-integration.html">UIMA Integration</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="searching.html">Searching</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-searching-in-solr.html">Overview of Searching in Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="velocity-search-ui.html">Velocity Search UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="relevance.html">Relevance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-syntax-and-parsing.html">Query Syntax and Parsing</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="common-query-parameters.html">Common Query Parameters</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-standard-query-parser.html">The Standard Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-dismax-query-parser.html">The DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-extended-dismax-query-parser.html">The Extended DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="function-queries.html">Function Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="local-parameters-in-queries.html">Local Parameters in Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="other-parsers.html">Other Parsers</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="faceting.html">Faceting</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blockjoin-faceting.html">BlockJoin Faceting</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="highlighting.html">Highlighting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spell-checking.html">Spell Checking</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-re-ranking.html">Query Re-Ranking</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="learning-to-rank.html">Learning To Rank</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="transforming-result-documents.html">Transforming Result Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="suggester.html">Suggester</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="morelikethis.html">MoreLikeThis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="pagination-of-results.html">Pagination of Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collapse-and-expand-results.html">Collapse and Expand Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-grouping.html">Result Grouping</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-clustering.html">Result Clustering</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spatial-search.html">Spatial Search</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-terms-component.html">The Terms Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-term-vector-component.html">The Term Vector Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-stats-component.html">The Stats Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-query-elevation-component.html">The Query Elevation Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="response-writers.html">Response Writers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="velocity-response-writer.html">Velocity Response Writer</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="near-real-time-searching.html">Near Real Time Searching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="realtime-get.html">RealTime Get</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="exporting-result-sets.html">Exporting Result Sets</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="streaming-expressions.html">Streaming Expressions</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="graph-traversal.html">Graph Traversal</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="parallel-sql-interface.html">Parallel SQL Interface</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="solr-jdbc-dbvisualizer.html">Solr JDBC - DbVisualizer</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-squirrel-sql.html">Solr JDBC - SQuirreL SQL</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-apache-zeppelin.html">Solr JDBC - Apache Zeppelin</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-python-jython.html">Solr JDBC - Python/Jython</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-r.html">Solr JDBC - R</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="the-well-configured-solr-instance.html">The Well-Configured Solr Instance</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="configuring-solrconfig-xml.html">Configuring solrconfig.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="datadir-and-directoryfactory-in-solrconfig.html">DataDir and DirectoryFactory in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="lib-directives-in-solrconfig.html">Lib Directives in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-factory-definition-in-solrconfig.html">Schema Factory Definition in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="indexconfig-in-solrconfig.html">IndexConfig in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="initparams-in-solrconfig.html">InitParams in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="updatehandlers-in-solrconfig.html">UpdateHandlers in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-settings-in-solrconfig.html">Query Settings in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requestdispatcher-in-solrconfig.html">RequestDispatcher in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="update-request-processors.html">Update Request Processors</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="codec-factory.html">Codec Factory</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-cores-and-solr-xml.html">Solr Cores and solr.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="format-of-solr-xml.html">Format of solr.xml</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="defining-core-properties.html">Defining core.properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="coreadmin-api.html">CoreAdmin API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-sets.html">Config Sets</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuration-apis.html">Configuration APIs</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blob-store-api.html">Blob Store API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-api.html">Config API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="request-parameters-api.html">Request Parameters API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="managed-resources.html">Managed Resources</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="implicit-requesthandlers.html">Implicit RequestHandlers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-plugins.html">Solr Plugins</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="adding-custom-plugins-in-solrcloud-mode.html">Adding Custom Plugins in SolrCloud Mode</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="jvm-settings.html">JVM Settings</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="managing-solr.html">Managing Solr</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="taking-solr-to-production.html">Taking Solr to Production</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="securing-solr.html">Securing Solr</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="authentication-and-authorization-plugins.html">Authentication and Authorization Plugins</a>
            
            <ul>
              
              <li class="sb-level4">
                <a href="basic-authentication-plugin.html">Basic Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="hadoop-authentication-plugin.html">Hadoop Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="kerberos-authentication-plugin.html">Kerberos Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="rule-based-authorization-plugin.html">Rule-Based Authorization Plugin</a>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class="sb-level3">
            <a href="enabling-ssl.html">Enabling SSL</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr-on-hdfs.html">Running Solr on HDFS</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="making-and-restoring-backups.html">Making and Restoring Backups</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuring-logging.html">Configuring Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-jmx-with-solr.html">Using JMX with Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="mbean-request-handler.html">MBean Request Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="performance-statistics-reference.html">Performance Statistics Reference</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="metrics-reporting.html">Metrics Reporting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="v2-api.html">v2 API</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="solrcloud.html">SolrCloud</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="getting-started-with-solrcloud.html">Getting Started with SolrCloud</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="how-solrcloud-works.html">How SolrCloud Works</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="shards-and-indexing-data-in-solrcloud.html">Shards and Indexing Data in SolrCloud</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="distributed-requests.html">Distributed Requests</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="read-and-write-side-fault-tolerance.html">Read and Write Side Fault Tolerance</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solrcloud-configuration-and-parameters.html">SolrCloud Configuration and Parameters</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="setting-up-an-external-zookeeper-ensemble.html">Setting Up an External ZooKeeper Ensemble</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="using-zookeeper-to-manage-configuration-files.html">Using ZooKeeper to Manage Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="zookeeper-access-control.html">ZooKeeper Access Control</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="collections-api.html">Collections API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="parameter-reference.html">Parameter Reference</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="command-line-utilities.html">Command Line Utilities</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solrcloud-with-legacy-configuration-files.html">SolrCloud with Legacy Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="configsets-api.html">ConfigSets API</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="rule-based-replica-placement.html">Rule-based Replica Placement</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cross-data-center-replication-cdcr-.html">Cross Data Center Replication (CDCR)</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="legacy-scaling-and-distribution.html">Legacy Scaling and Distribution</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-scaling-and-distribution.html">Introduction to Scaling and Distribution</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="index-replication.html">Index Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="merging-indexes.html">Merging Indexes</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="client-apis.html">Client APIs</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-client-apis.html">Introduction to Client APIs</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="choosing-an-output-format.html">Choosing an Output Format</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="client-api-lineup.html">Client API Lineup</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-javascript.html">Using JavaScript</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-python.html">Using Python</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solrj.html">Using SolrJ</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solr-from-ruby.html">Using Solr From Ruby</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="major-changes-from-solr-5-to-solr-6.html">Major Changes from Solr 5 to Solr 6</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-a-solr-cluster.html">Upgrading a Solr Cluster</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="indexupgrader-tool.html">IndexUpgrader Tool</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="further-assistance.html">Further Assistance</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="solr-glossary.html">Solr Glossary</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="errata.html">Errata</a>
    
  </li>
  
</ul>


<!-- set the 'active' class on the current page and ancestors -->
<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("#mysidebar a[href='streaming-expressions.html']").parents('li').toggleClass("active", true);</script>
<!-- set the 'current' class on the current page and 'current-tree' on the current page + it's ancestors -->
<!-- this can let us do css highlighting of the current page in the sidebar even if/when the user clicks around in the sidebar causing other sidebar elements to be 'active' -->
<script>
  $("#mysidebar a[href='streaming-expressions.html']").parent('li').toggleClass("current", true);
  $("#mysidebar a[href='streaming-expressions.html']").parents('li').toggleClass("current-tree", true);
</script>

    </div>
    <!-- Content Column -->
    <div class="col-md-9">
      <div class="post-header">
   <h1 class="post-title-main">Streaming Expressions</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

<div id="main-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Streaming Expressions provide a simple yet powerful stream processing language for Solr Cloud. They are a suite of functions that can be combined to perform many different parallel computing tasks. These functions are the basis for the <a href="parallel-sql-interface.html#parallel-sql-interface">Parallel SQL Interface</a>.</p>
</div>
<div class="paragraph">
<p>There is a growing library of functions that can be combined to implement:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Request/response stream processing</p>
</li>
<li>
<p>Batch stream processing</p>
</li>
<li>
<p>Fast interactive MapReduce</p>
</li>
<li>
<p>Aggregations (Both pushed down faceted and shuffling MapReduce)</p>
</li>
<li>
<p>Parallel relational algebra (distributed joins, intersections, unions, complements)</p>
</li>
<li>
<p>Publish/subscribe messaging</p>
</li>
<li>
<p>Distributed graph traversal</p>
</li>
<li>
<p>Machine learning and parallel iterative model training</p>
</li>
<li>
<p>Anomaly detection</p>
</li>
<li>
<p>Recommendation systems</p>
</li>
<li>
<p>Retrieve and rank services</p>
</li>
<li>
<p>Text classification and feature extraction</p>
</li>
<li>
<p>Streaming NLP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Streams from outside systems can be joined with streams originating from Solr and users can add their own stream functions by following Solr&#8217;s <a href="https://lucene.apache.org/solr/7_0_0//solr-solrj/org/apache/solr/client/solrj/io/stream/package-summary.html">Java streaming API</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both streaming expressions and the streaming API are considered experimental, and the APIs are subject to change.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="StreamingExpressions-StreamLanguageBasics">Stream Language Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Streaming Expressions are comprised of streaming functions which work with a Solr collection. They emit a stream of tuples (key/value Maps).</p>
</div>
<div class="paragraph">
<p>Many of the provided streaming functions are designed to work with entire result sets rather then the top N results like normal search. This is supported by the <a href="exporting-result-sets.html#exporting-result-sets">/export handler</a>.</p>
</div>
<div class="paragraph">
<p>Some streaming functions act as stream sources to originate the stream flow. Other streaming functions act as stream decorators to wrap other stream functions and perform operations on the stream of tuples. Many streams functions can be parallelized across a worker collection. This can be particularly powerful for relational algebra functions.</p>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-StreamingRequestsandResponses">Streaming Requests and Responses</h3>
<div class="paragraph">
<p>Solr has a <code>/stream</code> request handler that takes streaming expression requests and returns the tuples as a JSON stream. This request handler is implicitly defined, meaning there is nothing that has to be defined in <code>solrconfig.xml</code> - see <a href="implicit-requesthandlers.html#implicit-requesthandlers">Implicit RequestHandlers</a>.</p>
</div>
<div class="paragraph">
<p>The <code>/stream</code> request handler takes one parameter, <code>expr</code>, which is used to specify the streaming expression. For example, this curl command encodes and POSTs a simple <code>search()</code> expression to the <code>/stream</code> handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl --data-urlencode <span style="color: #BA2121">&#39;expr=search(enron_emails,</span>
<span style="color: #BA2121">                                   q=&quot;from:1800flowers*&quot;,</span>
<span style="color: #BA2121">                                   fl=&quot;from, to&quot;,</span>
<span style="color: #BA2121">                                   sort=&quot;from asc&quot;,</span>
<span style="color: #BA2121">                                   qt=&quot;/export&quot;)&#39;</span> http://localhost:8983/solr/enron_emails/stream</code></pre>
</div>
</div>
<div class="paragraph">
<p>Details of the parameters for each function are included below.</p>
</div>
<div class="paragraph">
<p>For the above example the <code>/stream</code> handler responded with the following JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">{</span><span style="color: #BA2121">&quot;result-set&quot;</span><span style="color: #666666">:{</span><span style="color: #BA2121">&quot;docs&quot;</span><span style="color: #666666">:[</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers.133139412@s2u2.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers.93690065@s2u2.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;jtholt@ect.enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers.96749439@s2u2.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;alewis@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@1800flowers.flonetwork.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@1800flowers.flonetwork.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@1800flowers.flonetwork.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@1800flowers.flonetwork.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@1800flowers.flonetwork.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;ebass@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;lcampbel@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;ebass@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;1800flowers@shop2u.com&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">:</span><span style="color: #BA2121">&quot;ebass@enron.com&quot;</span><span style="color: #666666">},</span>
   <span style="color: #666666">{</span><span style="color: #BA2121">&quot;EOF&quot;</span><span style="color: #666666">:</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;RESPONSE_TIME&quot;</span><span style="color: #666666">:33}]}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the last tuple in the above example stream is <code>{"EOF":true,"RESPONSE_TIME":33}</code>. The <code>EOF</code> indicates the end of the stream. To process the JSON response, you&#8217;ll need to use a streaming JSON implementation because streaming expressions are designed to return the entire result set which may have millions of records. In your JSON client you&#8217;ll need to iterate each doc (tuple) and check for the EOF tuple to determine the end of stream.</p>
</div>
<div class="paragraph">
<p>The <a href="https://lucene.apache.org/solr/7_0_0//solr-solrj/org/apache/solr/client/solrj/io/package-summary.html"><code>org.apache.solr.client.solrj.io</code></a> package provides Java classes that compile streaming expressions into streaming API objects. These classes can be used to execute streaming expressions from inside a Java application. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">StreamFactory streamFactory <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> StreamFactory<span style="color: #666666">().</span><span style="color: #7D9029">withCollectionZkHost</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;collection1&quot;</span><span style="color: #666666">,</span> zkServer<span style="color: #666666">.</span><span style="color: #7D9029">getZkAddress</span><span style="color: #666666">())</span>
    <span style="color: #666666">.</span><span style="color: #7D9029">withStreamFunction</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;search&quot;</span><span style="color: #666666">,</span> CloudSolrStream<span style="color: #666666">.</span><span style="color: #7D9029">class</span><span style="color: #666666">)</span>
    <span style="color: #666666">.</span><span style="color: #7D9029">withStreamFunction</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;unique&quot;</span><span style="color: #666666">,</span> UniqueStream<span style="color: #666666">.</span><span style="color: #7D9029">class</span><span style="color: #666666">)</span>
    <span style="color: #666666">.</span><span style="color: #7D9029">withStreamFunction</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;top&quot;</span><span style="color: #666666">,</span> RankStream<span style="color: #666666">.</span><span style="color: #7D9029">class</span><span style="color: #666666">)</span>
    <span style="color: #666666">.</span><span style="color: #7D9029">withStreamFunction</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;group&quot;</span><span style="color: #666666">,</span> ReducerStream<span style="color: #666666">.</span><span style="color: #7D9029">class</span><span style="color: #666666">)</span>
    <span style="color: #666666">.</span><span style="color: #7D9029">withStreamFunction</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;parallel&quot;</span><span style="color: #666666">,</span> ParallelStream<span style="color: #666666">.</span><span style="color: #7D9029">class</span><span style="color: #666666">);</span>

ParallelStream pstream <span style="color: #666666">=</span> <span style="color: #666666">(</span>ParallelStream<span style="color: #666666">)</span>streamFactory<span style="color: #666666">.</span><span style="color: #7D9029">constructStream</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;parallel(collection1, group(search(collection1, q=\&quot;*:*\&quot;, fl=\&quot;id,a_s,a_i,a_f\&quot;, sort=\&quot;a_s asc,a_f asc\&quot;, partitionKeys=\&quot;a_s\&quot;), by=\&quot;a_s asc\&quot;), workers=\&quot;2\&quot;, zkHost=\&quot;&quot;</span><span style="color: #666666">+</span>zkHost<span style="color: #666666">+</span><span style="color: #BA2121">&quot;\&quot;, sort=\&quot;a_s asc\&quot;)&quot;</span><span style="color: #666666">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-DataRequirements">Data Requirements</h3>
<div class="paragraph">
<p>Because streaming expressions relies on the <code>/export</code> handler, many of the field and field type requirements to use <code>/export</code> are also requirements for <code>/stream</code>, particularly for <code>sort</code> and <code>fl</code> parameters. Please see the section <a href="exporting-result-sets.html#exporting-result-sets">Exporting Result Sets</a> for details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="StreamingExpressions-StreamSources">Stream Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stream sources originate streams.</p>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-echo">echo</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-search">search</h3>
<div class="paragraph">
<p>The <code>search</code> function searches a SolrCloud collection and emits a stream of tuples that match the query. This is very similar to a standard Solr query, and uses many of the same parameters.</p>
</div>
<div class="paragraph">
<p>This expression allows you to specify a request hander using the <code>qt</code> parameter. By default, the <code>/select</code> handler is used. The <code>/select</code> handler can be used for simple rapid prototyping of expressions. For production, however, you will most likely want to use the <code>/export</code> handler which is designed to <code>sort</code> and <code>export</code> entire result sets. The <code>/export</code> handler is not used by default because it has stricter requirements then the <code>/select</code> handler so it&#8217;s not as easy to get started working with. To read more about the <code>/export</code> handler requirements review the section <a href="exporting-result-sets.html#exporting-result-sets">Exporting Result Sets</a>.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) the collection being searched.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query to perform on the Solr index.</p>
</li>
<li>
<p><code>fl</code>: (Mandatory) The list of fields to return.</p>
</li>
<li>
<p><code>sort</code>: (Mandatory) The sort criteria.</p>
</li>
<li>
<p><code>zkHost</code>: Only needs to be defined if the collection being searched is found in a different zkHost than the local stream handler.</p>
</li>
<li>
<p><code>qt</code>: Specifies the query type, or request handler, to use. Set this to <code>/export</code> to work with large result sets. The default is <code>/select</code>.</p>
</li>
<li>
<p><code>rows</code>: (Mandatory with the <code>/select</code> handler) The rows parameter specifies how many rows to return. This parameter is only needed with the <code>/select</code> handler (which is the default) since the <code>/export</code> handler always returns all rows.</p>
</li>
<li>
<p><code>partitionKeys</code>: Comma delimited list of keys to partition the search results by. To be used with the parallel function for parallelizing operations across worker nodes. See the <a href="#StreamingExpressions-parallel">parallel</a> function for details.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">expr<span style="color: #666666">=</span>search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
       zkHost<span style="color: #666666">=</span><span style="color: #BA2121">&quot;localhost:9983&quot;</span><span style="color: #666666">,</span>
       qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">,</span>
       q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
       fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
       sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc, a_i asc&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-shuffle_6.6_">shuffle (6.6)</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-jdbc">jdbc</h3>
<div class="paragraph">
<p>The <code>jdbc</code> function searches a JDBC datasource and emits a stream of tuples representing the JDBC result set. Each row in the result set is translated into a tuple and each tuple contains all the cell values for that row.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.1">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>connection</code>: (Mandatory) JDBC formatted connection string to whatever driver you are using.</p>
</li>
<li>
<p><code>sql</code>: (Mandatory) query to pass off to the JDBC endpoint</p>
</li>
<li>
<p><code>sort</code>: (Mandatory) The sort criteria indicating how the data coming out of the JDBC stream is sorted</p>
</li>
<li>
<p><code>driver</code>: The name of the JDBC driver used for the connection. If provided then the driver class will attempt to be loaded into the JVM. If not provided then it is assumed that the driver is already loaded into the JVM. Some drivers require explicit loading so this option is provided.</p>
</li>
<li>
<p><code>[driverProperty]</code>: One or more properties to pass to the JDBC driver during connection. The format is <code>propertyName="propertyValue"</code>. You can provide as many of these properties as you&#8217;d like and they will all be passed to the connection.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-ConnectionsandDrivers">Connections and Drivers</h4>
<div class="paragraph">
<p>Because some JDBC drivers require explicit loading the <code>driver</code> parameter can be used to provide the driver class name. If provided, then during stream construction the driver will be loaded. If the driver cannot be loaded because the class is not found on the classpath, then stream construction will fail.</p>
</div>
<div class="paragraph">
<p>When the JDBC stream is opened it will validate that a driver can be found for the provided connection string. If a driver cannot be found (because it hasn&#8217;t been loaded) then the open will fail.</p>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Datatypes">Datatypes</h4>
<div class="paragraph">
<p>Due to the inherent differences in datatypes across JDBC sources the following datatypes are supported. The table indicates what Java type will be used for a given JDBC type. Types marked as requiring conversion will go through a conversion for each value of that type. For performance reasons the cell data types are only considered when the stream is opened as this is when the converters are created.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JDBC Type</th>
<th class="tableblock halign-left valign-top">Java Type</th>
<th class="tableblock halign-left valign-top">Requires Conversion</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.1">Syntax</h4>
<div class="paragraph">
<p>A basic <code>jdbc</code> expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">jdbc<span style="color: #666666">(</span>
    connection<span style="color: #666666">=</span><span style="color: #BA2121">&quot;jdbc:hsqldb:mem:.&quot;</span><span style="color: #666666">,</span>
    sql<span style="color: #666666">=</span><span style="color: #BA2121">&quot;select NAME, ADDRESS, EMAIL, AGE from PEOPLE where AGE &gt; 25 order by AGE, NAME DESC&quot;</span><span style="color: #666666">,</span>
    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;AGE asc, NAME desc&quot;</span><span style="color: #666666">,</span>
    driver<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.hsqldb.jdbcDriver&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>jdbc</code> expression that passes a property to the driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #408080; font-style: italic">// get_column_name is a property to pass to the hsqldb driver</span>
jdbc<span style="color: #666666">(</span>
    connection<span style="color: #666666">=</span><span style="color: #BA2121">&quot;jdbc:hsqldb:mem:.&quot;</span><span style="color: #666666">,</span>
    sql<span style="color: #666666">=</span><span style="color: #BA2121">&quot;select NAME as FIRST_NAME, ADDRESS, EMAIL, AGE from PEOPLE where AGE &gt; 25 order by AGE, NAME DESC&quot;</span><span style="color: #666666">,</span>
    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;AGE asc, NAME desc&quot;</span><span style="color: #666666">,</span>
    driver<span style="color: #666666">=</span><span style="color: #BA2121">&quot;org.hsqldb.jdbcDriver&quot;</span><span style="color: #666666">,</span>
    get_column_name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;false&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-facet">facet</h3>
<div class="paragraph">
<p>The <code>facet</code> function provides aggregations that are rolled up over buckets. Under the covers the facet function pushes down the aggregation into the search engine using Solr&#8217;s JSON Facet API. This provides sub-second performance for many use cases. The facet function is appropriate for use with a low to moderate number of distinct values in the bucket fields. To support high cardinality aggregations see the rollup function.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.2">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) Collection the facets will be aggregated from.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query to build the aggregations from.</p>
</li>
<li>
<p><code>buckets</code>: (Mandatory) Comma separated list of fields to rollup over. The comma separated list represents the dimensions in a multi-dimensional rollup.</p>
</li>
<li>
<p><code>bucketSorts</code>: Comma separated list of sorts to apply to each dimension in the buckets parameters. Sorts can be on the computed metrics or on the bucket values.</p>
</li>
<li>
<p><code>bucketSizeLimit</code>: The number of buckets to include. This value is applied to each dimension.</p>
</li>
<li>
<p><code>metrics</code>: List of metrics to compute for the buckets. Currently supported metrics are <code>sum(col)</code>, <code>avg(col)</code>, <code>min(col)</code>, <code>max(col)</code>, <code>count(*)</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.2">Syntax</h4>
<div class="paragraph">
<p>Example 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">facet<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
      q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
      buckets<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">,</span>
      bucketSorts<span style="color: #666666">=</span><span style="color: #BA2121">&quot;sum(a_i) desc&quot;</span><span style="color: #666666">,</span>
      bucketSizeLimit<span style="color: #666666">=100,</span>
      sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      sum<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      count<span style="color: #666666">(*))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a facet function with rollups over a single bucket, where the buckets are returned in descending order by the calculated value of the <code>sum(a_i)</code> metric.</p>
</div>
<div class="paragraph">
<p>Example 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">facet<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
      q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
      buckets<span style="color: #666666">=</span><span style="color: #BA2121">&quot;year_i, month_i, day_i&quot;</span><span style="color: #666666">,</span>
      bucketSorts<span style="color: #666666">=</span><span style="color: #BA2121">&quot;year_i desc, month_i desc, day_i desc&quot;</span><span style="color: #666666">,</span>
      bucketSizeLimit<span style="color: #666666">=100,</span>
      sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      sum<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      count<span style="color: #666666">(*))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a facet function with rollups over three buckets, where the buckets are returned in descending order by bucket value.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-features">features</h3>
<div class="paragraph">
<p>The <code>features</code> function extracts the key terms from a text field in a classification training set stored in a SolrCloud collection. It uses an algorithm known as <strong>Information Gain</strong>, to select the important terms from the training set. The <code>features</code> function was designed to work specifically with the <a href="#StreamingExpressions-train">train</a> function, which uses the extracted features to train a text classifier.</p>
</div>
<div class="paragraph">
<p>The <code>features</code> function is designed to work with a training set that provides both positive and negative examples of a class. It emits a tuple for each feature term that is extracted along with the inverse document frequency (IDF) for the term in the training set.</p>
</div>
<div class="paragraph">
<p>The <code>features</code> function uses a query to select the training set from a collection. The IDF for each selected feature is calculated relative to the training set matching the query. This allows multiple training sets to be stored in the same SolrCloud collection without polluting the IDF across training sets.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.3">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) The collection that holds the training set</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query that defines the training set. The IDF for the features will be generated specific to the result set matching the query.</p>
</li>
<li>
<p><code>featureSet</code>: (Mandatory) The name of the feature set. This can be used to retrieve the features if they are stored in a SolrCloud collection.</p>
</li>
<li>
<p><code>field</code>: (Mandatory) The text field to extract the features from.</p>
</li>
<li>
<p><code>outcome</code>: (Mandatory) The field that defines the class, positive or negative</p>
</li>
<li>
<p><code>numTerms</code>: (Mandatory) How many feature terms to extract.</p>
</li>
<li>
<p><code>positiveLabel</code>: (defaults to 1) The value in the outcome field that defines a postive outcome.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.3">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">features<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
         q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
         featureSet<span style="color: #666666">=</span><span style="color: #BA2121">&quot;features1&quot;</span><span style="color: #666666">,</span>
         field<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body&quot;</span><span style="color: #666666">,</span>
         outcome<span style="color: #666666">=</span><span style="color: #BA2121">&quot;out_i&quot;</span><span style="color: #666666">,</span>
         numTerms<span style="color: #666666">=250)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-gatherNodes">gatherNodes</h3>
<div class="paragraph">
<p>The <code>gatherNodes</code> function provides breadth-first graph traversal. For details, see the section <a href="graph-traversal.html#graph-traversal">Graph Traversal</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-model">model</h3>
<div class="paragraph">
<p>The <code>model</code> function retrieves and caches logistic regression text classification models that are stored in a SolrCloud collection. The <code>model</code> function is designed to work with models that are created by the <a href="#StreamingExpressions-train">train function</a>, but can also be used to retrieve text classification models trained outside of Solr, as long as they conform to the specified format. After the model is retrieved it can be used by the <a href="#StreamingExpressions-classify">classify function</a> to classify documents.</p>
</div>
<div class="paragraph">
<p>A single model tuple is fetched and returned based on the <strong>id</strong> parameter. The model is retrieved by matching the <strong>id</strong> parameter with a model name in the index. If more then one iteration of the named model is stored in the index, the highest iteration is selected.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Caching">Caching</h4>
<div class="paragraph">
<p>The <code>model</code> function has an internal LRU (least-recently-used) cache so models do not have to be retrieved with each invocation of the <code>model</code> function. The time to cache for each model ID can be passed as a parameter to the function call. Retrieving a cached model does not reset the time for expiring the model ID in the cache.</p>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-ModelStorage">Model Storage</h4>
<div class="paragraph">
<p>The storage format of the models in Solr is below. The <code>train</code> function outputs the format below so you only need to know schema details if you plan to use the <code>model</code> function with logistic regression models trained outside of Solr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name_s</code> (Single value, String, Stored): The name of the model.</p>
</li>
<li>
<p><code>iteration_i</code> (Single value, Integer, Stored): The iteration number of the model. Solr can store all iterations of the models generated by the train function.</p>
</li>
<li>
<p><code>terms_ss</code> (Multi value, String, Stored: The array of terms/features of the model.</p>
</li>
<li>
<p><code>weights_ds</code> (Multi value, double, Stored): The array of term weights. Each weight corresponds by array index to a term.</p>
</li>
<li>
<p><code>idfs_ds</code> (Multi value, double, Stored): The array of term IDFs (Inverse document frequency). Each IDF corresponds by array index to a term.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.4">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) The collection where the model is stored.</p>
</li>
<li>
<p><code>id</code>: (Mandatory) The id/name of the model. The model function always returns one model. If there are multiple iterations of the name, the highest iteration is returned.</p>
</li>
<li>
<p><code>cacheMillis</code>: (Optional) The amount of time to cache the model in the LRU cache.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.4">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">model<span style="color: #666666">(</span>modelCollection<span style="color: #666666">,</span>
      id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;myModel&quot;</span>
      cacheMillis<span style="color: #666666">=</span><span style="color: #BA2121">&quot;200000&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-random">random</h3>
<div class="paragraph">
<p>The <code>random</code> function searches a SolrCloud collection and emits a pseudo-random set of results that match the query. Each invocation of random will return a different pseudo-random result set.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.5">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) The collection the stats will be aggregated from.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query to build the aggregations from.</p>
</li>
<li>
<p><code>rows</code>: (Mandatory) The number of pseudo-random results to return.</p>
</li>
<li>
<p>fl: (Mandatory) The field list to return.</p>
</li>
<li>
<p><code>fq</code>: (Optional) Filter query</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.5">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">random<span style="color: #666666">(</span>baskets<span style="color: #666666">,</span>
       q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;productID:productX&quot;</span><span style="color: #666666">,</span>
       rows<span style="color: #666666">=</span><span style="color: #BA2121">&quot;100&quot;</span><span style="color: #666666">,</span>
       fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;basketID&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the <code>random</code> function is searching the baskets collections for all rows where "productID:productX". It will return 100 pseudo-random results. The field list returned is the basketID.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-significantTerms">significantTerms</h3>
<div class="paragraph">
<p>The <code>significantTerms</code> function queries a SolrCloud collection, but instead of returning documents, it returns significant terms found in documents in the result set. The <code>significantTerms</code> function scores terms based on how frequently they appear in the result set and how rarely they appear in the entire corpus. The <code>significantTerms</code> function emits a tuple for each term which contains the term, the score, the foreground count and the background count. The foreground count is how many documents the term appears in in the result set. The background count is how many documents the term appears in in the entire corpus. The foreground and background counts are global for the collection.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.6">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) The collection that the function is run on.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query that describes the foreground document set.</p>
</li>
<li>
<p><code>limit</code>: (Optional, Default 20) The max number of terms to return.</p>
</li>
<li>
<p><code>minDocFreq</code>: (Optional, Defaults to 5 documents) The minimum number of documents the term must appear in on a shard. This is a float value. If greater then 1.0 then it&#8217;s considered the absolute number of documents. If less then 1.0 it&#8217;s treated as a percentage of documents.</p>
</li>
<li>
<p><code>maxDocFreq</code>: (Optional, Defaults to 30% of documents) The maximum number of documents the term can appear in on a shard. This is a float value. If greater then 1.0 then it&#8217;s considered the absolute number of documents. If less then 1.0 it&#8217;s treated as a percentage of documents.</p>
</li>
<li>
<p><code>minTermLength</code>: (Optional, Default 4) The minimum length of the term to be considered significant.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.6">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">significantTerms<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
                 q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body:Solr&quot;</span><span style="color: #666666">,</span>
                 minDocFreq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;10&quot;</span><span style="color: #666666">,</span>
                 maxDocFreq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;.20&quot;</span><span style="color: #666666">,</span>
                 minTermLength<span style="color: #666666">=</span><span style="color: #BA2121">&quot;5&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the <code>significantTerms</code> function is querying <code>collection1</code> and returning at most 50 significant terms that appear in 10 or more documents but not more then 20% of the corpus.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-shortestPath">shortestPath</h3>
<div class="paragraph">
<p>The <code>shortestPath</code> function is an implementation of a shortest path graph traversal. The <code>shortestPath</code> function performs an iterative breadth-first search through an unweighted graph to find the shortest paths between two nodes in a graph. The <code>shortestPath</code> function emits a tuple for each path found. Each tuple emitted will contain a <code>path</code> key which points to a <code>List</code> of nodeIDs comprising the path.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.7">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) The collection that the topic query will be run on.</p>
</li>
<li>
<p><code>from</code>: (Mandatory) The nodeID to start the search from</p>
</li>
<li>
<p><code>to</code>: (Mandatory) The nodeID to end the search at</p>
</li>
<li>
<p><code>edge</code>: (Mandatory) Syntax: <code>from_field=to_field</code>. The <code>from_field</code> defines which field to search from. The <code>to_field</code> defines which field to search to. See example below for a detailed explanation.</p>
</li>
<li>
<p><code>threads</code>: (Optional : Default 6) The number of threads used to perform the partitioned join in the traversal.</p>
</li>
<li>
<p><code>partitionSize</code>: (Optional : Default 250) The number of nodes in each partition of the join.</p>
</li>
<li>
<p><code>fq</code>: (Optional) Filter query</p>
</li>
<li>
<p><code>maxDepth</code>: (Mandatory) Limits to the search to a maximum depth in the graph.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.7">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">shortestPath<span style="color: #666666">(</span>collection<span style="color: #666666">,</span>
             from<span style="color: #666666">=</span><span style="color: #BA2121">&quot;john@company.com&quot;</span><span style="color: #666666">,</span>
             to<span style="color: #666666">=</span><span style="color: #BA2121">&quot;jane@company.com&quot;</span><span style="color: #666666">,</span>
             edge<span style="color: #666666">=</span><span style="color: #BA2121">&quot;from_address=to_address&quot;</span><span style="color: #666666">,</span>
             threads<span style="color: #666666">=</span><span style="color: #BA2121">&quot;6&quot;</span><span style="color: #666666">,</span>
             partitionSize<span style="color: #666666">=</span><span style="color: #BA2121">&quot;300&quot;</span><span style="color: #666666">,</span>
             fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;limiting query&quot;</span><span style="color: #666666">,</span>
             maxDepth<span style="color: #666666">=</span><span style="color: #BA2121">&quot;4&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above performs a breadth-first search to find the shortest paths in an unweighted, directed graph.</p>
</div>
<div class="paragraph">
<p>The search starts from the nodeID "<a href="mailto:john@company.com">john@company.com</a>" in the <code>from_address</code> field and searches for the nodeID "<a href="mailto:jane@company.com">jane@company.com</a>" in the <code>to_address</code> field. This search is performed iteratively until the <code>maxDepth</code> has been reached. Each level in the traversal is implemented as a parallel partitioned nested loop join across the entire collection. The <code>threads</code> parameter controls the number of threads performing the join at each level, while the <code>partitionSize</code> parameter controls the of number of nodes in each join partition. The <code>maxDepth</code> parameter controls the number of levels to traverse. <code>fq</code> is a limiting query applied to each level in the traversal.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-stats">stats</h3>
<div class="paragraph">
<p>The <code>stats</code> function gathers simple aggregations for a search result set. The stats function does not support rollups over buckets, so the stats stream always returns a single tuple with the rolled up stats. Under the covers the stats function pushes down the generation of the stats into the search engine using the StatsComponent. The stats function currently supports the following metrics: <code>count(*)</code>, <code>sum()</code>, <code>avg()</code>, <code>min()</code>, and <code>max()</code>.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.8">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) Collection the stats will be aggregated from.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query to build the aggregations from.</p>
</li>
<li>
<p><code>metrics</code>: (Mandatory) The metrics to include in the result tuple. Current supported metrics are <code>sum(col)</code>, <code>avg(col)</code>, <code>min(col)</code>, <code>max(col)</code> and <code>count(*)</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.8">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">stats<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
      q<span style="color: #666666">=*:*,</span>
      sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      sum<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      min<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      max<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
      avg<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
      count<span style="color: #666666">(*))</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-train">train</h3>
<div class="paragraph">
<p>The <code>train</code> function trains a Logistic Regression text classifier on a training set stored in a SolrCloud collection. It uses a parallel iterative, batch Gradient Descent approach to train the model. The training algorithm is embedded inside Solr so with each iteration only the model is streamed across the network.</p>
</div>
<div class="paragraph">
<p>The <code>train</code> function wraps a <a href="#StreamingExpressions-features">features</a> function which provides the terms and inverse document frequency (IDF) used to train the model. The <code>train</code> function operates over the same training set as the <code>features</code> function, which includes both positive and negative examples of the class.</p>
</div>
<div class="paragraph">
<p>With each iteration the <code>train</code> function emits a tuple with the model. The model contains the feature terms, weights, and the confusion matrix for the model. The optimized model can then be used to classify documents based on their feature terms.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.9">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: (Mandatory) Collection that holds the training set</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The query that defines the training set. The IDF for the features will be generated on the</p>
</li>
<li>
<p><code>name</code>: (Mandatory) The name of model. This can be used to retrieve the model if they stored in a Solr Cloud collection.</p>
</li>
<li>
<p><code>field</code>: (Mandatory) The text field to extract the features from.</p>
</li>
<li>
<p><code>outcome</code>: (Mandatory) The field that defines the class, positive or negative</p>
</li>
<li>
<p><code>maxIterations</code>: (Mandatory) How many training iterations to perform.</p>
</li>
<li>
<p><code>positiveLabel</code>: (defaults to 1) The value in the outcome field that defines a positive outcome.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.9">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">train<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
      features<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span> featureSet<span style="color: #666666">=</span><span style="color: #BA2121">&quot;first&quot;</span><span style="color: #666666">,</span> field<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body&quot;</span><span style="color: #666666">,</span> outcome<span style="color: #666666">=</span><span style="color: #BA2121">&quot;out_i&quot;</span><span style="color: #666666">,</span> numTerms<span style="color: #666666">=250),</span>
      q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
      name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;model1&quot;</span><span style="color: #666666">,</span>
      field<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body&quot;</span><span style="color: #666666">,</span>
      outcome<span style="color: #666666">=</span><span style="color: #BA2121">&quot;out_i&quot;</span><span style="color: #666666">,</span>
      maxIterations<span style="color: #666666">=100)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-topic">topic</h3>
<div class="paragraph">
<p>The <code>topic</code> function provides publish/subscribe messaging capabilities built on top of SolrCloud. The topic function allows users to subscribe to a query. The function then provides one-time delivery of new or updated documents that match the topic query. The initial call to the topic function establishes the checkpoints for the specific topic ID. Subsequent calls to the same topic ID will return documents added or updated after the initial checkpoint. Each run of the topic query updates the checkpoints for the topic ID. Setting the initialCheckpoint parameter to 0 will cause the topic to process all documents in the index that match the topic query.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The topic function should be considered in beta until <a href="https://issues.apache.org/jira/browse/SOLR-8709">SOLR-8709</a> is committed and released.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.10">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>checkpointCollection</code>: (Mandatory) The collection where the topic checkpoints are stored.</p>
</li>
<li>
<p><code>collection</code>: (Mandatory) The collection that the topic query will be run on.</p>
</li>
<li>
<p><code>id</code>: (Mandatory) The unique ID for the topic. The checkpoints will be saved under this id.</p>
</li>
<li>
<p><code>q</code>: (Mandatory) The topic query.</p>
</li>
<li>
<p><code>fl</code>: (Mandatory) The field list returned by the topic function.</p>
</li>
<li>
<p><code>initialCheckpoint</code>: (Optional) Sets the initial Solr <code><em>version</em></code> number to start reading from the queue. If not set, it defaults to the highest version in the index. Setting to 0 will process all records that match query in the index.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.10">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">topic<span style="color: #666666">(</span>checkpointCollection<span style="color: #666666">,</span>
      collection<span style="color: #666666">,</span>
      id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;uniqueId&quot;</span><span style="color: #666666">,</span>
      q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;topic query&quot;</span><span style="color: #666666">,</span>
      fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id, name, country&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="StreamingExpressions-StreamDecorators">Stream Decorators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stream decorators wrap other stream functions or perform operations on the stream.</p>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-cartesianProduct_6.6_">cartesianProduct (6.6)</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-classify">classify</h3>
<div class="paragraph">
<p>The <code>classify</code> function classifies tuples using a logistic regression text classification model. It was designed specifically to work with models trained using the <a href="#StreamingExpressions-tr">train function</a>. The <code>classify</code> function uses the <a href="#StreamingExpressions-m">model function</a> to retrieve a stored model and then scores a stream of tuples using the model. The tuples read by the classifier must contain a text field that can be used for classification. The classify function uses a Lucene analyzer to extract the features from the text so the model can be applied. By default the <code>classify</code> function looks for the analyzer using the name of text field in the tuple. If the Solr schema on the worker node does not contain this field, the analyzer can be looked up in another field by specifying the <code>analyzerField</code> parameter.</p>
</div>
<div class="paragraph">
<p>Each tuple that is classified is assigned two scores:</p>
</div>
<div class="paragraph">
<p><strong>probability_d</strong>: A float between 0 and 1 which describes the probability that the tuple belongs to the class. This is useful in the classification use case.</p>
</div>
<div class="paragraph">
<p><strong>score_d</strong>: The score of the document that has not be squashed between 0 and 1. The score may be positive or negative. The higher the score the better the document fits the class. This un-squashed score will be useful in query re-ranking and recommendation use cases. This score is particularly useful when multiple high ranking documents have a probability_d score of 1, which won&#8217;t provide a meaningful ranking between documents.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.11">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>model expression</code>: (Mandatory) Retrieves the stored logistic regression model.</p>
</li>
<li>
<p><code>field</code>: (Mandatory) The field in the tuples to apply the classifier to. By default the analyzer for this field in the schema will be used extract the features.</p>
</li>
<li>
<p><code>analyzerField</code>: (Optional) Specifies a different field to find the analyzer from in the schema.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.11"><strong>Syntax</strong></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">classify<span style="color: #666666">(</span>model<span style="color: #666666">(</span>modelCollection<span style="color: #666666">,</span>
             id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;model1&quot;</span><span style="color: #666666">,</span>
             cacheMillis<span style="color: #666666">=5000),</span>
         search<span style="color: #666666">(</span>contentCollection<span style="color: #666666">,</span>
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(a b c)&quot;</span><span style="color: #666666">,</span>
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text_t, id&quot;</span><span style="color: #666666">,</span>
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id asc&quot;</span><span style="color: #666666">),</span>
             field<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text_t&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the <code>classify expression</code> is retrieving the model using the <code>model</code> function. It is then classifying tuples returned by the <code>search</code> function. The <code>text_t</code> field is used for the text classification and the analyzer for the <code>text_t</code> field in the Solr schema is used to analyze the text and extract the features.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-commit">commit</h3>
<div class="paragraph">
<p>The <code>commit</code> function wraps a single stream (A) and given a collection and batch size will send commit messages to the collection when the batch size is fulfilled or the end of stream is reached. A commit stream is used most frequently with an update stream and as such the commit will take into account possible summary tuples coming from the update stream. All tuples coming into the commit stream will be returned out of the commit stream - no tuples will be dropped and no tuples will be added.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.12">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: The collection to send commit messages to (required)</p>
</li>
<li>
<p><code>batchSize</code>: The commit batch size, sends commit message when batch size is hit. If not provided (or provided as value 0) then a commit is only sent at the end of the incoming stream.</p>
</li>
<li>
<p><code>waitFlush</code>: The value passed directly to the commit handler (true/false, default: false)</p>
</li>
<li>
<p><code>waitSearcher</code>: The value passed directly to the commit handler (true/false, default: false)</p>
</li>
<li>
<p><code>softCommit</code>: The value passed directly to the commit handler (true/false, default: false)</p>
</li>
<li>
<p><code>StreamExpression for StreamA</code> (required)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.12">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">commit<span style="color: #666666">(</span>
    destinationCollection<span style="color: #666666">,</span>
    batchSize<span style="color: #666666">=2,</span>
    update<span style="color: #666666">(</span>
        destinationCollection<span style="color: #666666">,</span>
        batchSize<span style="color: #666666">=5,</span>
        search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f,s_multi,i_multi&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc, a_i asc&quot;</span><span style="color: #666666">)</span>
    <span style="color: #666666">)</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-complement">complement</h3>
<div class="paragraph">
<p>The <code>complement</code> function wraps two streams (A and B) and emits tuples from A which do not exist in B. The tuples are emitted in the order in which they appear in stream A. Both streams must be sorted by the fields being used to determine equality (using the <code>on</code> parameter).</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.13">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamA</code></p>
</li>
<li>
<p><code>StreamExpression for StreamB</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between A and B. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.13">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">complement<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setA <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setB <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i&quot;</span>
<span style="color: #666666">)</span>

complement<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setA <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setB <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i,a_s&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-daemon">daemon</h3>
<div class="paragraph">
<p>The <code>daemon</code> function wraps another function and runs it at intervals using an internal thread. The <code>daemon</code> function can be used to provide both continuous push and pull streaming.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Continuouspushstreaming">Continuous push streaming</h4>
<div class="paragraph">
<p>With continuous push streaming the <code>daemon</code> function wraps another function and is then sent to the <code>/stream</code> handler for execution. The <code>/stream</code> handler recognizes the <code>daemon</code> function and keeps it resident in memory, so it can run its internal function at intervals.</p>
</div>
<div class="paragraph">
<p>In order to facilitate the pushing of tuples, the <code>daemon</code> function must wrap another stream decorator that pushes the tuples somewhere. One example of this is the <code>update</code> function, which wraps a stream and sends the tuples to another SolrCloud collection for indexing.</p>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.14">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">daemon<span style="color: #666666">(</span>id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;uniqueId&quot;</span><span style="color: #666666">,</span>
       runInterval<span style="color: #666666">=</span><span style="color: #BA2121">&quot;1000&quot;</span><span style="color: #666666">,</span>
       terminate<span style="color: #666666">=</span><span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">,</span>
       update<span style="color: #666666">(</span>destinationCollection<span style="color: #666666">,</span>
              batchSize<span style="color: #666666">=100,</span>
              topic<span style="color: #666666">(</span>checkpointCollection<span style="color: #666666">,</span>
                    topicCollection<span style="color: #666666">,</span>
                    q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;topic query&quot;</span><span style="color: #666666">,</span>
                    fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id, title, abstract, text&quot;</span><span style="color: #666666">,</span>
                    id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;topicId&quot;</span><span style="color: #666666">,</span>
                    initialCheckpoint<span style="color: #666666">=0)</span>
               <span style="color: #666666">)</span>
        <span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample code above shows a <code>daemon</code> function wrapping an <code>update</code> function, which is wrapping a <code>topic</code> function. When this expression is sent to the <code>/stream</code> handler, the <code>/stream</code> hander sees the <code>daemon</code> function and keeps it in memory where it will run at intervals. In this particular example, the <code>daemon</code> function will run the <code>update</code> function every second. The <code>update</code> function is wrapping a <a href="#StreamingExpressions-topic"><code>topic</code> function</a>, which will stream tuples that match the <code>topic</code> function query in batches. Each subsequent call to the topic will return the next batch of tuples for the topic. The <code>update</code> function will send all the tuples matching the topic to another collection to be indexed. The <code>terminate</code> parameter tells the daemon to terminate when the <code>topic</code> function stops sending tuples.</p>
</div>
<div class="paragraph">
<p>The effect of this is to push documents that match a specific query into another collection. Custom push functions can be plugged in that push documents out of Solr and into other systems, such as Kafka or an email system.</p>
</div>
<div class="paragraph">
<p>Push streaming can also be used for continuous background aggregation scenarios where aggregates are rolled up in the background at intervals and pushed to other Solr collections. Another use case is continuous background machine learning model optimization, where the optimized model is pushed to another Solr collection where it can be integrated into queries.</p>
</div>
<div class="paragraph">
<p>The <code>/stream</code> handler supports a small set commands for listing and controlling daemon functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #A0A000">http:</span><span style="color: #408080; font-style: italic">//localhost:8983/collection/stream?action=list</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will provide a listing of the current daemon&#8217;s running on the specific node along with there current state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #A0A000">http:</span><span style="color: #408080; font-style: italic">//localhost:8983/collection/stream?action=stop&amp;id=daemonId</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will stop a specific daemon function but leave it resident in memory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #A0A000">http:</span><span style="color: #408080; font-style: italic">//localhost:8983/collection/stream?action=start&amp;id=daemonId</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will start a specific daemon function that has been stopped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #A0A000">http:</span><span style="color: #408080; font-style: italic">//localhost:8983/collection/stream?action=kill&amp;id=daemonId</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will stop a specific daemon function and remove it from memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-ContinousPullStreaming">Continous Pull Streaming</h4>
<div class="paragraph">
<p>The <a href="https://lucene.apache.org/solr/7_0_0//solr-solrj/org/apache/solr/client/solrj/io/stream/DaemonStream.html">DaemonStream</a> java class (part of the SolrJ libraries) can also be embedded in a java application to provide continuous pull streaming. Sample code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">StreamContext context <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> StreamContext<span style="color: #666666">()</span>
SolrClientCache cache <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> SolrClientCache<span style="color: #666666">();</span>
context<span style="color: #666666">.</span><span style="color: #7D9029">setSolrClientCache</span><span style="color: #666666">(</span>cache<span style="color: #666666">);</span>

Map topicQueryParams <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> HashMap<span style="color: #666666">();</span>
topicQueryParams<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;q&quot;</span><span style="color: #666666">,</span><span style="color: #BA2121">&quot;hello&quot;</span><span style="color: #666666">);</span>  <span style="color: #408080; font-style: italic">// The query for the topic</span>
topicQueryparams<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;rows&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;500&quot;</span><span style="color: #666666">);</span> <span style="color: #408080; font-style: italic">// How many rows to fetch during each run</span>
topicQueryparams<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;fl&quot;</span><span style="color: #666666">,</span> <span style="color: #BA2121">&quot;id, &quot;</span>title<span style="color: #BA2121">&quot;); // The field list to return with the documents</span>

<span style="color: #BA2121">TopicStream topicStream = new TopicStream(zkHost,        // Host address for the zookeeper service housing the collections</span>
<span style="color: #BA2121">                                         &quot;</span>checkpoints<span style="color: #BA2121">&quot;,  // The collection to store the topic checkpoints</span>
<span style="color: #BA2121">                                         &quot;</span>topicData<span style="color: #BA2121">&quot;,    // The collection to query for the topic records</span>
<span style="color: #BA2121">                                         &quot;</span>topicId<span style="color: #BA2121">&quot;,      // The id of the topic</span>
<span style="color: #BA2121">                                         -1,             // checkpoint every X tuples, if set -1 it will checkpoint after each run.</span>
<span style="color: #BA2121">                                          topicQueryParams); // The query parameters for the TopicStream</span>

<span style="color: #BA2121">DaemonStream daemonStream = new DaemonStream(topicStream,             // The underlying stream to run.</span>
<span style="color: #BA2121">                                             &quot;</span>daemonId<span style="border: 1px solid #FF0000">&quot;</span><span style="color: #666666">,</span>              <span style="color: #408080; font-style: italic">// The id of the daemon</span>
                                             <span style="color: #666666">1000,</span>                    <span style="color: #408080; font-style: italic">// The interval at which to run the internal stream</span>
                                             <span style="color: #666666">500);</span>                    <span style="color: #408080; font-style: italic">// The internal queue size for the daemon stream. Tuples will be placed in the queue</span>
                                                                      <span style="color: #408080; font-style: italic">// as they are read by the internal internal thread.</span>
                                                                      <span style="color: #408080; font-style: italic">// Calling read() on the daemon stream reads records from the internal queue.</span>

daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">setStreamContext</span><span style="color: #666666">(</span>context<span style="color: #666666">);</span>

daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">open</span><span style="color: #666666">();</span>

<span style="color: #408080; font-style: italic">//Read until it&#39;s time to shutdown the DaemonStream. You can define the shutdown criteria.</span>
<span style="color: #008000; font-weight: bold">while</span><span style="color: #666666">(!</span>shutdown<span style="color: #666666">())</span> <span style="color: #666666">{</span>
    Tuple tuple <span style="color: #666666">=</span> daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">read</span><span style="color: #666666">()</span> <span style="color: #408080; font-style: italic">// This will block until tuples become available from the underlying stream (TopicStream)</span>
                                      <span style="color: #408080; font-style: italic">// The EOF tuple (signaling the end of the stream) will never occur until the DaemonStream has been shutdown.</span>
    <span style="color: #408080; font-style: italic">//Do something with the tuples</span>
<span style="color: #666666">}</span>

<span style="color: #408080; font-style: italic">// Shutdown the DaemonStream.</span>
daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">shutdown</span><span style="color: #666666">();</span>

<span style="color: #408080; font-style: italic">//Read the DaemonStream until the EOF Tuple is found.</span>
<span style="color: #408080; font-style: italic">//This allows the underlying stream to perform an orderly shutdown.</span>

<span style="color: #008000; font-weight: bold">while</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
    Tuple tuple <span style="color: #666666">=</span> daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">read</span><span style="color: #666666">();</span>
    <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>tuple<span style="color: #666666">.</span><span style="color: #7D9029">EOF</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">//Do something with the tuples.</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">//Finally close the stream</span>
daemonStream<span style="color: #666666">.</span><span style="color: #7D9029">close</span><span style="color: #666666">();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-eval">eval</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-executor">executor</h3>
<div class="paragraph">
<p>The <code>executor</code> function wraps a stream source that contains streaming expressions, and executes the expressions in parallel. The <code>executor</code> function looks for the expression in the <code>expr_s</code> field in each tuple. The <code>executor</code> function has an internal thread pool that runs tasks that compile and run expressions in parallel on the same worker node. This function can also be parallelized across worker nodes by wrapping it in the <a href="#StreamingExpressions-parallel"><code>parallel</code></a> function to provide parallel execution of expressions across a cluster.</p>
</div>
<div class="paragraph">
<p>The <code>executor</code> function does not do anything specific with the output of the expressions that it runs. Therefore the expressions that are executed must contain the logic for pushing tuples to their destination. The <a href="#StreamingExpressions-update">update function</a> can be included in the expression being executed to send the tuples to a SolrCloud collection for storage.</p>
</div>
<div class="paragraph">
<p>This model allows for asynchronous execution of jobs where the output is stored in a SolrCloud collection where it can be accessed as the job progresses.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.14">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>threads</code>: (Optional) The number of threads in the executors thread pool for executing expressions.</p>
</li>
<li>
<p><code>StreamExpression</code>: (Mandatory) The stream source which contains the Streaming Expressions to execute.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.15">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">daemon<span style="color: #666666">(</span>id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;myDaemon&quot;</span><span style="color: #666666">,</span>
       terminate<span style="color: #666666">=</span><span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">,</span>
       executor<span style="color: #666666">(</span>threads<span style="color: #666666">=10,</span>
                topic<span style="color: #666666">(</span>checkpointCollection
                      storedExpressions<span style="color: #666666">,</span>
                      q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
                      fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id, expr_s&quot;</span><span style="color: #666666">,</span>
                      initialCheckPoint<span style="color: #666666">=0,</span>
                      id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;myTopic&quot;</span><span style="color: #666666">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above a <a href="#StreamingExpressions-daemon">daemon</a> wraps an executor<strong>,</strong> which wraps a <a href="#StreamingExpressions-topic">topic</a> that is returning tuples with expressions to execute. When sent to the stream handler, the daemon will call the executor at intervals which will cause the executor to read from the topic and execute the expressions found in the <code>expr_s</code> field. The daemon will repeatedly call the executor until all the tuples that match the topic have been iterated, then it will terminate. This is the approach for executing batches of streaming expressions from a <code>topic</code> queue.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-fetch">fetch</h3>
<div class="paragraph">
<p>The <code>fetch</code> function iterates a stream and fetches additional fields and adds them to the tuples. The <code>fetch</code> function fetches in batches to limit the number of calls back to Solr. Tuples streamed from the <code>fetch</code> function will contain the original fields and the additional fields that were fetched. The <code>fetch</code> function supports one-to-one fetches. Many-to-one fetches, where the stream source contains duplicate keys, will also work, but one-to-many fetches are currently not supported by this function.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.15">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Collection</code>: (Mandatory) The collection to fetch the fields from.</p>
</li>
<li>
<p><code>StreamExpression</code>: (Mandatory) The stream source for the fetch function.</p>
</li>
<li>
<p><code>fl</code>: (Mandatory) The fields to be fetched.</p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between stream source and fetched records. Formatted as <code>on="fieldNameInTuple=fieldNameInCollection"</code>.</p>
</li>
<li>
<p><code>batchSize</code>: (Optional) The batch fetch size.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.16">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">fetch<span style="color: #666666">(</span>addresses<span style="color: #666666">,</span>
      search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;username, firstName, lastName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;username asc&quot;</span><span style="color: #666666">),</span>
      fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;streetAddress, city, state, country, zip&quot;</span><span style="color: #666666">,</span>
      on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;username=userId&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above fetches addresses for users by matching the username in the tuple with the userId field in the addresses collection.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-having">having</h3>
<div class="paragraph">
<p>The <code>having</code> expression wraps a stream and applies a boolean operation to each tuple. It emits only tuples for which the boolean operation returns <strong>true</strong>.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.16">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code>: (Mandatory) The stream source for the having function.</p>
</li>
<li>
<p><code>booleanEvaluator</code>: (Madatory) The following boolean operations are supported: <strong>eq</strong> (equals), <strong>gt</strong> (greater than), <strong>lt</strong> (less than), <strong>gteq</strong> (greater than or equal to), <strong>lteq</strong> (less than or equal to), <strong>and</strong>, <strong>or, eor</strong> (exclusive or), and <strong>not</strong>. Boolean evaluators can be nested with other evaluators to form complex boolean logic.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The comparison evaluators compare the value in a specific field with a value, whether a string, number, or boolean. For example: <strong>eq</strong>(field1, 10), returns true if <strong>field1</strong> is equal to 10.</p>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.17">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">having<span style="color: #666666">(</span>rollup<span style="color: #666666">(</span>over<span style="color: #666666">=</span>a_s<span style="color: #666666">,</span>
              sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
              search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
                     q<span style="color: #666666">=*:*,</span>
                     fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
                     sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s asc&quot;</span><span style="color: #666666">)),</span>
       and<span style="color: #666666">(</span>gt<span style="color: #666666">(</span>sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span> <span style="color: #666666">100),</span> lt<span style="color: #666666">(</span>sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span> <span style="color: #666666">110)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>having</code> expression iterates the aggregated tuples from the <code>rollup</code> expression and emits all tuples where the field 'sum(a_i)' is greater then 100 and less then 110.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-leftOuterJoin">leftOuterJoin</h3>
<div class="paragraph">
<p>The <code>leftOuterJoin</code> function wraps two streams, Left and Right, and emits tuples from Left. If there is a tuple in Right equal (as defined by <code>on</code>) then the values in that tuple will be included in the emitted tuple. An equal tuple in Right <strong>need not</strong> exist for the Left tuple to be emitted. This supports one-to-one, one-to-many, many-to-one, and many-to-many left outer join scenarios. The tuples are emitted in the order in which they appear in the Left stream. Both streams must be sorted by the fields being used to determine equality (using the <code>on</code> parameter). If both tuples contain a field of the same name then the value from the Right stream will be used in the emitted tuple.</p>
</div>
<div class="paragraph">
<p>You can wrap the incoming streams with a <code>select</code> function to be specific about which field values are included in the emitted tuple.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.17">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamLeft</code></p>
</li>
<li>
<p><code>StreamExpression for StreamRight</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between Left and Right. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.18">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">leftOuterJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId&quot;</span>
<span style="color: #666666">)</span>

leftOuterJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span>

leftOuterJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  select<span style="color: #666666">(</span>
    search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
    ownerId<span style="color: #666666">,</span>
    name as petName
  <span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-hashJoin">hashJoin</h3>
<div class="paragraph">
<p>The <code>hashJoin</code> function wraps two streams, Left and Right, and for every tuple in Left which exists in Right will emit a tuple containing the fields of both tuples. This supports one-to-one, one-to-many, many-to-one, and many-to-many inner join scenarios. The tuples are emitted in the order in which they appear in the Left stream. The order of the streams does not matter. If both tuples contain a field of the same name then the value from the Right stream will be used in the emitted tuple.</p>
</div>
<div class="paragraph">
<p>You can wrap the incoming streams with a <code>select</code> function to be specific about which field values are included in the emitted tuple.</p>
</div>
<div class="paragraph">
<p>The hashJoin function can be used when the tuples of Left and Right cannot be put in the same order. Because the tuples are out of order this stream functions by reading all values from the Right stream during the open operation and will store all tuples in memory. The result of this is a memory footprint equal to the size of the Right stream.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.18">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamLeft</code></p>
</li>
<li>
<p><code>hashed=StreamExpression for StreamRight</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between Left and Right. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.19">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">hashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId&quot;</span>
<span style="color: #666666">)</span>

hashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span>

hashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>select<span style="color: #666666">(</span>
    search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
    ownerId<span style="color: #666666">,</span>
    name as petName
  <span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-innerJoin">innerJoin</h3>
<div class="paragraph">
<p>Wraps two streams Left and Right and for every tuple in Left which exists in Right will emit a tuple containing the fields of both tuples. This supports one-one, one-many, many-one, and many-many inner join scenarios. The tuples are emitted in the order in which they appear in the Left stream. Both streams must be sorted by the fields being used to determine equality (the 'on' parameter). If both tuples contain a field of the same name then the value from the Right stream will be used in the emitted tuple. You can wrap the incoming streams with a select(&#8230;&#8203;) to be specific about which field values are included in the emitted tuple.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.19">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamLeft</code></p>
</li>
<li>
<p><code>StreamExpression for StreamRight</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between Left and Right. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.20">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">innerJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId&quot;</span>
<span style="color: #666666">)</span>

innerJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span>

innerJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  select<span style="color: #666666">(</span>
    search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
    ownerId<span style="color: #666666">,</span>
    name as petName
  <span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-intersect">intersect</h3>
<div class="paragraph">
<p>The <code>intersect</code> function wraps two streams, A and B, and emits tuples from A which <strong>DO</strong> exist in B. The tuples are emitted in the order in which they appear in stream A. Both streams must be sorted by the fields being used to determine equality (the <code>on</code> parameter). Only tuples from A are emitted.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.20">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamA</code></p>
</li>
<li>
<p><code>StreamExpression for StreamB</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between A and B. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.21">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">intersect<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setA <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setB <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i&quot;</span>
<span style="color: #666666">)</span>

intersect<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setA <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=</span>a_s<span style="color: #666666">:(</span>setB <span style="color: #666666">||</span> setAB<span style="color: #666666">),</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i asc, a_s asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_i,a_s&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-merge">merge</h3>
<div class="paragraph">
<p>The <code>merge</code> function merges two or more streaming expressions and maintains the ordering of the underlying streams. Because the order is maintained, the sorts of the underlying streams must line up with the on parameter provided to the merge function.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.21">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression A</code></p>
</li>
<li>
<p><code>StreamExpression B</code></p>
</li>
<li>
<p><code>Optional StreamExpression C,D,&#8230;&#8203;.Z</code></p>
</li>
<li>
<p><code>on</code>: Sort criteria for performing the merge. Of the form <code>fieldName order</code> where order is <code>asc</code> or <code>desc</code>. Multiple fields can be provided in the form <code>fieldA order, fieldB order</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.22">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="border: 1px solid #FF0000">#</span> Merging two stream expressions together
<span style="color: #0000FF">merge</span><span style="color: #666666">(</span>
      search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(0 3 4)&quot;</span><span style="color: #666666">,</span>
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc&quot;</span><span style="color: #666666">),</span>
      search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(1)&quot;</span><span style="color: #666666">,</span>
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc&quot;</span><span style="color: #666666">),</span>
      on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="py"><span style="color: #408080; font-style: italic"># Merging four stream expressions together. Notice that while the sorts of each stream are not identical they are</span>
<span style="color: #408080; font-style: italic"># comparable. That is to say the first N fields in each stream&#39;s sort matches the N fields in the merge&#39;s on clause.</span>
merge(
      search(collection1,
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(0 3 4)&quot;</span>,
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,fieldA,fieldB,fieldC&quot;</span>,
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;fieldA asc, fieldB desc&quot;</span>),
      search(collection1,
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(1)&quot;</span>,
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,fieldA&quot;</span>,
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;fieldA asc&quot;</span>),
      search(collection2,
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(10 11 13)&quot;</span>,
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,fieldA,fieldC&quot;</span>,
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;fieldA asc&quot;</span>),
      search(collection3,
             q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id:(987)&quot;</span>,
             fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,fieldA,fieldC&quot;</span>,
             sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;fieldA asc&quot;</span>),
      on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;fieldA asc&quot;</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-null">null</h3>
<div class="paragraph">
<p>The null expression is a useful utility function for understanding bottlenecks when performing parallel relational algebra (joins, intersections, rollups etc.). The null function reads all the tuples from an underlying stream and returns a single tuple with the count and processing time. Because the null stream adds minimal overhead of it&#8217;s own, it can be used to isolate the performance of Solr&#8217;s /export handler. If the /export handlers performance is not the bottleneck, then the bottleneck is likely occurring in the workers where the stream decorators are running.</p>
</div>
<div class="paragraph">
<p>The null expression can be wrapped by the parallel function and sent to worker nodes. In this scenario each worker will return one tuple with the count of tuples processed on the worker and the timing information for that worker. This gives valuable information such as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As more workers are added does the performance of the /export handler improve or not.</p>
</li>
<li>
<p>Are tuples being evenly distributed across the workers, or is the hash partitioning sending more documents to a single worker.</p>
</li>
<li>
<p>Are all workers processing data at the same speed, or is one of the workers the source of the bottleneck.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.22">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code>: (Mandatory) The expression read by the null function.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.23">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> parallel<span style="color: #666666">(</span>workerCollection<span style="color: #666666">,</span>
          <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">(</span>search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s desc&quot;</span><span style="color: #666666">,</span> qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">,</span> partitionKeys<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">)),</span>
          workers<span style="color: #666666">=</span><span style="color: #BA2121">&quot;20&quot;</span><span style="color: #666666">,</span>
          zkHost<span style="color: #666666">=</span><span style="color: #BA2121">&quot;localhost:9983&quot;</span><span style="color: #666666">,</span>
          sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s desc&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above shows a parallel function wrapping a null function. This will cause the null function to be run in parallel across 20 worker nodes. Each worker will return a single tuple with number of tuples processed and time it took to iterate the tuples.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-outerHashJoin">outerHashJoin</h3>
<div class="paragraph">
<p>The <code>outerHashJoin</code> function wraps two streams, Left and Right, and emits tuples from Left. If there is a tuple in Right equal (as defined by the <code>on</code> parameter) then the values in that tuple will be included in the emitted tuple. An equal tuple in Right <strong>need not</strong> exist for the Left tuple to be emitted. This supports one-to-one, one-to-many, many-to-one, and many-to-many left outer join scenarios. The tuples are emitted in the order in which they appear in the Left stream. The order of the streams does not matter. If both tuples contain a field of the same name then the value from the Right stream will be used in the emitted tuple.</p>
</div>
<div class="paragraph">
<p>You can wrap the incoming streams with a <code>select</code> function to be specific about which field values are included in the emitted tuple.</p>
</div>
<div class="paragraph">
<p>The outerHashJoin stream can be used when the tuples of Left and Right cannot be put in the same order. Because the tuples are out of order, this stream functions by reading all values from the Right stream during the open operation and will store all tuples in memory. The result of this is a memory footprint equal to the size of the Right stream.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.23">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression for StreamLeft</code></p>
</li>
<li>
<p><code>hashed=StreamExpression for StreamRight</code></p>
</li>
<li>
<p><code>on</code>: Fields to be used for checking equality of tuples between Left and Right. Can be of the format <code>on="fieldName"</code>, <code>on="fieldNameInLeft=fieldNameInRight"</code>, or <code>on="fieldName, otherFieldName=rightOtherFieldName"</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.24">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">outerHashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId&quot;</span>
<span style="color: #666666">)</span>

outerHashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span>

outerHashJoin<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId asc&quot;</span><span style="color: #666666">),</span>
  hashed<span style="color: #666666">=</span>select<span style="color: #666666">(</span>
    search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>cat<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;ownerId asc&quot;</span><span style="color: #666666">),</span>
    ownerId<span style="color: #666666">,</span>
    name as petName
  <span style="color: #666666">),</span>
  on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;personId=ownerId&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-parallel">parallel</h3>
<div class="paragraph">
<p>The <code>parallel</code> function wraps a streaming expression and sends it to N worker nodes to be processed in parallel.</p>
</div>
<div class="paragraph">
<p>The parallel function requires that the <code>partitionKeys</code> parameter be provided to the underlying searches. The <code>partitionKeys</code> parameter will partition the search results (tuples) across the worker nodes. Tuples with the same values in the partitionKeys field will be shuffled to the same worker nodes.</p>
</div>
<div class="paragraph">
<p>The parallel function maintains the sort order of the tuples returned by the worker nodes, so the sort criteria of the parallel function must match up with the sort order of the tuples returned by the workers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Worker Collections</div>
<div class="paragraph">
<p>The worker nodes can be from the same collection as the data, or they can be a different collection entirely, even one that only exists for parallel streaming expressions. A worker collection can be any SolrCloud collection that has the <code>/stream</code> handler configured. Unlike normal SolrCloud collections, worker collections don&#8217;t have to hold any data. Worker collections can be empty collections that exist only to execute streaming expressions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.24">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>collection</code>: Name of the worker collection to send the StreamExpression to.</p>
</li>
<li>
<p><code>StreamExpression</code>: Expression to send to the worker collection.</p>
</li>
<li>
<p><code>workers</code>: Number of workers in the worker collection to send the expression to.</p>
</li>
<li>
<p><code>zkHost</code>: (Optional) The ZooKeeper connect string where the worker collection resides.</p>
</li>
<li>
<p><code>sort</code>: The sort criteria for ordering tuples returned by the worker nodes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.25">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> parallel<span style="color: #666666">(</span>workerCollection<span style="color: #666666">,</span>
          reduce<span style="color: #666666">(</span>search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s desc&quot;</span><span style="color: #666666">,</span> partitionKeys<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">),</span>
                 by<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">,</span>
                 group<span style="color: #666666">(</span>sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f desc&quot;</span><span style="color: #666666">,</span> n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;4&quot;</span><span style="color: #666666">)),</span>
          workers<span style="color: #666666">=</span><span style="color: #BA2121">&quot;20&quot;</span><span style="color: #666666">,</span>
          zkHost<span style="color: #666666">=</span><span style="color: #BA2121">&quot;localhost:9983&quot;</span><span style="color: #666666">,</span>
          sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s desc&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above shows a <code>parallel</code> function wrapping a <code>reduce</code> function. This will cause the <code>reduce</code> function to be run in parallel across 20 worker nodes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-priority">priority</h3>
<div class="paragraph">
<p>The <code>priority</code> function is a simple priority scheduler for the <a href="#StreamingExpressions-executor">executor</a> function. The executor function doesn&#8217;t directly have a concept of task prioritization; instead it simply executes tasks in the order that they are read from it&#8217;s underlying stream. The <code>priority</code> function provides the ability to schedule a higher priority task ahead of lower priority tasks that were submitted earlier.</p>
</div>
<div class="paragraph">
<p>The <code>priority</code> function wraps two <a href="#StreamingExpressions-topic">topics</a> that are both emitting tuples that contain streaming expressions to execute. The first topic is considered the higher priority task queue.</p>
</div>
<div class="paragraph">
<p>Each time the <code>priority</code> function is called, it checks the higher priority task queue to see if there are any tasks to execute. If tasks are waiting in the higher priority queue then the priority function will emit the higher priority tasks. If there are no high priority tasks to run, the lower priority queue tasks are emitted.</p>
</div>
<div class="paragraph">
<p>The <code>priority</code> function will only emit a batch of tasks from one of the queues each time it is called. This ensures that no lower priority tasks are executed until the higher priority queue has no tasks to run.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.25">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>topic expression</code>: (Mandatory) the high priority task queue</p>
</li>
<li>
<p><code>topic expression</code>: (Mandatory) the lower priority task queue</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.26">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">daemon<span style="color: #666666">(</span>id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;myDaemon&quot;</span><span style="color: #666666">,</span>
       executor<span style="color: #666666">(</span>threads<span style="color: #666666">=10,</span>
                priority<span style="color: #666666">(</span>topic<span style="color: #666666">(</span>checkpointCollection<span style="color: #666666">,</span> storedExpressions<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;priority:high&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id, expr_s&quot;</span><span style="color: #666666">,</span> initialCheckPoint<span style="color: #666666">=0,</span>id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;highPriorityTasks&quot;</span><span style="color: #666666">),</span>
                         topic<span style="color: #666666">(</span>checkpointCollection<span style="color: #666666">,</span> storedExpressions<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;priority:low&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id, expr_s&quot;</span><span style="color: #666666">,</span> initialCheckPoint<span style="color: #666666">=0,</span>id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;lowPriorityTasks&quot;</span><span style="color: #666666">))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the <code>daemon</code> function is calling the executor iteratively. Each time it&#8217;s called, the <code>executor</code> function will execute the tasks emitted by the <code>priority</code> function. The <code>priority</code> function wraps two topics. The first topic is the higher priority task queue, the second topics is the lower priority topic.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-reduce">reduce</h3>
<div class="paragraph">
<p>The <code>reduce</code> function wraps an internal stream and groups tuples by common fields.</p>
</div>
<div class="paragraph">
<p>Each tuple group is operated on as a single block by a pluggable reduce operation. The group operation provided with Solr implements distributed grouping functionality. The group operation also serves as an example reduce operation that can be referred to when building custom reduce operations.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reduce function relies on the sort order of the underlying stream. Accordingly the sort order of the underlying stream must be aligned with the group by field.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.26">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code>: (Mandatory)</p>
</li>
<li>
<p><code>by</code>: (Mandatory) A comma separated list of fields to group by.</p>
</li>
<li>
<p><code>Reduce Operation</code>: (Mandatory)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.27">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">reduce<span style="color: #666666">(</span>search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s asc, a_f asc&quot;</span><span style="color: #666666">),</span>
       by<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">,</span>
       group<span style="color: #666666">(</span>sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f desc&quot;</span><span style="color: #666666">,</span> n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;4&quot;</span><span style="color: #666666">)</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-rollup">rollup</h3>
<div class="paragraph">
<p>The <code>rollup</code> function wraps another stream function and rolls up aggregates over bucket fields. The rollup function relies on the sort order of the underlying stream to rollup aggregates one grouping at a time. Accordingly, the sort order of the underlying stream must match the fields in the <code>over</code> parameter of the rollup function.</p>
</div>
<div class="paragraph">
<p>The rollup function also needs to process entire result sets in order to perform its aggregations. When the underlying stream is the <code>search</code> function, the <code>/export</code> handler can be used to provide full sorted result sets to the rollup function. This sorted approach allows the rollup function to perform aggregations over very high cardinality fields. The disadvantage of this approach is that the tuples must be sorted and streamed across the network to a worker node to be aggregated. For faster aggregation over low to moderate cardinality fields, the <code>facet</code> function can be used.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.27">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code> (Mandatory)</p>
</li>
<li>
<p><code>over</code>: (Mandatory) A list of fields to group by.</p>
</li>
<li>
<p><code>metrics</code>: (Mandatory) The list of metrics to compute. Currently supported metrics are <code>sum(col)</code>, <code>avg(col)</code>, <code>min(col)</code>, <code>max(col)</code>, <code>count(*)</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.28">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">rollup<span style="color: #666666">(</span>
   search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span> qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s asc&quot;</span><span style="color: #666666">),</span>
   over<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_s&quot;</span><span style="color: #666666">,</span>
   sum<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
   sum<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
   min<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
   min<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
   max<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
   max<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
   avg<span style="color: #666666">(</span>a_i<span style="color: #666666">),</span>
   avg<span style="color: #666666">(</span>a_f<span style="color: #666666">),</span>
   count<span style="color: #666666">(*)</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example about shows the rollup function wrapping the search function. Notice that search function is using the <code>/export</code> handler to provide the entire result set to the rollup stream. Also notice that the search function&#8217;s <strong>sort param</strong> matches up with the rollup&#8217;s <code>over</code> parameter. This allows the rollup function to rollup the over the <code>a_s</code> field, one group at a time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-scoreNodes">scoreNodes</h3>
<div class="paragraph">
<p>See section in <a href="graph-traversal.html#GraphTraversal-UsingthescoreNodesFunctiontoMakeaRecommendation">graph traversal</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-select">select</h3>
<div class="paragraph">
<p>The <code>select</code> function wraps a streaming expression and outputs tuples containing a subset or modified set of fields from the incoming tuples. The list of fields included in the output tuple can contain aliases to effectively rename fields. The select stream supports both operations and evaluators. One can provide a list of operations and evaluators to perform on any fields, such as <code>replace, add, if</code>, etc&#8230;&#8203;.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.28">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code></p>
</li>
<li>
<p><code>fieldName</code>: name of field to include in the output tuple (can include multiple of these), such as <code>outputTuple[fieldName] = inputTuple[fieldName]</code></p>
</li>
<li>
<p><code>fieldName as aliasFieldName</code>: aliased field name to include in the output tuple (can include multiple of these), such as <code>outputTuple[aliasFieldName] = incomingTuple[fieldName]</code></p>
</li>
<li>
<p><code>replace(fieldName, value, withValue=replacementValue)</code>: if <code>incomingTuple[fieldName] == value</code> then <code>outgoingTuple[fieldName]</code> will be set to <code>replacementValue</code>. <code>value</code> can be the string "null" to replace a null value with some other value.</p>
</li>
<li>
<p><code>replace(fieldName, value, withField=otherFieldName)</code>: if <code>incomingTuple[fieldName] == value</code> then <code>outgoingTuple[fieldName]</code> will be set to the value of <code>incomingTuple[otherFieldName]</code>. <code>value</code> can be the string "null" to replace a null value with some other value.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.29">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #408080; font-style: italic">// output tuples with fields teamName, wins, losses, and winPercentages where a null value for wins or losses is translated to the value of 0</span>
select<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,teamName_s,wins,losses&quot;</span><span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id asc&quot;</span><span style="color: #666666">),</span>
  teamName_s as teamName<span style="color: #666666">,</span>
  wins<span style="color: #666666">,</span>
  losses<span style="color: #666666">,</span>
  replace<span style="color: #666666">(</span>wins<span style="color: #666666">,</span><span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span>withValue<span style="color: #666666">=0),</span>
  replace<span style="color: #666666">(</span>losses<span style="color: #666666">,</span><span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span>withValue<span style="color: #666666">=0),</span>
  <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>eq<span style="color: #666666">(0,</span>wins<span style="color: #666666">),</span> <span style="color: #666666">0,</span> div<span style="color: #666666">(</span>add<span style="color: #666666">(</span>wins<span style="color: #666666">,</span>losses<span style="color: #666666">),</span> wins<span style="color: #666666">))</span> as winPercentage
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-sort">sort</h3>
<div class="paragraph">
<p>The <code>sort</code> function wraps a streaming expression and re-orders the tuples. The sort function emits all incoming tuples in the new sort order. The sort function reads all tuples from the incoming stream, re-orders them using an algorithm with <code>O(nlog(n))</code> performance characteristics, where n is the total number of tuples in the incoming stream, and then outputs the tuples in the new sort order. Because all tuples are read into memory, the memory consumption of this function grows linearly with the number of tuples in the incoming stream.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.29">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code></p>
</li>
<li>
<p><code>by</code>: Sort criteria for re-ordering the tuples</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.30">Syntax</h4>
<div class="paragraph">
<p>The expression below finds dog owners and orders the results by owner and pet name. Notice that it uses an efficient innerJoin by first ordering by the person/owner id and then re-orders the final output by the owner and pet names.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">sort<span style="color: #666666">(</span>
  innerJoin<span style="color: #666666">(</span>
    search<span style="color: #666666">(</span>people<span style="color: #666666">,</span> q<span style="color: #666666">=*:*,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,name&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id asc&quot;</span><span style="color: #666666">),</span>
    search<span style="color: #666666">(</span>pets<span style="color: #666666">,</span> q<span style="color: #666666">=</span>type<span style="color: #666666">:</span>dog<span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;owner,petName&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;owner asc&quot;</span><span style="color: #666666">),</span>
    on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id=owner&quot;</span>
  <span style="color: #666666">),</span>
  by<span style="color: #666666">=</span><span style="color: #BA2121">&quot;name asc, petName asc&quot;</span>
<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-top">top</h3>
<div class="paragraph">
<p>The <code>top</code> function wraps a streaming expression and re-orders the tuples. The top function emits only the top N tuples in the new sort order. The top function re-orders the underlying stream so the sort criteria <strong>does not</strong> have to match up with the underlying stream.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.30">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>n</code>: Number of top tuples to return.</p>
</li>
<li>
<p><code>StreamExpression</code></p>
</li>
<li>
<p><code>sort</code>: Sort criteria for selecting the top N tuples.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.31">Syntax</h4>
<div class="paragraph">
<p>The expression below finds the top 3 results of the underlying search. Notice that it reverses the sort order. The top function re-orders the results of the underlying stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">top<span style="color: #666666">(</span>n<span style="color: #666666">=3,</span>
     search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
            q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
            qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">,</span>
            fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
            sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f desc, a_i desc&quot;</span><span style="color: #666666">),</span>
      sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc, a_i asc&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-unique">unique</h3>
<div class="paragraph">
<p>The <code>unique</code> function wraps a streaming expression and emits a unique stream of tuples based on the <code>over</code> parameter. The unique function relies on the sort order of the underlying stream. The <code>over</code> parameter must match up with the sort order of the underlying stream.</p>
</div>
<div class="paragraph">
<p>The unique function implements a non-co-located unique algorithm. This means that records with the same unique <code>over</code> field do not need to be co-located on the same shard. When executed in the parallel, the <code>partitionKeys</code> parameter must be the same as the unique <code>over</code> field so that records with the same keys will be shuffled to the same worker.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.31">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>StreamExpression</code></p>
</li>
<li>
<p><code>over</code>: The unique criteria.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.32">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">unique<span style="color: #666666">(</span>
  search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
         q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">,</span>
         qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">,</span>
         fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f&quot;</span><span style="color: #666666">,</span>
         sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc, a_i asc&quot;</span><span style="color: #666666">),</span>
  over<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-update">update</h3>
<div class="paragraph">
<p>The <code>update</code> function wraps another functions and sends the tuples to a SolrCloud collection for indexing.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.32">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>destinationCollection</code>: (Mandatory) The collection where the tuples will indexed.</p>
</li>
<li>
<p><code>batchSize</code>: (Mandatory) The indexing batch size.</p>
</li>
<li>
<p><code>StreamExpression</code>: (Mandatory)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.33">Syntax</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> update<span style="color: #666666">(</span>destinationCollection<span style="color: #666666">,</span>
        batchSize<span style="color: #666666">=500,</span>
        search<span style="color: #666666">(</span>collection1<span style="color: #666666">,</span>
               q<span style="color: #666666">=*:*,</span>
               fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;id,a_s,a_i,a_f,s_multi,i_multi&quot;</span><span style="color: #666666">,</span>
               sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;a_f asc, a_i asc&quot;</span><span style="color: #666666">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above sends the tuples returned by the <code>search</code> function to the <code>destinationCollection</code> to be indexed.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="StreamingExpressions-StreamEvaluators">Stream Evaluators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stream Evaluators can be used to evaluate (calculate) new values based on other values in a tuple. That newly evaluated value can be put into the tuple (as part of a <code>select(&#8230;&#8203;)</code> clause), used to filter streams (as part of a <code>having(&#8230;&#8203;)</code> clause), and for other things. Evaluators can contain field names, raw values, or other evaluators, giving you the ability to create complex evaluation logic, including conditional if/then choices.</p>
</div>
<div class="paragraph">
<p>In cases where you want to use raw values as part of an evaluation you will need to consider the order of how evaluators are parsed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the parameter can be parsed into a valid number, then it is considered a number. For example, <code>add(3,4.5)</code></p>
</li>
<li>
<p>If the parameter can be parsed into a valid boolean, then it is considered a boolean. For example, <code>eq(true,false)</code></p>
</li>
<li>
<p>If the parameter can be parsed into a valid evaluator, then it is considered an evaluator. For example, <code>eq(add(10,4),add(7,7))</code></p>
</li>
<li>
<p>The parameter is considered a field name, even if it quoted. For example, <code>eq(fieldA,"fieldB")</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you wish to use a raw string as part of an evaluation, you will want to consider using the <code>raw(string)</code> evaluator. This will always return the raw value, no matter what is entered.analyze (6.6)</p>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-abs">abs</h3>
<div class="paragraph">
<p>The <code>abs</code> function will return the absolute value of the provided single parameter. The <code>abs</code> function will fail to execute if the value is non-numeric. If a null value is found then null will be returned as the result.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.33">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.34">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>abs</code> evaluator. Only one parameter is accepted. Returns a numeric value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">abs<span style="color: #666666">(1)</span> <span style="color: #408080; font-style: italic">// 1, not really a good use case for it</span>
abs<span style="color: #666666">(-1)</span> <span style="color: #408080; font-style: italic">// 1, not really a good use case for it</span>
abs<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// absolute value of fieldA + fieldB</span>
abs<span style="color: #666666">(</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// absolute value of fieldA</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-add">add</h3>
<div class="paragraph">
<p>The <code>add</code> function will take 2 or more numeric values and add them together. The <code>add</code> function will fail to execute if any of the values are non-numeric. If a null value is found then null will be returned as the result.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.34">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.35">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>add</code> evaluator. The number and order of these parameters do not matter and is not limited except that at least two parameters are required. Returns a numeric value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">add<span style="color: #666666">(1,2,3,4)</span> <span style="color: #408080; font-style: italic">// 1 + 2 + 3 + 4 == 10</span>
add<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 + value of fieldA</span>
add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,1.4)</span> <span style="color: #408080; font-style: italic">// value of fieldA + 1.4</span>
add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// value of fieldA + value of fieldB + value of fieldC</span>
add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// value of fieldA + (value of fieldA / value of fieldB)</span>
add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span><span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>gt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// if fieldA &gt; fieldB then fieldA + fieldA, else fieldA + fieldB</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-div">div</h3>
<div class="paragraph">
<p>The <code>div</code> function will take two numeric values and divide them. The function will fail to execute if any of the values are non-numeric or null, or the 2nd value is 0. Returns a numeric value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.35">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.36">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>div</code> evaluator. The first value will be divided by the second and as such the second cannot be 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">div<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 / 2</span>
div<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 / fieldA</span>
div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,1.4)</span> <span style="color: #408080; font-style: italic">// fieldA / 1.4</span>
div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// fieldA / (fieldA + fieldB)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-log">log</h3>
<div class="paragraph">
<p>The <code>log</code> function will return the natural log of the provided single parameter. The <code>log</code> function will fail to execute if the value is non-numeric. If a null value is found, then null will be returned as the result.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.36">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.37">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>log</code> evaluator. Only one parameter is accepted. Returns a numeric value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">log<span style="color: #666666">(100)</span>
log<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span>
log<span style="color: #666666">(</span>fieldA<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-mult">mult</h3>
<div class="paragraph">
<p>The <code>mult</code> function will take two or more numeric values and multiply them together. The <code>mult</code> function will fail to execute if any of the values are non-numeric. If a null value is found then null will be returned as the result.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.37">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.38">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>mult</code> evaluator. The number and order of these parameters do not matter and is not limited except that at least two parameters are required. Returns a numeric value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">mult<span style="color: #666666">(1,2,3,4)</span> <span style="color: #408080; font-style: italic">// 1 * 2 * 3 * 4</span>
mult<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 * value of fieldA</span>
mult<span style="color: #666666">(</span>fieldA<span style="color: #666666">,1.4)</span> <span style="color: #408080; font-style: italic">// value of fieldA * 1.4</span>
mult<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// value of fieldA * value of fieldB * value of fieldC</span>
mult<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// value of fieldA * (value of fieldA / value of fieldB)</span>
mult<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span><span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>gt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// if fieldA &gt; fieldB then fieldA * fieldA, else fieldA * fieldB</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-sub">sub</h3>
<div class="paragraph">
<p>The <code>sub</code> function will take 2 or more numeric values and subtract them, from left to right. The sub function will fail to execute if any of the values are non-numeric. If a null value is found then null will be returned as the result.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.38">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Number | Number Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.39">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>sub</code> evaluator. The number of these parameters does not matter and is not limited except that at least two parameters are required. Returns a numeric value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">sub<span style="color: #666666">(1,2,3,4)</span> <span style="color: #408080; font-style: italic">// 1 - 2 - 3 - 4</span>
sub<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 - value of fieldA</span>
sub<span style="color: #666666">(</span>fieldA<span style="color: #666666">,1.4)</span> <span style="color: #408080; font-style: italic">// value of fieldA - 1.4</span>
sub<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// value of fieldA - value of fieldB - value of fieldC</span>
sub<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// value of fieldA - (value of fieldA / value of fieldB)</span>
<span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>gt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>sub<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>sub<span style="color: #666666">(</span>fieldB<span style="color: #666666">,</span>fieldA<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// if fieldA &gt; fieldB then fieldA - fieldB, else fieldB - field</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-pow"><strong>pow</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-mod"><strong>mod</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-ceil"><strong>ceil</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-floor"><strong>floor</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-sin"><strong>sin</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-asin"><strong>asin</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-sinh"><strong>sinh</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-cos"><strong>cos</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-acos"><strong>acos</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-atan"><strong>atan</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-round"><strong>round</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-sqrt"><strong>sqrt</strong></h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-cbrt"><strong>cbrt</strong></h3>
<div class="paragraph">
<p><strong>and</strong></p>
</div>
<div class="paragraph">
<p>The <code>and</code> function will return the logical AND of at least 2 boolean parameters. The function will fail to execute if any parameters are non-boolean or null. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.39">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.40">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>and</code> evaluator. At least two parameters are required, but there is no limit to how many you can use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">and<span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true &amp;&amp; fieldA</span>
and<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// fieldA &amp;&amp; fieldB</span>
and<span style="color: #666666">(</span>or<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// (fieldA || fieldB) &amp;&amp; fieldC</span>
and<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">,</span>or<span style="color: #666666">(</span>fieldD<span style="color: #666666">,</span>fieldE<span style="color: #666666">),</span>fieldF<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-eq">eq</h3>
<div class="paragraph">
<p>The <code>eq</code> function will return whether all the parameters are equal, as per Java&#8217;s standard <code>equals(&#8230;&#8203;)</code> function. The function accepts parameters of any type, but will fail to execute if all the parameters are not of the same type. That is, all are Boolean, all are String, all are Numeric. If any any parameters are null and there is at least one parameter that is not null then false will be returned. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.40">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.41">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>eq</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">eq<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 == 2</span>
eq<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 == fieldA</span>
eq<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>val<span style="color: #666666">(</span>foo<span style="color: #666666">))</span> fieldA <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;foo&quot;</span>
eq<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),6)</span> <span style="color: #408080; font-style: italic">// fieldA + fieldB == 6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-eor">eor</h3>
<div class="paragraph">
<p>The <code>eor</code> function will return the logical exclusive or of at least two boolean parameters. The function will fail to execute if any parameters are non-boolean or null. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.41">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.42">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>eor</code> evaluator. At least two parameters are required, but there is no limit to how many you can use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">eor<span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true iff fieldA is false</span>
eor<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true iff either fieldA or fieldB is true but not both</span>
eor<span style="color: #666666">(</span>eq<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>eq<span style="color: #666666">(</span>fieldC<span style="color: #666666">,</span>fieldD<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// true iff either fieldA == fieldB or fieldC == fieldD but not both</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-gteq">gteq</h3>
<div class="paragraph">
<p>The <code>gteq</code> function will return whether the first parameter is greater than or equal to the second parameter. The function accepts numeric and string parameters, but will fail to execute if all the parameters are not of the same type. That is, all are String or all are Numeric. If any any parameters are null then an error will be raised. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.42">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.43">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>gteq</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gteq<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 &gt;= 2</span>
gteq<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 &gt;= fieldA</span>
gteq<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>val<span style="color: #666666">(</span>foo<span style="color: #666666">))</span> fieldA <span style="color: #666666">&gt;=</span> <span style="color: #BA2121">&quot;foo&quot;</span>
gteq<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),6)</span> <span style="color: #408080; font-style: italic">// fieldA + fieldB &gt;= 6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-gt">gt</h3>
<div class="paragraph">
<p>The <code>gt</code> function will return whether the first parameter is greater than the second parameter. The function accepts numeric or string parameters, but will fail to execute if all the parameters are not of the same type. That is, all are String or all are Numeric. If any any parameters are null then an error will be raised. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.43">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.44">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>gt</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gt<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 &gt; 2</span>
gt<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 &gt; fieldA</span>
gt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>val<span style="color: #666666">(</span>foo<span style="color: #666666">))</span> fieldA <span style="color: #666666">&gt;</span> <span style="color: #BA2121">&quot;foo&quot;</span>
gt<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),6)</span> <span style="color: #408080; font-style: italic">// fieldA + fieldB &gt; 6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-if">if</h3>
<div class="paragraph">
<p>The <code>if</code> function works like a standard conditional if/then statement. If the first parameter is true, then the second parameter will be returned, else the third parameter will be returned. The function accepts a boolean as the first parameter and anything as the second and third parameters. An error will occur if the first parameter is not a boolean or is null.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.44">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Boolean Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.45">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>if</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// if fieldA is true then fieldB else fieldC</span>
<span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>gt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,5),</span> fieldA<span style="color: #666666">,</span> <span style="color: #666666">5)</span> <span style="color: #408080; font-style: italic">// if fieldA &gt; 5 then fieldA else 5</span>
<span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span>eq<span style="color: #666666">(</span>fieldB<span style="color: #666666">,</span><span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">),</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">,</span> div<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// if fieldB is null then null else fieldA / fieldB</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-lteq">lteq</h3>
<div class="paragraph">
<p>The l`teq` function will return whether the first parameter is less than or equal to the second parameter. The function accepts numeric and string parameters, but will fail to execute if all the parameters are not of the same type. That is, all are String or all are Numeric. If any any parameters are null then an error will be raised. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.45">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.46">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>lteq</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">lteq<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 &lt;= 2</span>
lteq<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 &lt;= fieldA</span>
lteq<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>val<span style="color: #666666">(</span>foo<span style="color: #666666">))</span> fieldA <span style="color: #666666">&lt;=</span> <span style="color: #BA2121">&quot;foo&quot;</span>
lteq<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),6)</span> <span style="color: #408080; font-style: italic">// fieldA + fieldB &lt;= 6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-lt">lt</h3>
<div class="paragraph">
<p>The <code>lt</code> function will return whether the first parameter is less than the second parameter. The function accepts numeric or string parameters, but will fail to execute if all the parameters are not of the same type. That is, all are String or all are Numeric. If any any parameters are null then an error will be raised. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.46">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Value | Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.47">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>lt</code> evaluator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">lt<span style="color: #666666">(1,2)</span> <span style="color: #408080; font-style: italic">// 1 &lt; 2</span>
lt<span style="color: #666666">(1,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// 1 &lt; fieldA</span>
lt<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>val<span style="color: #666666">(</span>foo<span style="color: #666666">))</span> fieldA <span style="color: #666666">&lt;</span> <span style="color: #BA2121">&quot;foo&quot;</span>
lt<span style="color: #666666">(</span>add<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),6)</span> <span style="color: #408080; font-style: italic">// fieldA + fieldB &lt; 6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-not">not</h3>
<div class="paragraph">
<p>The <code>not</code> function will return the logical NOT of a single boolean parameter. The function will fail to execute if the parameter is non-boolean or null. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.47">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.48">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>not</code> evaluator. Only one parameter is allowed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">not<span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// false</span>
not<span style="color: #666666">(</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true if fieldA is false else false</span>
not<span style="color: #666666">(</span>eq<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">))</span> <span style="color: #408080; font-style: italic">// true if fieldA != fieldB</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-or">or</h3>
<div class="paragraph">
<p>The <code>or</code> function will return the logical OR of at least 2 boolean parameters. The function will fail to execute if any parameters are non-boolean or null. Returns a boolean value.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.48">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
<li>
<p><code>&#8230;&#8203;&#8230;&#8203;</code></p>
</li>
<li>
<p><code>Field Name | Raw Boolean | Boolean Evaluator</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.49">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>or</code> evaluator. At least two parameters are required, but there is no limit to how many you can use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">or<span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span>fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true || fieldA</span>
or<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// fieldA || fieldB</span>
or<span style="color: #666666">(</span>and<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">),</span>fieldC<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// (fieldA &amp;&amp; fieldB) || fieldC</span>
or<span style="color: #666666">(</span>fieldA<span style="color: #666666">,</span>fieldB<span style="color: #666666">,</span>fieldC<span style="color: #666666">,</span>and<span style="color: #666666">(</span>fieldD<span style="color: #666666">,</span>fieldE<span style="color: #666666">),</span>fieldF<span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-analyze">analyze</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-second">second</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-minute">minute</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-hour">hour</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-day">day</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-month">month</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-year">year</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-convert">convert</h3>

</div>
<div class="sect2">
<h3 id="StreamingExpressions-raw">raw</h3>
<div class="paragraph">
<p>The <code>raw</code> function will return whatever raw value is the parameter. This is useful for cases where you want to use a string as part of another evaluator.</p>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Parameters.49">Parameters</h4>
<div class="ulist">
<ul>
<li>
<p><code>Raw Value</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="StreamingExpressions-Syntax.50">Syntax</h4>
<div class="paragraph">
<p>The expressions below show the various ways in which you can use the <code>raw</code> evaluator. Whatever is inside will be returned as-is. Internal evaluators are considered strings and are not evaluated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">raw<span style="color: #666666">(</span>foo<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// &quot;foo&quot;</span>
raw<span style="color: #666666">(</span>count<span style="color: #666666">(*))</span> <span style="color: #408080; font-style: italic">// &quot;count(*)&quot;</span>
raw<span style="color: #666666">(45)</span> <span style="color: #408080; font-style: italic">// 45</span>
raw<span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// &quot;true&quot; (note: this returns the string &quot;true&quot; and not the boolean true)</span>
eq<span style="color: #666666">(</span>raw<span style="color: #666666">(</span>fieldA<span style="color: #666666">),</span> fieldA<span style="color: #666666">)</span> <span style="color: #408080; font-style: italic">// true if the value of fieldA equals the string &quot;fieldA&quot;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="StreamingExpressions-UUID">UUID</h3>

</div>
</div>
</div>
</div>

<!-- Adds tags, if any -->
    <div class="tags">
        
    </div>

<!-- Adds nav links on each page -->
    
    
    <div class="scrollnav">
      
      <a class="btn btn-primary prev" href="exporting-result-sets.html">Exporting Result Sets</a>
      
      
      <a class="btn btn-primary next" href="graph-traversal.html">Graph Traversal</a>
      
    </div>
    

</div>

<!-- Adds comments from Apache's Comment system -->

<div id="comments_thread">
</div>
<script type="text/javascript" src="https://comments.apache.org/show_comments.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=streaming-expressions" async="true">
</script>
<noscript>
<iframe width="100%" height="500" src="https://comments.apache.org/iframe.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=streaming-expressions"></iframe>
</noscript>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Apache Software Foundation. All rights reserved. <br />
 Site last generated: 2017-04-26 <br />
<p><img src="solr-sunOnly-small.png" alt="Apache Solr"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</div>

</body>

</html>

<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Updating Parts of Documents | Apache Solr Reference Guide</title>

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-solr.css">
<link rel="stylesheet" href="css/ref-guide.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Apache Solr Reference Guide" href="https://home.apache.org/~ctargett/RefGuidePOC/jekyll-full/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // we do *NOT* want cookies used to save the current stage of the sidebar
                             // instead the code in sidebar.html will ensure that the current page
                             // (and it's ancestors) are "active" on page load
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="apache-solr-reference-guide.html">&nbsp;<span class="projectTitle"> Solr Ref Guide 7.0</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- Link to Solr website -->
                <li><a href="https://lucene.apache.org/solr/news" target="_blank">Solr News</a></li>
                <!-- Solr Resources dropdown -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solr Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                       <li><a href="https://lucene.apache.org/solr/7_0_0//solr-core/index.html" target="_blank">Solr Javadocs</a></li>
                       <li><a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git" target="_blank">Lucene/Solr Source Code</a></li>
                       <li><a href="https://lucene.apache.org/solr/resources.html#community" target="_blank">Solr Community Links</a></li>
                    </ul>
                </li>
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Updating Parts of Documents">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div class="col-lg-12">&nbsp;</div>
  <!-- Content Row -->
  <div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
      

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Apache Solr Reference Guide <!-- TODO: version from site.data --></li>
  
  <li class="sb-level1">
    <a href="about-this-guide.html">About This Guide</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="getting-started.html">Getting Started</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="installing-solr.html">Installing Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr.html">Running Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-quick-overview.html">A Quick Overview</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-step-closer.html">A Step Closer</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-control-script-reference.html">Solr Control Script Reference</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-solr.html">Upgrading Solr</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="using-the-solr-administration-user-interface.html">Using the Solr Administration User Interface</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-the-solr-admin-ui.html">Overview of the Solr Admin UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="getting-assistance.html">Getting Assistance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="logging.html">Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cloud-screens.html">Cloud Screens</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collections-core-admin.html">Collections / Core Admin</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="java-properties.html">Java Properties</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="thread-dump.html">Thread Dump</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collection-specific-tools.html">Collection-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="analysis-screen.html">Analysis Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="dataimport-screen.html">Dataimport Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="documents-screen.html">Documents Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="files-screen.html">Files Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-screen.html">Query Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="stream-screen.html">Stream Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-browser-screen.html">Schema Browser Screen</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="core-specific-tools.html">Core-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="ping.html">Ping</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="plugins-stats-screen.html">Plugins &amp; Stats Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="replication-screen.html">Replication Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="segments-info.html">Segments Info</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="documents-fields-and-schema-design.html">Documents, Fields, and Schema Design</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-documents-fields-and-schema-design.html">Overview of Documents, Fields, and Schema Design</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-field-types.html">Solr Field Types</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="field-type-definitions-and-properties.html">Field Type Definitions and Properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-types-included-with-solr.html">Field Types Included with Solr</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-currencies-and-exchange-rates.html">Working with Currencies and Exchange Rates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-dates.html">Working with Dates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-enum-fields.html">Working with Enum Fields</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-external-files-and-processes.html">Working with External Files and Processes</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-properties-by-use-case.html">Field Properties by Use Case</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="defining-fields.html">Defining Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="copying-fields.html">Copying Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="dynamic-fields.html">Dynamic Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="other-schema-elements.html">Other Schema Elements</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schema-api.html">Schema API</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="putting-the-pieces-together.html">Putting the Pieces Together</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="docvalues.html">DocValues</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schemaless-mode.html">Schemaless Mode</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="understanding-analyzers-tokenizers-and-filters.html">Understanding Analyzers, Tokenizers, and Filters</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="analyzers.html">Analyzers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-tokenizers.html">About Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-filters.html">About Filters</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="tokenizers.html">Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="filter-descriptions.html">Filter Descriptions</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="charfilterfactories.html">CharFilterFactories</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="language-analysis.html">Language Analysis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="phonetic-matching.html">Phonetic Matching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-your-analyzer.html">Running Your Analyzer</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="indexing-and-basic-data-operations.html">Indexing and Basic Data Operations</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-solr-indexing.html">Introduction to Solr Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="post-tool.html">Post Tool</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-index-handlers.html">Uploading Data with Index Handlers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="transforming-and-indexing-custom-json.html">Transforming and Indexing Custom JSON</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-solr-cell-using-apache-tika.html">Uploading Data with Solr Cell using Apache Tika</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="updating-parts-of-documents.html">Updating Parts of Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="de-duplication.html">De-Duplication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="content-streams.html">Content Streams</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uima-integration.html">UIMA Integration</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="searching.html">Searching</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-searching-in-solr.html">Overview of Searching in Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="velocity-search-ui.html">Velocity Search UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="relevance.html">Relevance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-syntax-and-parsing.html">Query Syntax and Parsing</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="common-query-parameters.html">Common Query Parameters</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-standard-query-parser.html">The Standard Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-dismax-query-parser.html">The DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-extended-dismax-query-parser.html">The Extended DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="function-queries.html">Function Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="local-parameters-in-queries.html">Local Parameters in Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="other-parsers.html">Other Parsers</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="faceting.html">Faceting</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blockjoin-faceting.html">BlockJoin Faceting</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="highlighting.html">Highlighting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spell-checking.html">Spell Checking</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-re-ranking.html">Query Re-Ranking</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="learning-to-rank.html">Learning To Rank</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="transforming-result-documents.html">Transforming Result Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="suggester.html">Suggester</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="morelikethis.html">MoreLikeThis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="pagination-of-results.html">Pagination of Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collapse-and-expand-results.html">Collapse and Expand Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-grouping.html">Result Grouping</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-clustering.html">Result Clustering</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spatial-search.html">Spatial Search</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-terms-component.html">The Terms Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-term-vector-component.html">The Term Vector Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-stats-component.html">The Stats Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-query-elevation-component.html">The Query Elevation Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="response-writers.html">Response Writers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="velocity-response-writer.html">Velocity Response Writer</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="near-real-time-searching.html">Near Real Time Searching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="realtime-get.html">RealTime Get</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="exporting-result-sets.html">Exporting Result Sets</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="streaming-expressions.html">Streaming Expressions</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="graph-traversal.html">Graph Traversal</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="parallel-sql-interface.html">Parallel SQL Interface</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="solr-jdbc-dbvisualizer.html">Solr JDBC - DbVisualizer</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-squirrel-sql.html">Solr JDBC - SQuirreL SQL</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-apache-zeppelin.html">Solr JDBC - Apache Zeppelin</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-python-jython.html">Solr JDBC - Python/Jython</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-r.html">Solr JDBC - R</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="the-well-configured-solr-instance.html">The Well-Configured Solr Instance</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="configuring-solrconfig-xml.html">Configuring solrconfig.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="datadir-and-directoryfactory-in-solrconfig.html">DataDir and DirectoryFactory in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="lib-directives-in-solrconfig.html">Lib Directives in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-factory-definition-in-solrconfig.html">Schema Factory Definition in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="indexconfig-in-solrconfig.html">IndexConfig in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="initparams-in-solrconfig.html">InitParams in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="updatehandlers-in-solrconfig.html">UpdateHandlers in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-settings-in-solrconfig.html">Query Settings in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requestdispatcher-in-solrconfig.html">RequestDispatcher in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="update-request-processors.html">Update Request Processors</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="codec-factory.html">Codec Factory</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-cores-and-solr-xml.html">Solr Cores and solr.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="format-of-solr-xml.html">Format of solr.xml</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="defining-core-properties.html">Defining core.properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="coreadmin-api.html">CoreAdmin API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-sets.html">Config Sets</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuration-apis.html">Configuration APIs</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blob-store-api.html">Blob Store API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-api.html">Config API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="request-parameters-api.html">Request Parameters API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="managed-resources.html">Managed Resources</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="implicit-requesthandlers.html">Implicit RequestHandlers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-plugins.html">Solr Plugins</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="adding-custom-plugins-in-solrcloud-mode.html">Adding Custom Plugins in SolrCloud Mode</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="jvm-settings.html">JVM Settings</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="managing-solr.html">Managing Solr</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="taking-solr-to-production.html">Taking Solr to Production</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="securing-solr.html">Securing Solr</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="authentication-and-authorization-plugins.html">Authentication and Authorization Plugins</a>
            
            <ul>
              
              <li class="sb-level4">
                <a href="basic-authentication-plugin.html">Basic Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="hadoop-authentication-plugin.html">Hadoop Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="kerberos-authentication-plugin.html">Kerberos Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="rule-based-authorization-plugin.html">Rule-Based Authorization Plugin</a>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class="sb-level3">
            <a href="enabling-ssl.html">Enabling SSL</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr-on-hdfs.html">Running Solr on HDFS</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="making-and-restoring-backups.html">Making and Restoring Backups</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuring-logging.html">Configuring Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-jmx-with-solr.html">Using JMX with Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="mbean-request-handler.html">MBean Request Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="performance-statistics-reference.html">Performance Statistics Reference</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="metrics-reporting.html">Metrics Reporting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="v2-api.html">v2 API</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="solrcloud.html">SolrCloud</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="getting-started-with-solrcloud.html">Getting Started with SolrCloud</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="how-solrcloud-works.html">How SolrCloud Works</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="shards-and-indexing-data-in-solrcloud.html">Shards and Indexing Data in SolrCloud</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="distributed-requests.html">Distributed Requests</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="read-and-write-side-fault-tolerance.html">Read and Write Side Fault Tolerance</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solrcloud-configuration-and-parameters.html">SolrCloud Configuration and Parameters</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="setting-up-an-external-zookeeper-ensemble.html">Setting Up an External ZooKeeper Ensemble</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="using-zookeeper-to-manage-configuration-files.html">Using ZooKeeper to Manage Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="zookeeper-access-control.html">ZooKeeper Access Control</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="collections-api.html">Collections API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="parameter-reference.html">Parameter Reference</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="command-line-utilities.html">Command Line Utilities</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solrcloud-with-legacy-configuration-files.html">SolrCloud with Legacy Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="configsets-api.html">ConfigSets API</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="rule-based-replica-placement.html">Rule-based Replica Placement</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cross-data-center-replication-cdcr-.html">Cross Data Center Replication (CDCR)</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="legacy-scaling-and-distribution.html">Legacy Scaling and Distribution</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-scaling-and-distribution.html">Introduction to Scaling and Distribution</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="index-replication.html">Index Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="merging-indexes.html">Merging Indexes</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="client-apis.html">Client APIs</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-client-apis.html">Introduction to Client APIs</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="choosing-an-output-format.html">Choosing an Output Format</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="client-api-lineup.html">Client API Lineup</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-javascript.html">Using JavaScript</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-python.html">Using Python</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solrj.html">Using SolrJ</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solr-from-ruby.html">Using Solr From Ruby</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="major-changes-from-solr-5-to-solr-6.html">Major Changes from Solr 5 to Solr 6</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-a-solr-cluster.html">Upgrading a Solr Cluster</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="indexupgrader-tool.html">IndexUpgrader Tool</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="further-assistance.html">Further Assistance</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="solr-glossary.html">Solr Glossary</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="errata.html">Errata</a>
    
  </li>
  
</ul>


<!-- set the 'active' class on the current page and ancestors -->
<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("#mysidebar a[href='updating-parts-of-documents.html']").parents('li').toggleClass("active", true);</script>
<!-- set the 'current' class on the current page and 'current-tree' on the current page + it's ancestors -->
<!-- this can let us do css highlighting of the current page in the sidebar even if/when the user clicks around in the sidebar causing other sidebar elements to be 'active' -->
<script>
  $("#mysidebar a[href='updating-parts-of-documents.html']").parent('li').toggleClass("current", true);
  $("#mysidebar a[href='updating-parts-of-documents.html']").parents('li').toggleClass("current-tree", true);
</script>

    </div>
    <!-- Content Column -->
    <div class="col-md-9">
      <div class="post-header">
   <h1 class="post-title-main">Updating Parts of Documents</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

<div id="main-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Once you have indexed the content you need in your Solr index, you will want to start thinking about your strategy for dealing with changes to those documents. Solr supports three approaches to updating documents that have only partially changed.</p>
</div>
<div class="paragraph">
<p>The first is <em><a href="#UpdatingPartsofDocuments-AtomicUpdates">atomic updates</a></em>. This approach allows changing only one or more fields of a document without having to re-index the entire document.</p>
</div>
<div class="paragraph">
<p>The second approach is known as <em><a href="#UpdatingPartsofDocuments-In-PlaceUpdates">in-place updates</a></em>. This approach is similar to atomic updates (is a subset of atomic updates in some sense), but can be used only for updating single valued non-indexed and non-stored docValue-based numeric fields.</p>
</div>
<div class="paragraph">
<p>The third approach is known as <em><a href="#UpdatingPartsofDocuments-OptimisticConcurrency">optimistic concurrency</a></em> or <em>optimistic locking</em>. It is a feature of many NoSQL databases, and allows conditional updating a document based on its version. This approach includes semantics and rules for how to deal with version matches or mis-matches.</p>
</div>
<div class="paragraph">
<p>Atomic Updates (and in-place updates) and Optimistic Concurrency may be used as independent strategies for managing changes to documents, or they may be combined: you can use optimistic concurrency to conditionally apply an atomic update.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UpdatingPartsofDocuments-AtomicUpdates">Atomic Updates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Solr supports several modifiers that atomically update values of a document. This allows updating only specific fields, which can help speed indexing processes in an environment where speed of index additions is critical to the application.</p>
</div>
<div class="paragraph">
<p>To use atomic updates, add a modifier to the field that needs to be updated. The content can be updated, added to, or incrementally increased if a number.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Modifier</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Set or replace the field value(s) with the specified value(s), or remove the values if 'null' or empty list is specified as the new value.</p>
</div>
<div class="paragraph">
<p>May be specified as a single value, or as a list for multiValued fields</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Adds the specified values to a multiValued field.</p>
</div>
<div class="paragraph">
<p>May be specified as a single value, or as a list.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Removes (all occurrences of) the specified values from a multiValued field.</p>
</div>
<div class="paragraph">
<p>May be specified as a single value, or as a list.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">removeregex</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Removes all occurrences of the specified regex from a multiValued field.</p>
</div>
<div class="paragraph">
<p>May be specified as a single value, or as a list.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inc</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Increments a numeric value by a specific amount.</p>
</div>
<div class="paragraph">
<p>Must be specified as a single numeric value.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="UpdatingPartsofDocuments-FieldStorage">Field Storage</h3>
<div class="paragraph">
<p>The core functionality of atomically updating a document requires that all fields in your schema must be configured as stored (<code>stored="true"</code>) or docValues (<code>docValues="true"</code>) except for fields which are <code>&lt;copyField/&gt;</code> destinations, which must be configured as <code>stored="false"</code>. Atomic updates are applied to the document represented by the existing stored field values. All data in copyField destinations fields must originate from ONLY copyField sources.</p>
</div>
<div class="paragraph">
<p>If <code>&lt;copyField/&gt;</code> destinations are configured as stored, then Solr will attempt to index both the current value of the field as well as an additional copy from any source fields. If such fields contain some information that comes from the indexing program and some information that comes from copyField, then the information which originally came from the indexing program will be lost when an atomic update is made.</p>
</div>
<div class="paragraph">
<p>There are other kinds of derived fields that must also be set so they aren&#8217;t stored. Some spatial field types use derived fields. Examples of this are solr.BBoxField and solr.LatLonType. These types create additional fields which are normally specified by a dynamic field definition. That dynamic field definition must be not stored, or indexing will fail.</p>
</div>
</div>
<div class="sect2">
<h3 id="UpdatingPartsofDocuments-Example">Example</h3>
<div class="paragraph">
<p>If the following document exists in our collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{&quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:10,
 &quot;popularity&quot;:42,
 &quot;categories&quot;:[&quot;kids&quot;],
 &quot;promo_ids&quot;:[&quot;a123x&quot;],
 &quot;tags&quot;:[&quot;free_to_try&quot;,&quot;buy_now&quot;,&quot;clearance&quot;,&quot;on_sale&quot;]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we apply the following update command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{&quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:{&quot;set&quot;:99},
 &quot;popularity&quot;:{&quot;inc&quot;:20},
 &quot;categories&quot;:{&quot;add&quot;:[&quot;toys&quot;,&quot;games&quot;]},
 &quot;promo_ids&quot;:{&quot;remove&quot;:&quot;a123x&quot;},
 &quot;tags&quot;:{&quot;remove&quot;:[&quot;free_to_try&quot;,&quot;on_sale&quot;]}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting document in our collection will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{&quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:99,
 &quot;popularity&quot;:62,
 &quot;categories&quot;:[&quot;kids&quot;,&quot;toys&quot;,&quot;games&quot;],
 &quot;tags&quot;:[&quot;buy_now&quot;,&quot;clearance&quot;]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UpdatingPartsofDocuments-In-PlaceUpdates">In-Place Updates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In-place updates are very similar to atomic updates; in some sense, this is a subset of atomic updates. In regular atomic updates, the entire document is re-indexed internally during the application of the update. However, in this approach, only the fields to be updated are affected and the rest of the documents are not re-indexed internally. Hence, the efficiency of updating in-place is unaffected by the size of the documents that are updated (i.e., number of fields, size of fields, etc.). Apart from these internal differences, there is no functional difference between atomic updates and in-place updates.</p>
</div>
<div class="paragraph">
<p>An atomic update operation is performed using this approach only when the fields to be updated meet these three conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>are non-indexed (<code>indexed="false"</code>), non-stored (<code>stored="false"</code>), single valued (<code>multiValued="false"</code>) numeric docValues (<code>docValues="true"</code>) fields;</p>
</li>
<li>
<p>the <em><em>version</em></em> field is also a non-indexed, non-stored single valued docValues field; and,</p>
</li>
<li>
<p>copy targets of updated fields, if any, are also non-indexed, non-stored single valued numeric docValues fields.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use in-place updates, add a modifier to the field that needs to be updated. The content can be updated or incrementally increased.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Modifier</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">set</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Set or replace the field value(s) with the specified value(s).</p>
</div>
<div class="paragraph">
<p>May be specified as a single value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inc</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Increments a numeric value by a specific amount.</p>
</div>
<div class="paragraph">
<p>Must be specified as a single numeric value.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="UpdatingPartsofDocuments-Example.1">Example</h3>
<div class="paragraph">
<p>If the price and popularity fields are defined in the schema as:</p>
</div>
<div class="paragraph">
<p><code>&lt;field name="price" type="float" indexed="false" stored="false" docValues="true"/&gt;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;field name="popularity" type="float" indexed="false" stored="false" docValues="true"/&gt;</code></p>
</div>
<div class="paragraph">
<p>If the following document exists in our collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{
 &quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:10,
 &quot;popularity&quot;:42,
 &quot;categories&quot;:[&quot;kids&quot;],
 &quot;promo_ids&quot;:[&quot;a123x&quot;],
 &quot;tags&quot;:[&quot;free_to_try&quot;,&quot;buy_now&quot;,&quot;clearance&quot;,&quot;on_sale&quot;]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we apply the following update command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{
 &quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:{&quot;set&quot;:99},
 &quot;popularity&quot;:{&quot;inc&quot;:20}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting document in our collection will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="plain">{
 &quot;id&quot;:&quot;mydoc&quot;,
 &quot;price&quot;:99,
 &quot;popularity&quot;:62,
 &quot;categories&quot;:[&quot;kids&quot;],
 &quot;promo_ids&quot;:[&quot;a123x&quot;],
 &quot;tags&quot;:[&quot;free_to_try&quot;,&quot;buy_now&quot;,&quot;clearance&quot;,&quot;on_sale&quot;]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UpdatingPartsofDocuments-OptimisticConcurrency">Optimistic Concurrency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optimistic Concurrency is a feature of Solr that can be used by client applications which update/replace documents to ensure that the document they are replacing/updating has not been concurrently modified by another client application. This feature works by requiring a <code><em>version</em></code> field on all documents in the index, and comparing that to a <code><em>version</em></code> specified as part of the update command. By default, Solr&#8217;s Schema includes a <code><em>version</em></code> field, and this field is automatically added to each new document.</p>
</div>
<div class="paragraph">
<p>In general, using optimistic concurrency involves the following work flow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client reads a document. In Solr, one might retrieve the document with the <code>/get</code> handler to be sure to have the latest version.</p>
</li>
<li>
<p>A client changes the document locally.</p>
</li>
<li>
<p>The client resubmits the changed document to Solr, for example, perhaps with the <code>/update</code> handler.</p>
</li>
<li>
<p>If there is a version conflict (HTTP error code 409), the client starts the process over.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the client resubmits a changed document to Solr, the <code><em>version</em></code> can be included with the update to invoke optimistic concurrency control. Specific semantics are used to define when the document should be updated or when to report a conflict.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the content in the <code><em>version</em></code> field is greater than '1' (i.e., '12345'), then the <code><em>version</em></code> in the document must match the <code><em>version</em></code> in the index.</p>
</li>
<li>
<p>If the content in the <code><em>version</em></code> field is equal to '1', then the document must simply exist. In this case, no version matching occurs, but if the document does not exist, the updates will be rejected.</p>
</li>
<li>
<p>If the content in the <code><em>version</em></code> field is less than '0' (i.e., '-1'), then the document must <strong>not</strong> exist. In this case, no version matching occurs, but if the document exists, the updates will be rejected.</p>
</li>
<li>
<p>If the content in the <code><em>version</em></code> field is equal to '0', then it doesn&#8217;t matter if the versions match or if the document exists or not. If it exists, it will be overwritten; if it does not exist, it will be added.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the document being updated does not include the <code><em>version</em></code> field, and atomic updates are not being used, the document will be treated by normal Solr rules, which is usually to discard the previous version.</p>
</div>
<div class="paragraph">
<p>When using Optimistic Concurrency, clients can include an optional <code>versions=true</code> request parameter to indicate that the <em>new</em> versions of the documents being added should be included in the response. This allows clients to immediately know what the <code><em>version</em></code> is of every documented added with out needing to make a redundant <a href="realtime-get.html#realtime-get"><code>/get</code> request</a>.</p>
</div>
<div class="paragraph">
<p>For example&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">$ curl -X POST -H <span style="color: #BA2121">&#39;Content-Type: application/json&#39;</span> <span style="color: #BA2121">&#39;http://localhost:8983/solr/techproducts/update?versions=true&#39;</span> --data-binary <span style="color: #BA2121">&#39;</span>
<span style="color: #BA2121">[ { &quot;id&quot; : &quot;aaa&quot; },</span>
<span style="color: #BA2121">  { &quot;id&quot; : &quot;bbb&quot; } ]&#39;</span>
<span style="color: #666666">{</span><span style="color: #BA2121">&quot;responseHeader&quot;</span>:<span style="color: #666666">{</span><span style="color: #BA2121">&quot;status&quot;</span>:0,<span style="color: #BA2121">&quot;QTime&quot;</span>:6<span style="color: #666666">}</span>,
 <span style="color: #BA2121">&quot;adds&quot;</span>:<span style="color: #666666">[</span><span style="color: #BA2121">&quot;aaa&quot;</span>,1498562471222312960,
         <span style="color: #BA2121">&quot;bbb&quot;</span>,1498562471225458688<span style="color: #666666">]}</span>
$ curl -X POST -H <span style="color: #BA2121">&#39;Content-Type: application/json&#39;</span> <span style="color: #BA2121">&#39;http://localhost:8983/solr/techproducts/update?_version_=999999&amp;versions=true&#39;</span> --data-binary <span style="color: #BA2121">&#39;</span>
<span style="color: #BA2121">[{ &quot;id&quot; : &quot;aaa&quot;,</span>
<span style="color: #BA2121">   &quot;foo_s&quot; : &quot;update attempt with wrong existing version&quot; }]&#39;</span>
<span style="color: #666666">{</span><span style="color: #BA2121">&quot;responseHeader&quot;</span>:<span style="color: #666666">{</span><span style="color: #BA2121">&quot;status&quot;</span>:409,<span style="color: #BA2121">&quot;QTime&quot;</span>:3<span style="color: #666666">}</span>,
 <span style="color: #BA2121">&quot;error&quot;</span>:<span style="color: #666666">{</span><span style="color: #BA2121">&quot;msg&quot;</span>:<span style="color: #BA2121">&quot;version conflict for aaa expected=999999 actual=1498562471222312960&quot;</span>,
          <span style="color: #BA2121">&quot;code&quot;</span>:409<span style="color: #666666">}}</span>
$ curl -X POST -H <span style="color: #BA2121">&#39;Content-Type: application/json&#39;</span> <span style="color: #BA2121">&#39;http://localhost:8983/solr/techproducts/update?_version_=1498562471222312960&amp;versions=true&amp;commit=true&#39;</span> --data-binary <span style="color: #BA2121">&#39;</span>
<span style="color: #BA2121">[{ &quot;id&quot; : &quot;aaa&quot;,</span>
<span style="color: #BA2121">   &quot;foo_s&quot; : &quot;update attempt with correct existing version&quot; }]&#39;</span>
<span style="color: #666666">{</span><span style="color: #BA2121">&quot;responseHeader&quot;</span>:<span style="color: #666666">{</span><span style="color: #BA2121">&quot;status&quot;</span>:0,<span style="color: #BA2121">&quot;QTime&quot;</span>:5<span style="color: #666666">}</span>,
 <span style="color: #BA2121">&quot;adds&quot;</span>:<span style="color: #666666">[</span><span style="color: #BA2121">&quot;aaa&quot;</span>,1498562624496861184<span style="color: #666666">]}</span>
$ curl <span style="color: #BA2121">&#39;http://localhost:8983/solr/techproducts/query?q=*:*&amp;fl=id,_version_&#39;</span>
<span style="color: #666666">{</span>
  <span style="color: #BA2121">&quot;responseHeader&quot;</span>:<span style="color: #666666">{</span>
    <span style="color: #BA2121">&quot;status&quot;</span>:0,
    <span style="color: #BA2121">&quot;QTime&quot;</span>:5,
    <span style="color: #BA2121">&quot;params&quot;</span>:<span style="color: #666666">{</span>
      <span style="color: #BA2121">&quot;fl&quot;</span>:<span style="color: #BA2121">&quot;id,_version_&quot;</span>,
      <span style="color: #BA2121">&quot;q&quot;</span>:<span style="color: #BA2121">&quot;*:*&quot;</span><span style="color: #666666">}}</span>,
  <span style="color: #BA2121">&quot;response&quot;</span>:<span style="color: #666666">{</span><span style="color: #BA2121">&quot;numFound&quot;</span>:2,<span style="color: #BA2121">&quot;start&quot;</span>:0,<span style="color: #BA2121">&quot;docs&quot;</span>:<span style="color: #666666">[</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;id&quot;</span>:<span style="color: #BA2121">&quot;bbb&quot;</span>,
        <span style="color: #BA2121">&quot;_version_&quot;</span>:1498562471225458688<span style="color: #666666">}</span>,
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;id&quot;</span>:<span style="color: #BA2121">&quot;aaa&quot;</span>,
        <span style="color: #BA2121">&quot;_version_&quot;</span>:1498562624496861184<span style="color: #666666">}]</span>
  <span style="color: #666666">}}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, please also see <a href="https://www.youtube.com/watch?v=WYVM6Wz-XTw">Yonik Seeley&#8217;s presentation on NoSQL features in Solr 4</a> from Apache Lucene EuroCon 2012.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="UpdatingPartsofDocuments-DocumentCentricVersioningConstraints">Document Centric Versioning Constraints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Optimistic Concurrency is extremely powerful, and works very efficiently because it uses an internally assigned, globally unique values for the <code><em>version</em></code> field. However, In some situations users may want to configure their own document specific version field, where the version values are assigned on a per-document basis by an external system, and have Solr reject updates that attempt to replace a document with an "older" version. In situations like this the <a href="https://lucene.apache.org/solr/7_0_0//solr-core/org/apache/solr/update/processor/DocBasedVersionConstraintsProcessorFactory.html"><code>DocBasedVersionConstraintsProcessorFactory</code></a> can be useful.</p>
</div>
<div class="paragraph">
<p>The basic usage of <code>DocBasedVersionConstraintsProcessorFactory</code> is to configure it in <code>solrconfig.xml</code> as part of the <a href="http://wiki.apache.org/solr/UpdateRequestProcessor">UpdateRequestProcessorChain</a> and specify the name of your custom <code>versionField</code> in your schema that should be checked when validating updates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span style="color: #008000; font-weight: bold">&lt;processor</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">&quot;solr.DocBasedVersionConstraintsProcessorFactory&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
  <span style="color: #008000; font-weight: bold">&lt;str</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;versionField&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>my_version_l<span style="color: #008000; font-weight: bold">&lt;/str&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/processor&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once configured, this update processor will reject (HTTP error code 409) any attempt to update an existing document where the value of the <code>my_version_l</code> field in the "new" document is not greater then the value of that field in the existing document.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">versionField vs <em>version</em></div>
<div class="paragraph">
<p>The <code><em>version</em></code> field used by Solr for its normal optimistic concurrency also has important semantics in how updates are distributed to replicas in SolrCloud, and <strong>MUST</strong> be assigned internally by Solr. Users can not re-purpose that field and specify it as the <code>versionField</code> for use in the <code>DocBasedVersionConstraintsProcessorFactory</code> configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>DocBasedVersionConstraintsProcessorFactory</code> supports two additional configuration params which are optional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ignoreOldUpdates</code> - A boolean option which defaults to <code>false</code>. If set to <code>true</code> then instead of rejecting updates where the <code>versionField</code> is too low, the update will be silently ignored (and return a status 200 to the client).</p>
</li>
<li>
<p><code>deleteVersionParam</code> - A String parameter that can be specified to indicate that this processor should also inspect Delete By Id commands. The value of this configuration option should be the name of a request parameter that the processor will now consider mandatory for all attempts to Delete By Id, and must be be used by clients to specify a value for the <code>versionField</code> which is greater then the existing value of the document to be deleted. When using this request param, any Delete By Id command with a high enough document version number to succeed will be internally converted into an Add Document command that replaces the existing document with a new one which is empty except for the Unique Key and <code>versionField</code> to keeping a record of the deleted version so future Add Document commands will fail if their "new" version is not high enough.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please consult the <a href="https://lucene.apache.org/solr/7_0_0//solr-core/org/apache/solr/update/processor/DocBasedVersionConstraintsProcessorFactory.html">DocBasedVersionConstraintsProcessorFactory javadocs</a> and <a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git;a=blob;f=solr/core/src/test-files/solr/collection1/conf/solrconfig-externalversionconstraint.xml;hb=HEAD">test solrconfig.xml file</a> for additional information and example usages.</p>
</div>
</div>
</div>
</div>

<!-- Adds tags, if any -->
    <div class="tags">
        
    </div>

<!-- Adds nav links on each page -->
    
    
    <div class="scrollnav">
      
      <a class="btn btn-primary prev" href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
      
      
      <a class="btn btn-primary next" href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
      
    </div>
    

</div>

<!-- Adds comments from Apache's Comment system -->

<div id="comments_thread">
</div>
<script type="text/javascript" src="https://comments.apache.org/show_comments.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=updating-parts-of-documents" async="true">
</script>
<noscript>
<iframe width="100%" height="500" src="https://comments.apache.org/iframe.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=updating-parts-of-documents"></iframe>
</noscript>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Apache Software Foundation. All rights reserved. <br />
 Site last generated: 2017-04-26 <br />
<p><img src="solr-sunOnly-small.png" alt="Apache Solr"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</div>

</body>

</html>

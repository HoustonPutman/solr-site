<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Graph Traversal | Apache Solr Reference Guide</title>

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-solr.css">
<link rel="stylesheet" href="css/ref-guide.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Apache Solr Reference Guide" href="https://home.apache.org/~ctargett/RefGuidePOC/jekyll-full/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // we do *NOT* want cookies used to save the current stage of the sidebar
                             // instead the code in sidebar.html will ensure that the current page
                             // (and it's ancestors) are "active" on page load
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="apache-solr-reference-guide.html">&nbsp;<span class="projectTitle"> Solr Ref Guide 7.0</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- Link to Solr website -->
                <li><a href="https://lucene.apache.org/solr/news" target="_blank">Solr News</a></li>
                <!-- Solr Resources dropdown -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solr Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                       <li><a href="https://lucene.apache.org/solr/7_0_0//solr-core/index.html" target="_blank">Solr Javadocs</a></li>
                       <li><a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git" target="_blank">Lucene/Solr Source Code</a></li>
                       <li><a href="https://lucene.apache.org/solr/resources.html#community" target="_blank">Solr Community Links</a></li>
                    </ul>
                </li>
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Graph Traversal">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div class="col-lg-12">&nbsp;</div>
  <!-- Content Row -->
  <div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
      

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Apache Solr Reference Guide <!-- TODO: version from site.data --></li>
  
  <li class="sb-level1">
    <a href="about-this-guide.html">About This Guide</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="getting-started.html">Getting Started</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="installing-solr.html">Installing Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr.html">Running Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-quick-overview.html">A Quick Overview</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-step-closer.html">A Step Closer</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-control-script-reference.html">Solr Control Script Reference</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-solr.html">Upgrading Solr</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="using-the-solr-administration-user-interface.html">Using the Solr Administration User Interface</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-the-solr-admin-ui.html">Overview of the Solr Admin UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="getting-assistance.html">Getting Assistance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="logging.html">Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cloud-screens.html">Cloud Screens</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collections-core-admin.html">Collections / Core Admin</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="java-properties.html">Java Properties</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="thread-dump.html">Thread Dump</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collection-specific-tools.html">Collection-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="analysis-screen.html">Analysis Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="dataimport-screen.html">Dataimport Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="documents-screen.html">Documents Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="files-screen.html">Files Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-screen.html">Query Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="stream-screen.html">Stream Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-browser-screen.html">Schema Browser Screen</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="core-specific-tools.html">Core-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="ping.html">Ping</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="plugins-stats-screen.html">Plugins &amp; Stats Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="replication-screen.html">Replication Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="segments-info.html">Segments Info</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="documents-fields-and-schema-design.html">Documents, Fields, and Schema Design</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-documents-fields-and-schema-design.html">Overview of Documents, Fields, and Schema Design</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-field-types.html">Solr Field Types</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="field-type-definitions-and-properties.html">Field Type Definitions and Properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-types-included-with-solr.html">Field Types Included with Solr</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-currencies-and-exchange-rates.html">Working with Currencies and Exchange Rates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-dates.html">Working with Dates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-enum-fields.html">Working with Enum Fields</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-external-files-and-processes.html">Working with External Files and Processes</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-properties-by-use-case.html">Field Properties by Use Case</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="defining-fields.html">Defining Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="copying-fields.html">Copying Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="dynamic-fields.html">Dynamic Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="other-schema-elements.html">Other Schema Elements</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schema-api.html">Schema API</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="putting-the-pieces-together.html">Putting the Pieces Together</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="docvalues.html">DocValues</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schemaless-mode.html">Schemaless Mode</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="understanding-analyzers-tokenizers-and-filters.html">Understanding Analyzers, Tokenizers, and Filters</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="analyzers.html">Analyzers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-tokenizers.html">About Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-filters.html">About Filters</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="tokenizers.html">Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="filter-descriptions.html">Filter Descriptions</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="charfilterfactories.html">CharFilterFactories</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="language-analysis.html">Language Analysis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="phonetic-matching.html">Phonetic Matching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-your-analyzer.html">Running Your Analyzer</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="indexing-and-basic-data-operations.html">Indexing and Basic Data Operations</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-solr-indexing.html">Introduction to Solr Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="post-tool.html">Post Tool</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-index-handlers.html">Uploading Data with Index Handlers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="transforming-and-indexing-custom-json.html">Transforming and Indexing Custom JSON</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-solr-cell-using-apache-tika.html">Uploading Data with Solr Cell using Apache Tika</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="updating-parts-of-documents.html">Updating Parts of Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="de-duplication.html">De-Duplication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="content-streams.html">Content Streams</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uima-integration.html">UIMA Integration</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="searching.html">Searching</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-searching-in-solr.html">Overview of Searching in Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="velocity-search-ui.html">Velocity Search UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="relevance.html">Relevance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-syntax-and-parsing.html">Query Syntax and Parsing</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="common-query-parameters.html">Common Query Parameters</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-standard-query-parser.html">The Standard Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-dismax-query-parser.html">The DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-extended-dismax-query-parser.html">The Extended DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="function-queries.html">Function Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="local-parameters-in-queries.html">Local Parameters in Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="other-parsers.html">Other Parsers</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="faceting.html">Faceting</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blockjoin-faceting.html">BlockJoin Faceting</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="highlighting.html">Highlighting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spell-checking.html">Spell Checking</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-re-ranking.html">Query Re-Ranking</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="learning-to-rank.html">Learning To Rank</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="transforming-result-documents.html">Transforming Result Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="suggester.html">Suggester</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="morelikethis.html">MoreLikeThis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="pagination-of-results.html">Pagination of Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collapse-and-expand-results.html">Collapse and Expand Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-grouping.html">Result Grouping</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-clustering.html">Result Clustering</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spatial-search.html">Spatial Search</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-terms-component.html">The Terms Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-term-vector-component.html">The Term Vector Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-stats-component.html">The Stats Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-query-elevation-component.html">The Query Elevation Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="response-writers.html">Response Writers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="velocity-response-writer.html">Velocity Response Writer</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="near-real-time-searching.html">Near Real Time Searching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="realtime-get.html">RealTime Get</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="exporting-result-sets.html">Exporting Result Sets</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="streaming-expressions.html">Streaming Expressions</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="graph-traversal.html">Graph Traversal</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="parallel-sql-interface.html">Parallel SQL Interface</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="solr-jdbc-dbvisualizer.html">Solr JDBC - DbVisualizer</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-squirrel-sql.html">Solr JDBC - SQuirreL SQL</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-apache-zeppelin.html">Solr JDBC - Apache Zeppelin</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-python-jython.html">Solr JDBC - Python/Jython</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-r.html">Solr JDBC - R</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="the-well-configured-solr-instance.html">The Well-Configured Solr Instance</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="configuring-solrconfig-xml.html">Configuring solrconfig.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="datadir-and-directoryfactory-in-solrconfig.html">DataDir and DirectoryFactory in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="lib-directives-in-solrconfig.html">Lib Directives in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-factory-definition-in-solrconfig.html">Schema Factory Definition in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="indexconfig-in-solrconfig.html">IndexConfig in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="initparams-in-solrconfig.html">InitParams in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="updatehandlers-in-solrconfig.html">UpdateHandlers in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-settings-in-solrconfig.html">Query Settings in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requestdispatcher-in-solrconfig.html">RequestDispatcher in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="update-request-processors.html">Update Request Processors</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="codec-factory.html">Codec Factory</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-cores-and-solr-xml.html">Solr Cores and solr.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="format-of-solr-xml.html">Format of solr.xml</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="defining-core-properties.html">Defining core.properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="coreadmin-api.html">CoreAdmin API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-sets.html">Config Sets</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuration-apis.html">Configuration APIs</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blob-store-api.html">Blob Store API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-api.html">Config API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="request-parameters-api.html">Request Parameters API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="managed-resources.html">Managed Resources</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="implicit-requesthandlers.html">Implicit RequestHandlers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-plugins.html">Solr Plugins</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="adding-custom-plugins-in-solrcloud-mode.html">Adding Custom Plugins in SolrCloud Mode</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="jvm-settings.html">JVM Settings</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="managing-solr.html">Managing Solr</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="taking-solr-to-production.html">Taking Solr to Production</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="securing-solr.html">Securing Solr</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="authentication-and-authorization-plugins.html">Authentication and Authorization Plugins</a>
            
            <ul>
              
              <li class="sb-level4">
                <a href="basic-authentication-plugin.html">Basic Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="hadoop-authentication-plugin.html">Hadoop Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="kerberos-authentication-plugin.html">Kerberos Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="rule-based-authorization-plugin.html">Rule-Based Authorization Plugin</a>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class="sb-level3">
            <a href="enabling-ssl.html">Enabling SSL</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr-on-hdfs.html">Running Solr on HDFS</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="making-and-restoring-backups.html">Making and Restoring Backups</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuring-logging.html">Configuring Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-jmx-with-solr.html">Using JMX with Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="mbean-request-handler.html">MBean Request Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="performance-statistics-reference.html">Performance Statistics Reference</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="metrics-reporting.html">Metrics Reporting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="v2-api.html">v2 API</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="solrcloud.html">SolrCloud</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="getting-started-with-solrcloud.html">Getting Started with SolrCloud</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="how-solrcloud-works.html">How SolrCloud Works</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="shards-and-indexing-data-in-solrcloud.html">Shards and Indexing Data in SolrCloud</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="distributed-requests.html">Distributed Requests</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="read-and-write-side-fault-tolerance.html">Read and Write Side Fault Tolerance</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solrcloud-configuration-and-parameters.html">SolrCloud Configuration and Parameters</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="setting-up-an-external-zookeeper-ensemble.html">Setting Up an External ZooKeeper Ensemble</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="using-zookeeper-to-manage-configuration-files.html">Using ZooKeeper to Manage Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="zookeeper-access-control.html">ZooKeeper Access Control</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="collections-api.html">Collections API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="parameter-reference.html">Parameter Reference</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="command-line-utilities.html">Command Line Utilities</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solrcloud-with-legacy-configuration-files.html">SolrCloud with Legacy Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="configsets-api.html">ConfigSets API</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="rule-based-replica-placement.html">Rule-based Replica Placement</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cross-data-center-replication-cdcr-.html">Cross Data Center Replication (CDCR)</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="legacy-scaling-and-distribution.html">Legacy Scaling and Distribution</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-scaling-and-distribution.html">Introduction to Scaling and Distribution</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="index-replication.html">Index Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="merging-indexes.html">Merging Indexes</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="client-apis.html">Client APIs</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-client-apis.html">Introduction to Client APIs</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="choosing-an-output-format.html">Choosing an Output Format</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="client-api-lineup.html">Client API Lineup</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-javascript.html">Using JavaScript</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-python.html">Using Python</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solrj.html">Using SolrJ</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solr-from-ruby.html">Using Solr From Ruby</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="major-changes-from-solr-5-to-solr-6.html">Major Changes from Solr 5 to Solr 6</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-a-solr-cluster.html">Upgrading a Solr Cluster</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="indexupgrader-tool.html">IndexUpgrader Tool</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="further-assistance.html">Further Assistance</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="solr-glossary.html">Solr Glossary</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="errata.html">Errata</a>
    
  </li>
  
</ul>


<!-- set the 'active' class on the current page and ancestors -->
<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("#mysidebar a[href='graph-traversal.html']").parents('li').toggleClass("active", true);</script>
<!-- set the 'current' class on the current page and 'current-tree' on the current page + it's ancestors -->
<!-- this can let us do css highlighting of the current page in the sidebar even if/when the user clicks around in the sidebar causing other sidebar elements to be 'active' -->
<script>
  $("#mysidebar a[href='graph-traversal.html']").parent('li').toggleClass("current", true);
  $("#mysidebar a[href='graph-traversal.html']").parents('li').toggleClass("current-tree", true);
</script>

    </div>
    <!-- Content Column -->
    <div class="col-md-9">
      <div class="post-header">
   <h1 class="post-title-main">Graph Traversal</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

<div id="main-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Graph traversal with streaming expressions uses the <code>gatherNodes</code> function to perform a breadth-first graph traversal. The <code>gatherNodes</code> function can be combined with the <code>scoreNodes</code> function to provide recommendations. <code>gatherNodes</code> can also be combined with the wider streaming expression library to perform complex operations on gathered node sets.</p>
</div>
<div class="paragraph">
<p><code>gatherNodes</code> traversals are distributed within a SolrCloud collection and can span collections.</p>
</div>
<div class="paragraph">
<p><code>gatherNodes</code> is designed for use cases that involve zooming into a neighborhood in the graph and performing precise traversals to gather node sets and aggregations. In these types of use cases <code>gatherNodes</code> will often provide sub-second performance. Some sample use cases are provided later in the document.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This document assumes a basic understanding of graph terminology and streaming expressions. You can begin exploring graph traversal concepts with this <a href="https://en.wikipedia.org/wiki/Graph_traversal">Wikipedia article</a>. More details about streaming expressions are available in this Guide, in the section <a href="streaming-expressions.html#streaming-expressions">Streaming Expressions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-BasicSyntax">Basic Syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ll start with the most basic syntax and slowly build up more complexity. The most basic syntax for <code>gatherNodes</code> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break down this simple expression.</p>
</div>
<div class="paragraph">
<p>The first parameter, <code>emails</code>, is the collection being traversed. The second parameter, <code>walk</code>, maps a hard-coded node ID ("<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>") to a field in the index (<code>from</code>). This will return all the <strong>edges</strong> in the index that have <code>johndoe@apache.org</code> in the <code>from</code> field.</p>
</div>
<div class="paragraph">
<p>The <code>gather</code> parameter tells the function to gather the values in the `to `field. The values that are gathered are the node IDs emitted by the function.</p>
</div>
<div class="paragraph">
<p>In the example above the nodes emitted will be all of the people that "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" has emailed.</p>
</div>
<div class="paragraph">
<p>The walk parameter also accepts a list of root node IDs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org, janesmith@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gatherNodes</code> function above finds all the edges with "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" or "<a href="mailto:janesmith@apache.org">janesmith@apache.org</a>" in the <code>from</code> field and gathers the <code>to</code> field.</p>
</div>
<div class="paragraph">
<p>Like all <a href="streaming-expressions.html#streaming-expressions">Streaming Expressions</a>, you can execute a <code>gatherNodes</code> expression by sending it to the <code>/stream</code> handler. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl --data-urlencode <span style="color: #BA2121">&#39;expr=gatherNodes(emails,</span>
<span style="color: #BA2121">                                        walk=&quot;johndoe@apache.org, janesmith@apache.org-&gt;from&quot;,</span>
<span style="color: #BA2121">                                        gather=&quot;to&quot;)&#39;</span> http://localhost:8983/solr/emails/stream</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of this expression would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">{</span>
  <span style="color: #BA2121">&quot;result-set&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">{</span>
    <span style="color: #BA2121">&quot;docs&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">[</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;slist@campbell.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;catherine.pernot@enron.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;airam.arteaga@enron.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;EOF&quot;</span><span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;RESPONSE_TIME&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">44</span>
      <span style="color: #666666">}</span>
    <span style="color: #666666">]</span>
  <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the tuples returned have the <code>node</code> field. The <code>node</code> field contains the node IDs gathered by the function. The <code>collection</code>, <code>field</code>, and <code>level</code> of the traversal are also included in the output.</p>
</div>
<div class="paragraph">
<p>Notice that the level is "1" for each tuple in the example. The root nodes are level 0 (in the example above, the root nodes are "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>, <a href="mailto:janesmith@apache.org">janesmith@apache.org</a>") By default the <code>gatherNodes</code> function emits only the <em>*leaf nodes*</em> of the traversal, which is the outer-most node set. To emit the root nodes you can specify the <code>scatter</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
            scatter<span style="color: #666666">=</span><span style="color: #BA2121">&quot;branches, leaves&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>scatter</code> parameter controls whether to emit the <em>*branches*</em> with the <em>*leaves*</em> . The root nodes are considered "branches" because they are not the outer-most level of the traversal.</p>
</div>
<div class="paragraph">
<p>When scattering both branches and leaves the output would like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">{</span>
  <span style="color: #BA2121">&quot;result-set&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">{</span>
    <span style="color: #BA2121">&quot;docs&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">[</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;johndoe@apache.org&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">0</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;slist@campbell.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;catherine.pernot@enron.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;airam.arteaga@enron.com&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;collection&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;emails&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">1</span>
      <span style="color: #666666">},</span>
      <span style="color: #666666">{</span>
        <span style="color: #BA2121">&quot;EOF&quot;</span><span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">,</span>
        <span style="color: #BA2121">&quot;RESPONSE_TIME&quot;</span><span style="color: #666666">:</span> <span style="color: #666666">44</span>
      <span style="color: #666666">}</span>
    <span style="color: #666666">]</span>
  <span style="color: #666666">}</span>
<span style="color: #666666">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the level 0 root node is included in the output.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-Aggregations">Aggregations</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>gatherNodes</code> also supports aggregations. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org, janesmith@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
            count<span style="color: #666666">(*))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above finds the edges with "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" or "<a href="mailto:janesmith@apache.org">janesmith@apache.org</a>" in the <code>from</code> field and gathers the values from the <code>to</code> field<em>.</em> It also aggregates the count for each node ID gathered.</p>
</div>
<div class="paragraph">
<p>A gathered node could have a count of 2 if both "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" and "<a href="mailto:janesmith@apache.org">janesmith@apache.org</a>" have emailed the same person. Node sets contain a unique set of nodes, so the same person won&#8217;t appear twice in the node set, but the count will reflect that it appeared twice during the traversal.</p>
</div>
<div class="paragraph">
<p>Edges are uniqued as part of the traversal so the count will <strong>not</strong> reflect the number of times "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" emailed the same person. For example, personA might have emailed personB 100 times. These edges would get uniqued and only be counted once. But if person personC also emailed personB this would increment the count for personB.</p>
</div>
<div class="paragraph">
<p>The aggregation functions supported are <code>count(*)</code>, <code>sum(field)</code>, <code>min(field)</code>, <code>max(field)</code>, and <code>avg(field)</code>. The fields being aggregated should be present in the edges collected during the traversal. Later examples (below) will show aggregations can be a powerful tool for providing recommendations and limiting the scope of traversals.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-NestinggatherNodesfunctions">Nesting gatherNodes functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>gatherNodes</code> function can be nested to traverse deeper into the graph. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                        walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
                        gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">),</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the outer <code>gatherNodes</code> function operates on the node set collected from the inner <code>gatherNodes</code> function.</p>
</div>
<div class="paragraph">
<p>Notice that the inner <code>gatherNodes</code> function behaves exactly as the examples already discussed. But the <code>walk</code> parameter of the outer <code>gatherNodes</code> function behaves differently.</p>
</div>
<div class="paragraph">
<p>In the outer <code>gatherNodes</code> function the <code>walk</code> parameter works with tuples coming from an internal streaming expression. In this scenario the <code>walk</code> parameter maps the <code>node</code> field to the <code>from</code> field. Remember that the node IDs collected from the inner <code>gatherNodes</code> expression are placed in the <code>node</code> field.</p>
</div>
<div class="paragraph">
<p>Put more simply, the inner expression gathers all the people that "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" has emailed. We can call this group the "friends of <a href="mailto:johndoe@apache.org">johndoe@apache.org</a>". The outer expression gathers all the people that the "friends of <a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" have emailed. This is a basic friends-of-friends traversal.</p>
</div>
<div class="paragraph">
<p>This construct of nesting <code>gatherNodes</code> functions is the basic technique for doing a controlled traversal through the graph.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-CycleDetection">Cycle Detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>gatherNodes</code> function performs cycle detection across the entire traversal. This ensures that nodes that have already been visited are not traversed again. Cycle detection is important for both limiting the size of traversals and gathering accurate aggregations. Without cycle detection the size of the traversal could grow exponentially with each hop in the traversal. With cycle detection only new nodes encountered are traversed.</p>
</div>
<div class="paragraph">
<p>Cycle detection <strong>does not</strong> cross collection boundaries. This is because internally the collection name is part of the node ID. For example the node ID "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>", is really <code>emails/johndoe@apache.org</code>. When traversing to another collection "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" will be traversed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-FilteringtheTraversal">Filtering the Traversal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each level in the traversal can be filtered with a filter query. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
            fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body:(solr rocks)&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above only emails that match the filter query will be included in the traversal. Any Solr query can be included here. So you can do fun things like <a href="spatial-search.html#spatial-search">geospatial queries</a>, apply any of the available <a href="query-syntax-and-parsing.html#query-syntax-and-parsing">query parsers</a>, or even write custom query parsers to limit the traversal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-RootStreams">Root Streams</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any streaming expression can be used to provide the root nodes for a traversal. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            search<span style="color: #666666">(</span>emails<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body:(solr rocks)&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;score desc&quot;</span><span style="color: #666666">,</span> rows<span style="color: #666666">=</span><span style="color: #BA2121">&quot;20&quot;</span><span style="color: #666666">)</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to-&gt;from&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above provides the root nodes through a search expression. You can also provide arbitrarily complex, nested streaming expressions with joins, etc., to specify the root nodes.</p>
</div>
<div class="paragraph">
<p>Notice that the <code>walk</code> parameter maps a field from the tuples generated by the inner stream. In this case it maps the <code>to</code> field from the inner stream to the <code>from</code> field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-SkippingHighFrequencyNodes">Skipping High Frequency Nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s often desirable to skip traversing high frequency nodes in the graph. This is similar in nature to a search term stop list. The best way to describe this is through an example use case.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say that you want to recommend content for a user based on a collaborative filter. Below is one approach for a simple collaborative filter:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find all content userA has read.</p>
</li>
<li>
<p>Find users whose reading list is closest to userA. These are users with similar tastes as userA.</p>
</li>
<li>
<p>Recommend content based on what the users in step 2 have read, that userA has not yet read.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Look closely at step 2. In large graphs, step 2 can lead to a very large traversal. This is because userA may have viewed content that has been viewed by millions of other people. We may want to skip these high frequency nodes for two reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A large traversal that visit millions of unique nodes is slow and takes a lot of memory because cycle detection is tracked in memory.</p>
</li>
<li>
<p>High frequency nodes are also not useful in determining users with similar tastes. The content that fewer people have viewed provides a more precise recommendation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>gatherNodes</code> function has the <code>maxDocFreq</code> param to allow for filtering out high frequency nodes. The sample code below shows steps 1 and 2 of the recommendation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> gatherNodes<span style="color: #666666">(</span>logs<span style="color: #666666">,</span>
             search<span style="color: #666666">(</span>logs<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;userID:user1&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID asc&quot;</span><span style="color: #666666">,</span> fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:view&quot;</span><span style="color: #666666">,</span> qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">),</span>
             walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID-&gt;articleID&quot;</span><span style="color: #666666">,</span>
             gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;userID&quot;</span><span style="color: #666666">,</span>
             fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:view&quot;</span><span style="color: #666666">,</span>
             maxDocFreq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;10000&quot;</span><span style="color: #666666">,</span>
             count<span style="color: #666666">(*)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the inner search expression searches the <code>logs</code> collection and returning all the articles viewed by "user1". The outer <code>gatherNodes</code> expression takes all the articles emitted from the inner search expression and finds all the records in the logs collection for those articles. It then gathers and aggregates the users that have read the articles. The <code>maxDocFreq</code> parameter limits the articles returned to those that appear in no more then 10,000 log records (per shard). This guards against returning articles that have been viewed by millions of users.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-TrackingtheTraversal">Tracking the Traversal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the <code>gatherNodes</code> function only tracks enough information to do cycle detection. This provides enough information to output the nodes and aggregations in the graph.</p>
</div>
<div class="paragraph">
<p>For some use cases, such as graph visualization, we also need to output the edges. Setting <code>trackTraversal="true"</code> tells <code>gatherNodes</code> to track the connections between nodes, so the edges can be constructed. When <code>trackTraversal</code> is enabled a new <code>ancestors</code> property will appear with each node. The <code>ancestors</code> property contains a list of node IDs that pointed to the node.</p>
</div>
<div class="paragraph">
<p>Below is a sample <code>gatherNodes</code> expression with <code>trackTraversal</code> set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
            gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                        walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
                        gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
                        trackTraversal<span style="color: #666666">=</span><span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">),</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;from&quot;</span><span style="color: #666666">,</span>
            trackTraversal<span style="color: #666666">=</span><span style="color: #BA2121">&quot;true&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-Cross-CollectionTraversals">Cross-Collection Traversals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nested <code>gatherNodes</code> functions can operate on different SolrCloud collections. This allow traversals to "walk" from one collection to another to gather nodes. Cycle detection does not cross collection boundaries, so nodes collected in one collection will be traversed in a different collection. This was done deliberately to support cross-collection traversals. Note that the output from a cross-collection traversal will likely contain duplicate nodes with different collection attributes.</p>
</div>
<div class="paragraph">
<p>Below is a sample <code>gatherNodes</code> expression that traverses from the "emails" collection to the "logs" collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>logs<span style="color: #666666">,</span>
            gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                        search<span style="color: #666666">(</span>emails<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;body:(solr rocks)&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;from&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;score desc&quot;</span><span style="color: #666666">,</span> rows<span style="color: #666666">=</span><span style="color: #BA2121">&quot;20&quot;</span><span style="color: #666666">)</span>
                        walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;from-&gt;from&quot;</span><span style="color: #666666">,</span>
                        gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
                        scatter<span style="color: #666666">=</span><span style="color: #BA2121">&quot;leaves, branches&quot;</span><span style="color: #666666">),</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;user&quot;</span><span style="color: #666666">,</span>
            fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:edit&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;contentID&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above finds all people who sent emails with a body that contains "solr rocks". It then finds all the people these people have emailed. Then it traverses to the logs collection and gathers all the content IDs that these people have edited.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-CombininggatherNodesWithOtherStreamingExpressions">Combining gatherNodes With Other Streaming Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>gatherNodes</code> function can act as both a stream source and a stream decorator. The connection with the wider stream expression library provides tremendous power and flexibility when performing graph traversals. Here is an example of using the streaming expression library to intersect two friend networks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">            intersect<span style="color: #666666">(</span>on<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node&quot;</span><span style="color: #666666">,</span>
                      sort<span style="color: #666666">(</span>by<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node asc&quot;</span><span style="color: #666666">,</span>
                           gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                                       gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                                                   walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;johndoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
                                                   gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">),</span>
                                       walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;from&quot;</span><span style="color: #666666">,</span>
                                       gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
                                       scatter<span style="color: #666666">=</span><span style="color: #BA2121">&quot;branches,leaves&quot;</span><span style="color: #666666">)),</span>
                       sort<span style="color: #666666">(</span>by<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node asc&quot;</span><span style="color: #666666">,</span>
                            gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                                        gatherNodes<span style="color: #666666">(</span>emails<span style="color: #666666">,</span>
                                                    walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;janedoe@apache.org-&gt;from&quot;</span><span style="color: #666666">,</span>
                                                    gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">),</span>
                                        walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;from&quot;</span><span style="color: #666666">,</span>
                                        gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;to&quot;</span><span style="color: #666666">,</span>
                                        scatter<span style="color: #666666">=</span><span style="color: #BA2121">&quot;branches,leaves&quot;</span><span style="color: #666666">)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above gathers two separate friend networks, one rooted with "<a href="mailto:johndoe@apache.org">johndoe@apache.org</a>" and another rooted with "<a href="mailto:janedoe@apache.org">janedoe@apache.org</a>". The friend networks are then sorted by the <code>node</code> field, and intersected. The resulting node set will be the intersection of the two friend networks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-SampleUseCases">Sample Use Cases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="GraphTraversal-CalculateMarketBasketCo-occurrence">Calculate Market Basket Co-occurrence</h3>
<div class="paragraph">
<p>It is often useful to know which products are most frequently purchased with a particular product. This example uses a simple market basket table (indexed in Solr) to store past shopping baskets. The schema for the table is very simple with each row containing a <code>basketID</code> and a <code>productID</code>. This can be seen as a graph with each row in the table representing an edge. And it can be traversed very quickly to calculate basket co-occurrence, even when the graph contains billions of edges.</p>
</div>
<div class="paragraph">
<p>Here is the sample syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">top<span style="color: #666666">(</span>n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;5&quot;</span><span style="color: #666666">,</span>
    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*) desc&quot;</span><span style="color: #666666">,</span>
    gatherNodes<span style="color: #666666">(</span>baskets<span style="color: #666666">,</span>
                random<span style="color: #666666">(</span>baskets<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;productID:ABC&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;basketID&quot;</span><span style="color: #666666">,</span> rows<span style="color: #666666">=</span><span style="color: #BA2121">&quot;500&quot;</span><span style="color: #666666">),</span>
                walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;basketID-&gt;basketID&quot;</span><span style="color: #666666">,</span>
                fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;-productID:ABC&quot;</span><span style="color: #666666">,</span>
                gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;productID&quot;</span><span style="color: #666666">,</span>
                count<span style="color: #666666">(*)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break down exactly what this traversal is doing.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first expression evaluated is the inner <code>random</code> expression, which returns 500 random basketIDs, from the <code>baskets</code> collection, that have the <code>productID</code> "ABC". The <code>random</code> expression is very useful for recommendations because it limits the traversal to a fixed set of baskets, and because it adds the element of surprise into the recommendation. Using the <code>random</code> function you can provide fast sample sets from very large graphs.</p>
</li>
<li>
<p>The outer <code>gatherNodes</code> expression finds all the records in the <code>baskets</code> collection for the basketIDs generated in step 1. It also filters out <code>productID</code> "ABC" so it doesn&#8217;t show up in the results. It then gathers and counts the productID&#8217;s across these baskets.</p>
</li>
<li>
<p>The outer <code>top</code> expression ranks the productIDs emitted in step 2 by the count and selects the top 5.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In a nutshell this expression finds the products that most frequently co-occur with product "ABC" in past shopping baskets.</p>
</div>
</div>
<div class="sect2">
<h3 id="GraphTraversal-UsingthescoreNodesFunctiontoMakeaRecommendation">Using the scoreNodes Function to Make a Recommendation</h3>
<div class="paragraph">
<p>This use case builds on the market basket example <a href="#GraphTraversal-CalculateMarketBasketCo-occurance">above</a> that calculates which products co-occur most frequently with productID:ABC. The ranked co-occurrence counts provide candidates for a recommendation. The <code>scoreNodes</code> function can be used to score the candidates to find the best recommendation.</p>
</div>
<div class="paragraph">
<p>Before diving into the syntax of the <code>scoreNodes</code> function it&#8217;s useful to understand why the raw co-occurrence counts may not produce the best recommendation. The reason is that raw co-occurrence counts favor items that occur frequently across all baskets. A better recommendation would find the product that has the most significant relationship with productID ABC. The <code>scoreNodes</code> function uses a term frequency-inverse document frequency (TF-IDF) algorithm to find the most significant relationship.</p>
</div>
<div class="sect3">
<h4 id="GraphTraversal-HowItWorks"><strong>How It Works</strong></h4>
<div class="paragraph">
<p>The <code>scoreNodes</code> function assigns a score to each node emitted by the gatherNodes expression. By default the <code>scoreNodes</code> function uses the <code>count(*)</code> aggregation, which is the co-occurrence count, as the TF value. The IDF value for each node is fetched from the collection where the node was gathered. Each node is then scored using the TF*IDF formula, which provides a boost to nodes with a lower frequency across all market baskets.</p>
</div>
<div class="paragraph">
<p>Combining the co-occurrence count with the IDF provides a score that shows how important the relationship is between productID ABC and the recommendation candidates.</p>
</div>
<div class="paragraph">
<p>The <code>scoreNodes</code> function adds the score to each node in the <code>nodeScore</code> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="GraphTraversal-ExampleSyntax"><strong>Example Syntax</strong></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">top<span style="color: #666666">(</span>n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;1&quot;</span><span style="color: #666666">,</span>
    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;nodeScore desc&quot;</span><span style="color: #666666">,</span>
    scoreNodes<span style="color: #666666">(</span>top<span style="color: #666666">(</span>n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;50&quot;</span><span style="color: #666666">,</span>
                   sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*) desc&quot;</span><span style="color: #666666">,</span>
                   gatherNodes<span style="color: #666666">(</span>baskets<span style="color: #666666">,</span>
                               random<span style="color: #666666">(</span>baskets<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;productID:ABC&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;basketID&quot;</span><span style="color: #666666">,</span> rows<span style="color: #666666">=</span><span style="color: #BA2121">&quot;500&quot;</span><span style="color: #666666">),</span>
                               walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;basketID-&gt;basketID&quot;</span><span style="color: #666666">,</span>
                               fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;-productID:ABC&quot;</span><span style="color: #666666">,</span>
                               gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;productID&quot;</span><span style="color: #666666">,</span>
                               count<span style="color: #666666">(*)))))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example builds on the earlier example "Calculate market basket co-occurrence".</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Notice that the inner-most <code>top</code> function is taking the top 50 products that co-occur most frequently with productID ABC. This provides 50 candidate recommendations.</p>
</li>
<li>
<p>The <code>scoreNodes</code> function then assigns a score to the candidates based on the TF*IDF of each node.</p>
</li>
<li>
<p>The outer <code>top</code> expression selects the highest scoring node. This is the recommendation.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="GraphTraversal-RecommendContentBasedonCollaborativeFilter">Recommend Content Based on Collaborative Filter</h3>
<div class="paragraph">
<p>In this example we&#8217;ll recommend content for a user based on a collaborative filter. This recommendation is made using log records that contain the <code>userID</code> and <code>articleID</code> and the action performed. In this scenario each log record can be viewed as an edge in a graph. The userID and articleID are the nodes and the action is an edge property used to filter the traversal.</p>
</div>
<div class="paragraph">
<p>Here is the sample syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">top<span style="color: #666666">(</span>n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;5&quot;</span><span style="color: #666666">,</span>
    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*) desc&quot;</span><span style="color: #666666">,</span>
    gatherNodes<span style="color: #666666">(</span>logs<span style="color: #666666">,</span>
                top<span style="color: #666666">(</span>n<span style="color: #666666">=</span><span style="color: #BA2121">&quot;30&quot;</span><span style="color: #666666">,</span>
                    sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*) desc&quot;</span><span style="color: #666666">,</span>
                    gatherNodes<span style="color: #666666">(</span>logs<span style="color: #666666">,</span>
                                search<span style="color: #666666">(</span>logs<span style="color: #666666">,</span> q<span style="color: #666666">=</span><span style="color: #BA2121">&quot;userID:user1&quot;</span><span style="color: #666666">,</span> fl<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID&quot;</span><span style="color: #666666">,</span> sort<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID asc&quot;</span><span style="color: #666666">,</span> fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:read&quot;</span><span style="color: #666666">,</span> qt<span style="color: #666666">=</span><span style="color: #BA2121">&quot;/export&quot;</span><span style="color: #666666">),</span>
                                walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID-&gt;articleID&quot;</span><span style="color: #666666">,</span>
                                gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;userID&quot;</span><span style="color: #666666">,</span>
                                fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:read&quot;</span><span style="color: #666666">,</span>
                                maxDocFreq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;10000&quot;</span><span style="color: #666666">,</span>
                                count<span style="color: #666666">(*))),</span>
                walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;userID&quot;</span><span style="color: #666666">,</span>
                gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;articleID&quot;</span><span style="color: #666666">,</span>
                fq<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action:read&quot;</span><span style="color: #666666">,</span>
                count<span style="color: #666666">(*)))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break down the expression above step-by-step.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first expression evaluated is the inner <code>search</code> expression. This expression searches the <code>logs</code> collection for all records matching "user1". This is the user we are making the recommendation for. There is a filter applied to pull back only records where the "action:read". It returns the <code>articleID</code> for each record found. In other words, this expression returns all the articles "user1" has read.</p>
</li>
<li>
<p>The inner <code>gatherNodes</code> expression operates over the articleIDs returned from step 1. It takes each <code>articleID</code> found and searches them against the <code>articleID</code> field. Note that it skips high frequency nodes using the <code>maxDocFreq</code> param to filter out articles that appear over 10,000 times in the logs. It gathers userIDs and aggregates the counts for each user. This step finds the users that have read the same articles that "user1" has read and counts how many of the same articles they have read.</p>
</li>
<li>
<p>The inner <code>top</code> expression ranks the users emitted from step 2. It will emit the top 30 users who have the most overlap with user1&#8217;s reading list.</p>
</li>
<li>
<p>The outer <code>gatherNodes</code> expression gathers the reading list for the users emitted from step 3. It counts the articleIDs that are gathered. Any article selected in step 1 (user1 reading list), will not appear in this step due to cycle detection. So this step returns the articles read by the users with the most similar readings habits to "user1" that "user1" has not read yet. It also counts the number of times each article has been read across this user group.</p>
</li>
<li>
<p>The outer <code>top</code> expression takes the top articles emitted from step 4. This is the recommendation.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="GraphTraversal-ProteinPathwayTraversal">Protein Pathway Traversal</h3>
<div class="paragraph">
<p>In recent years, scientists have become increasingly able to rationally design drugs that target the mutated proteins, called oncogenes, responsible for some cancers. Proteins typically act through long chains of chemical interactions between multiple proteins, called pathways, and, while the oncogene in the pathway may not have a corresponding drug, another protein in the pathway may. Graph traversal on a protein collection that records protein interactions and drugs may yield possible candidates. (Thanks to Lewis Geer of the NCBI, for providing this example).</p>
</div>
<div class="paragraph">
<p>The example below illustrates a protein pathway traversal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">gatherNodes<span style="color: #666666">(</span>proteins<span style="color: #666666">,</span>
            gatherNodes<span style="color: #666666">(</span>proteins<span style="color: #666666">,</span>
                        walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;NRAS-&gt;name&quot;</span><span style="color: #666666">,</span>
                        gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;interacts&quot;</span><span style="color: #666666">),</span>
            walk<span style="color: #666666">=</span><span style="color: #BA2121">&quot;node-&gt;name&quot;</span><span style="color: #666666">,</span>
            gather<span style="color: #666666">=</span><span style="color: #BA2121">&quot;drug&quot;</span><span style="color: #666666">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break down exactly what this traversal is doing.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The inner <code>gatherNodes</code> expression traverses in the <code>proteins</code> collection. It finds all the edges in the graph where the name of the protein is "NRAS". Then it gathers the proteins in the <code>interacts</code> field. This gathers all the proteins that "NRAS" interactions with.</p>
</li>
<li>
<p>The outer <code>gatherNodes</code> expression also works with the <code>proteins</code> collection. It gathers all the drugs that correspond to proteins emitted from step 1.</p>
</li>
<li>
<p>Using this stepwise approach you can gather the drugs along the pathway of interactions any number of steps away from the root protein.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="GraphTraversal-ExportingGraphMLtoSupportGraphVisualization">Exporting GraphML to Support Graph Visualization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the examples above, the <code>gatherNodes</code> expression was sent to Solr&#8217;s <code>/stream</code> handler like any other streaming expression. This approach outputs the nodes in the same JSON tuple format as other streaming expressions so that it can be treated like any other streaming expression. You can use the <code>/stream</code> handler when you need to operate directly on the tuples, such as in the recommendation use cases above.</p>
</div>
<div class="paragraph">
<p>There are other graph traversal use cases that involve graph visualization. Solr supports these use cases with the introduction of the <code>/graph</code> request handler, which takes a <code>gatherNodes</code> expression and outputs the results in GraphML.</p>
</div>
<div class="paragraph">
<p><a href="http://graphml.graphdrawing.org/">GraphML</a> is an XML format supported by graph visualization tools such as <a href="https://gephi.org/">Gephi</a>, which is a sophisticated open source tool for statistically analyzing and visualizing graphs. Using a <code>gatherNodes</code> expression, parts of a larger graph can be exported in GraphML and then imported into tools like Gephi.</p>
</div>
<div class="paragraph">
<p>There are a few things to keep mind when exporting a graph in GraphML</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>/graph</code> handler can export both the nodes and edges in the graph. By default, it only exports the nodes. To export the edges you must set <code>trackTraversal="true"</code> in the <code>gatherNodes</code> expression.</p>
</li>
<li>
<p>The <code>/graph</code> handler currently accepts an arbitrarily complex streaming expression which includes a <code>gatherNodes</code> expression. If the streaming expression doesn&#8217;t include a <code>gatherNodes</code> expression, the <code>/graph</code> handler will not properly output GraphML.</p>
</li>
<li>
<p>The <code>/graph</code> handler currently accepts a single arbitrarily complex, nested <code>gatherNodes</code> expression per request. This means you cannot send in a streaming expression that joins or intersects the node sets from multiple <code>gatherNodes</code> expressions. The <code>/graph</code> handler does support any level of nesting within a single <code>gatherNodes</code> expression. The <code>/stream</code> handler does support joining and intersecting node sets, but the <code>/graph</code> handler currently does not.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="GraphTraversal-SampleRequest">Sample Request</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash">curl --data-urlencode <span style="color: #BA2121">&#39;expr=gatherNodes(enron_emails,</span>
<span style="color: #BA2121">                                        gatherNodes(enron_emails,</span>
<span style="color: #BA2121">                                                    walk=&quot;kayne.coulter@enron.com-&gt;from&quot;,</span>
<span style="color: #BA2121">                                                    trackTraversal=&quot;true&quot;,</span>
<span style="color: #BA2121">                                                    gather=&quot;to&quot;),</span>
<span style="color: #BA2121">                                        walk=&quot;node-&gt;from&quot;,</span>
<span style="color: #BA2121">                                        scatter=&quot;leaves,branches&quot;,</span>
<span style="color: #BA2121">                                        trackTraversal=&quot;true&quot;,</span>
<span style="color: #BA2121">                                        gather=&quot;to&quot;)&#39;</span> http://localhost:8983/solr/enron_emails/graph</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="GraphTraversal-SampleGraphMLOutput">Sample GraphML Output</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">&lt;</span>graphml xmlns<span style="color: #666666">=</span><span style="color: #BA2121">&quot;http://graphml.graphdrawing.org/xmlns&quot;</span>
<span style="color: #A0A000">xmlns:</span>xsi<span style="color: #666666">=</span><span style="color: #BA2121">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span style="color: #A0A000">xsi:</span>schemaLocation<span style="color: #666666">=</span><span style="color: #BA2121">&quot;http://graphml.graphdrawing.org/xmlns http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd&quot;</span><span style="color: #666666">&gt;</span>
<span style="color: #666666">&lt;</span>graph id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;G&quot;</span> edgedefault<span style="color: #666666">=</span><span style="color: #BA2121">&quot;directed&quot;</span><span style="color: #666666">&gt;</span>
     <span style="color: #666666">&lt;</span>node id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;kayne.coulter@enron.com&quot;</span><span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">&gt;</span>node<span style="color: #666666">&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">&gt;0&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*)&quot;</span><span style="color: #666666">&gt;0.0&lt;/</span>data<span style="color: #666666">&gt;</span>
     <span style="color: #666666">&lt;/</span>node<span style="color: #666666">&gt;</span>
     <span style="color: #666666">&lt;</span>node id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;don.baughman@enron.com&quot;</span><span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">&gt;</span>to<span style="color: #666666">&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">&gt;1&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*)&quot;</span><span style="color: #666666">&gt;1.0&lt;/</span>data<span style="color: #666666">&gt;</span>
     <span style="color: #666666">&lt;/</span>node<span style="color: #666666">&gt;</span>
     <span style="color: #666666">&lt;</span>edge id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;1&quot;</span>  source<span style="color: #666666">=</span><span style="color: #BA2121">&quot;kayne.coulter@enron.com&quot;</span>  target<span style="color: #666666">=</span><span style="color: #BA2121">&quot;don.baughman@enron.com&quot;</span><span style="color: #666666">/&gt;</span>
     <span style="color: #666666">&lt;</span>node id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;john.kinser@enron.com&quot;</span><span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">&gt;</span>to<span style="color: #666666">&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">&gt;1&lt;/</span>data<span style="color: #666666">&gt;</span>
           <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*)&quot;</span><span style="color: #666666">&gt;1.0&lt;/</span>data<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;/</span>node<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>edge id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;2&quot;</span>  source<span style="color: #666666">=</span><span style="color: #BA2121">&quot;kayne.coulter@enron.com&quot;</span>  target<span style="color: #666666">=</span><span style="color: #BA2121">&quot;john.kinser@enron.com&quot;</span><span style="color: #666666">/&gt;</span>
    <span style="color: #666666">&lt;</span>node id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;jay.wills@enron.com&quot;</span><span style="color: #666666">&gt;</span>
          <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;field&quot;</span><span style="color: #666666">&gt;</span>to<span style="color: #666666">&lt;/</span>data<span style="color: #666666">&gt;</span>
          <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;level&quot;</span><span style="color: #666666">&gt;1&lt;/</span>data<span style="color: #666666">&gt;</span>
          <span style="color: #666666">&lt;</span>data key<span style="color: #666666">=</span><span style="color: #BA2121">&quot;count(*)&quot;</span><span style="color: #666666">&gt;1.0&lt;/</span>data<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;/</span>node<span style="color: #666666">&gt;</span>
    <span style="color: #666666">&lt;</span>edge id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;3&quot;</span>  source<span style="color: #666666">=</span><span style="color: #BA2121">&quot;kayne.coulter@enron.com&quot;</span>  target<span style="color: #666666">=</span><span style="color: #BA2121">&quot;jay.wills@enron.com&quot;</span><span style="color: #666666">/&gt;</span>
<span style="color: #666666">&lt;/</span>graph<span style="color: #666666">&gt;&lt;/</span>graphml<span style="color: #666666">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Adds tags, if any -->
    <div class="tags">
        
    </div>

<!-- Adds nav links on each page -->
    
    
    <div class="scrollnav">
      
      <a class="btn btn-primary prev" href="streaming-expressions.html">Streaming Expressions</a>
      
      
      <a class="btn btn-primary next" href="parallel-sql-interface.html">Parallel SQL Interface</a>
      
    </div>
    

</div>

<!-- Adds comments from Apache's Comment system -->

<div id="comments_thread">
</div>
<script type="text/javascript" src="https://comments.apache.org/show_comments.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=graph-traversal" async="true">
</script>
<noscript>
<iframe width="100%" height="500" src="https://comments.apache.org/iframe.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=graph-traversal"></iframe>
</noscript>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Apache Software Foundation. All rights reserved. <br />
 Site last generated: 2017-04-26 <br />
<p><img src="solr-sunOnly-small.png" alt="Apache Solr"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</div>

</body>

</html>

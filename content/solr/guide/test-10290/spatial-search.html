<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Spatial Search | Apache Solr Reference Guide</title>

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-solr.css">
<link rel="stylesheet" href="css/ref-guide.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Apache Solr Reference Guide" href="https://home.apache.org/~ctargett/RefGuidePOC/jekyll-full/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // we do *NOT* want cookies used to save the current stage of the sidebar
                             // instead the code in sidebar.html will ensure that the current page
                             // (and it's ancestors) are "active" on page load
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="apache-solr-reference-guide.html">&nbsp;<span class="projectTitle"> Solr Ref Guide 7.0</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- Link to Solr website -->
                <li><a href="https://lucene.apache.org/solr/news" target="_blank">Solr News</a></li>
                <!-- Solr Resources dropdown -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Solr Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                       <li><a href="https://lucene.apache.org/solr/7_0_0//solr-core/index.html" target="_blank">Solr Javadocs</a></li>
                       <li><a href="https://git1-us-west.apache.org/repos/asf?p=lucene-solr.git" target="_blank">Lucene/Solr Source Code</a></li>
                       <li><a href="https://lucene.apache.org/solr/resources.html#community" target="_blank">Solr Community Links</a></li>
                    </ul>
                </li>
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Spatial Search">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div class="col-lg-12">&nbsp;</div>
  <!-- Content Row -->
  <div class="row">
    <!-- Sidebar Column -->
    <div class="col-md-3">
      

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Apache Solr Reference Guide <!-- TODO: version from site.data --></li>
  
  <li class="sb-level1">
    <a href="about-this-guide.html">About This Guide</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="getting-started.html">Getting Started</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="installing-solr.html">Installing Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr.html">Running Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-quick-overview.html">A Quick Overview</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="a-step-closer.html">A Step Closer</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-control-script-reference.html">Solr Control Script Reference</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-solr.html">Upgrading Solr</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="using-the-solr-administration-user-interface.html">Using the Solr Administration User Interface</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-the-solr-admin-ui.html">Overview of the Solr Admin UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="getting-assistance.html">Getting Assistance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="logging.html">Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cloud-screens.html">Cloud Screens</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collections-core-admin.html">Collections / Core Admin</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="java-properties.html">Java Properties</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="thread-dump.html">Thread Dump</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collection-specific-tools.html">Collection-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="analysis-screen.html">Analysis Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="dataimport-screen.html">Dataimport Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="documents-screen.html">Documents Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="files-screen.html">Files Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-screen.html">Query Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="stream-screen.html">Stream Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-browser-screen.html">Schema Browser Screen</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="core-specific-tools.html">Core-Specific Tools</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="ping.html">Ping</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="plugins-stats-screen.html">Plugins &amp; Stats Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="replication-screen.html">Replication Screen</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="segments-info.html">Segments Info</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="documents-fields-and-schema-design.html">Documents, Fields, and Schema Design</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-documents-fields-and-schema-design.html">Overview of Documents, Fields, and Schema Design</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-field-types.html">Solr Field Types</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="field-type-definitions-and-properties.html">Field Type Definitions and Properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-types-included-with-solr.html">Field Types Included with Solr</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-currencies-and-exchange-rates.html">Working with Currencies and Exchange Rates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-dates.html">Working with Dates</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-enum-fields.html">Working with Enum Fields</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="working-with-external-files-and-processes.html">Working with External Files and Processes</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="field-properties-by-use-case.html">Field Properties by Use Case</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="defining-fields.html">Defining Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="copying-fields.html">Copying Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="dynamic-fields.html">Dynamic Fields</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="other-schema-elements.html">Other Schema Elements</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schema-api.html">Schema API</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="putting-the-pieces-together.html">Putting the Pieces Together</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="docvalues.html">DocValues</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="schemaless-mode.html">Schemaless Mode</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="understanding-analyzers-tokenizers-and-filters.html">Understanding Analyzers, Tokenizers, and Filters</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="analyzers.html">Analyzers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-tokenizers.html">About Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="about-filters.html">About Filters</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="tokenizers.html">Tokenizers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="filter-descriptions.html">Filter Descriptions</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="charfilterfactories.html">CharFilterFactories</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="language-analysis.html">Language Analysis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="phonetic-matching.html">Phonetic Matching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-your-analyzer.html">Running Your Analyzer</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="indexing-and-basic-data-operations.html">Indexing and Basic Data Operations</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-solr-indexing.html">Introduction to Solr Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="post-tool.html">Post Tool</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-index-handlers.html">Uploading Data with Index Handlers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="transforming-and-indexing-custom-json.html">Transforming and Indexing Custom JSON</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-data-with-solr-cell-using-apache-tika.html">Uploading Data with Solr Cell using Apache Tika</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uploading-structured-data-store-data-with-the-data-import-handler.html">Uploading Structured Data Store Data with the Data Import Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="updating-parts-of-documents.html">Updating Parts of Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="detecting-languages-during-indexing.html">Detecting Languages During Indexing</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="de-duplication.html">De-Duplication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="content-streams.html">Content Streams</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="uima-integration.html">UIMA Integration</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="searching.html">Searching</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="overview-of-searching-in-solr.html">Overview of Searching in Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="velocity-search-ui.html">Velocity Search UI</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="relevance.html">Relevance</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-syntax-and-parsing.html">Query Syntax and Parsing</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="common-query-parameters.html">Common Query Parameters</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-standard-query-parser.html">The Standard Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-dismax-query-parser.html">The DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="the-extended-dismax-query-parser.html">The Extended DisMax Query Parser</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="function-queries.html">Function Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="local-parameters-in-queries.html">Local Parameters in Queries</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="other-parsers.html">Other Parsers</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="faceting.html">Faceting</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blockjoin-faceting.html">BlockJoin Faceting</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="highlighting.html">Highlighting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spell-checking.html">Spell Checking</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="query-re-ranking.html">Query Re-Ranking</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="learning-to-rank.html">Learning To Rank</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="transforming-result-documents.html">Transforming Result Documents</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="suggester.html">Suggester</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="morelikethis.html">MoreLikeThis</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="pagination-of-results.html">Pagination of Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="collapse-and-expand-results.html">Collapse and Expand Results</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-grouping.html">Result Grouping</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="result-clustering.html">Result Clustering</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="spatial-search.html">Spatial Search</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-terms-component.html">The Terms Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-term-vector-component.html">The Term Vector Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-stats-component.html">The Stats Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="the-query-elevation-component.html">The Query Elevation Component</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="response-writers.html">Response Writers</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="velocity-response-writer.html">Velocity Response Writer</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="near-real-time-searching.html">Near Real Time Searching</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="realtime-get.html">RealTime Get</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="exporting-result-sets.html">Exporting Result Sets</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="streaming-expressions.html">Streaming Expressions</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="graph-traversal.html">Graph Traversal</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="parallel-sql-interface.html">Parallel SQL Interface</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="solr-jdbc-dbvisualizer.html">Solr JDBC - DbVisualizer</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-squirrel-sql.html">Solr JDBC - SQuirreL SQL</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-apache-zeppelin.html">Solr JDBC - Apache Zeppelin</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-python-jython.html">Solr JDBC - Python/Jython</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solr-jdbc-r.html">Solr JDBC - R</a>
            
          </li>
          
        </ul>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="the-well-configured-solr-instance.html">The Well-Configured Solr Instance</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="configuring-solrconfig-xml.html">Configuring solrconfig.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="datadir-and-directoryfactory-in-solrconfig.html">DataDir and DirectoryFactory in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="lib-directives-in-solrconfig.html">Lib Directives in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="schema-factory-definition-in-solrconfig.html">Schema Factory Definition in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="indexconfig-in-solrconfig.html">IndexConfig in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requesthandlers-and-searchcomponents-in-solrconfig.html">RequestHandlers and SearchComponents in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="initparams-in-solrconfig.html">InitParams in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="updatehandlers-in-solrconfig.html">UpdateHandlers in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="query-settings-in-solrconfig.html">Query Settings in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="requestdispatcher-in-solrconfig.html">RequestDispatcher in SolrConfig</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="update-request-processors.html">Update Request Processors</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="codec-factory.html">Codec Factory</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-cores-and-solr-xml.html">Solr Cores and solr.xml</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="format-of-solr-xml.html">Format of solr.xml</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="defining-core-properties.html">Defining core.properties</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="coreadmin-api.html">CoreAdmin API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-sets.html">Config Sets</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuration-apis.html">Configuration APIs</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="blob-store-api.html">Blob Store API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="config-api.html">Config API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="request-parameters-api.html">Request Parameters API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="managed-resources.html">Managed Resources</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="implicit-requesthandlers.html">Implicit RequestHandlers</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="solr-plugins.html">Solr Plugins</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="adding-custom-plugins-in-solrcloud-mode.html">Adding Custom Plugins in SolrCloud Mode</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="jvm-settings.html">JVM Settings</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="managing-solr.html">Managing Solr</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="taking-solr-to-production.html">Taking Solr to Production</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="securing-solr.html">Securing Solr</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="authentication-and-authorization-plugins.html">Authentication and Authorization Plugins</a>
            
            <ul>
              
              <li class="sb-level4">
                <a href="basic-authentication-plugin.html">Basic Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="hadoop-authentication-plugin.html">Hadoop Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="kerberos-authentication-plugin.html">Kerberos Authentication Plugin</a>
                
              </li>
              
              <li class="sb-level4">
                <a href="rule-based-authorization-plugin.html">Rule-Based Authorization Plugin</a>
                
              </li>
              
            </ul>
            
          </li>
          
          <li class="sb-level3">
            <a href="enabling-ssl.html">Enabling SSL</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="running-solr-on-hdfs.html">Running Solr on HDFS</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="making-and-restoring-backups.html">Making and Restoring Backups</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="configuring-logging.html">Configuring Logging</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-jmx-with-solr.html">Using JMX with Solr</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="mbean-request-handler.html">MBean Request Handler</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="performance-statistics-reference.html">Performance Statistics Reference</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="metrics-reporting.html">Metrics Reporting</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="v2-api.html">v2 API</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="solrcloud.html">SolrCloud</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="getting-started-with-solrcloud.html">Getting Started with SolrCloud</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="how-solrcloud-works.html">How SolrCloud Works</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="shards-and-indexing-data-in-solrcloud.html">Shards and Indexing Data in SolrCloud</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="distributed-requests.html">Distributed Requests</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="read-and-write-side-fault-tolerance.html">Read and Write Side Fault Tolerance</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="solrcloud-configuration-and-parameters.html">SolrCloud Configuration and Parameters</a>
        
        <ul>
          
          <li class="sb-level3">
            <a href="setting-up-an-external-zookeeper-ensemble.html">Setting Up an External ZooKeeper Ensemble</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="using-zookeeper-to-manage-configuration-files.html">Using ZooKeeper to Manage Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="zookeeper-access-control.html">ZooKeeper Access Control</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="collections-api.html">Collections API</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="parameter-reference.html">Parameter Reference</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="command-line-utilities.html">Command Line Utilities</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="solrcloud-with-legacy-configuration-files.html">SolrCloud with Legacy Configuration Files</a>
            
          </li>
          
          <li class="sb-level3">
            <a href="configsets-api.html">ConfigSets API</a>
            
          </li>
          
        </ul>
        
      </li>
      
      <li class="sb-level2">
        <a href="rule-based-replica-placement.html">Rule-based Replica Placement</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="cross-data-center-replication-cdcr-.html">Cross Data Center Replication (CDCR)</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="legacy-scaling-and-distribution.html">Legacy Scaling and Distribution</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-scaling-and-distribution.html">Introduction to Scaling and Distribution</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="distributed-search-with-index-sharding.html">Distributed Search with Index Sharding</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="index-replication.html">Index Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="combining-distribution-and-replication.html">Combining Distribution and Replication</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="merging-indexes.html">Merging Indexes</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="client-apis.html">Client APIs</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="introduction-to-client-apis.html">Introduction to Client APIs</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="choosing-an-output-format.html">Choosing an Output Format</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="client-api-lineup.html">Client API Lineup</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-javascript.html">Using JavaScript</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-python.html">Using Python</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solrj.html">Using SolrJ</a>
        
      </li>
      
      <li class="sb-level2">
        <a href="using-solr-from-ruby.html">Using Solr From Ruby</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="major-changes-from-solr-5-to-solr-6.html">Major Changes from Solr 5 to Solr 6</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="upgrading-a-solr-cluster.html">Upgrading a Solr Cluster</a>
    
    <ul>
      
      <li class="sb-level2">
        <a href="indexupgrader-tool.html">IndexUpgrader Tool</a>
        
      </li>
      
    </ul>
    
  </li>
  
  <li class="sb-level1">
    <a href="further-assistance.html">Further Assistance</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="solr-glossary.html">Solr Glossary</a>
    
  </li>
  
  <li class="sb-level1">
    <a href="errata.html">Errata</a>
    
  </li>
  
</ul>


<!-- set the 'active' class on the current page and ancestors -->
<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("#mysidebar a[href='spatial-search.html']").parents('li').toggleClass("active", true);</script>
<!-- set the 'current' class on the current page and 'current-tree' on the current page + it's ancestors -->
<!-- this can let us do css highlighting of the current page in the sidebar even if/when the user clicks around in the sidebar causing other sidebar elements to be 'active' -->
<script>
  $("#mysidebar a[href='spatial-search.html']").parent('li').toggleClass("current", true);
  $("#mysidebar a[href='spatial-search.html']").parents('li').toggleClass("current-tree", true);
</script>

    </div>
    <!-- Content Column -->
    <div class="col-md-9">
      <div class="post-header">
   <h1 class="post-title-main">Spatial Search</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 2, listType: 'ul', showSpeed: 0, headers: 'h2,h3' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    

<div id="main-content">
  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Solr supports location data for use in spatial/geospatial searches. Using spatial search, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Index points or other shapes</p>
</li>
<li>
<p>Filter search results by a bounding box or circle or by other shapes</p>
</li>
<li>
<p>Sort or boost scoring by distance between points, or relative area between rectangles</p>
</li>
<li>
<p>Generate a 2D grid of facet count numbers for heatmap generation or point-plotting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are four main field types available for spatial search:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LatLonPointSpatialField</code></p>
</li>
<li>
<p><code>LatLonType</code> (now deprecated) and its non-geodetic twin PointType</p>
</li>
<li>
<p><code>SpatialRecursivePrefixTreeFieldType</code> (RPT for short), including <code>RptWithGeometrySpatialField</code>, a derivative</p>
</li>
<li>
<p><code>BBoxField</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>LatLonPointSpatialField is the ideal field type for the most common use-cases for lat-lon point data. It replaces LatLonType which still exists for backwards compatibility. RPT offers some more features for more advanced/custom use cases / options like polygons and heatmaps.</p>
</div>
<div class="paragraph">
<p>RptWithGeometrySpatialField is for indexing and searching non-point data though it can do points too. It can&#8217;t do sorting/boosting.</p>
</div>
<div class="paragraph">
<p>BBoxField is for indexing bounding boxes, querying by a box, specifying a search predicate (Intersects,Within,Contains,Disjoint,Equals), and a relevancy sort/boost like overlapRatio or simply the area.</p>
</div>
<div class="paragraph">
<p>Some esoteric details that are not in this guide can be found at <a href="http://wiki.apache.org/solr/SpatialSearch" class="bare">http://wiki.apache.org/solr/SpatialSearch</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-LatLonPointSpatialField">LatLonPointSpatialField</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here&#8217;s how LatLonPointSpatialField should usually be configured in the schema:</p>
</div>
<div class="paragraph">
<p><code>&lt;fieldType name="location" class="solr.LatLonPointSpatialField" docValues="true"/&gt;</code></p>
</div>
<div class="paragraph">
<p>LLPSF supports toggling <code>indexed</code>, <code>stored</code>, <code>docValues</code>, and <code>multiValued</code>. LLPSF internally uses a 2-dimensional Lucene "Points" (BDK tree) index when "indexed" is enabled (the default). When "docValues" is enabled, a latitude and longitudes pair are bit-interleaved into 64 bits and put into Lucene DocValues. The accuracy of the docValues data is about a centimeter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-IndexingPoints">Indexing Points</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For indexing geodetic points (latitude and longitude), supply it in "lat,lon" order (comma separated).</p>
</div>
<div class="paragraph">
<p>For indexing non-geodetic points, it depends. Use "x y" (a space) if RPT. For PointType however, use "x,y" (a comma).</p>
</div>
<div class="paragraph">
<p>If you&#8217;d rather use a standard industry format, Solr supports WKT and GeoJSON. However it&#8217;s much bulkier than the raw coordinates for such simple data. (Not supported by the deprecated LatLonType or PointType)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-SearchingwithQueryParsers">Searching with Query Parsers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two spatial Solr "query parsers" for geospatial search: <code>geofilt</code> and <code>bbox</code>. They take the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the radial distance, usually in kilometers. (RPT &amp; BBoxField can set other units via the setting <code>distanceUnits</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the center point using the format "lat,lon" if latitude &amp; longitude. Otherwise, "x,y" for PointType or "x y" for RPT field types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sfield</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a spatial indexed field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">score</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>(Advanced option; not supported by LatLonType (deprecated) or PointType) If the query is used in a scoring context (e.g. as the main query in <code>q</code>), this <em><a href="local-parameters-in-queries.html#local-parameters-in-queries">local parameter</a></em> determines what scores will be produced. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code> - A fixed score of 1.0. (the default)</p>
</li>
<li>
<p><code>kilometers</code> - distance in kilometers between the field value and the specified center point</p>
</li>
<li>
<p><code>miles</code> - distance in miles between the field value and the specified center point</p>
</li>
<li>
<p><code>degrees</code> - distance in degrees between the field value and the specified center point</p>
</li>
<li>
<p><code>distance</code> - distance between the field value and the specified center point in the <code>distanceUnits</code> configured for this field</p>
</li>
<li>
<p><code>recipDistance</code> - 1 / the distance</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t use this for indexed non-point shapes (e.g. polygons). The results will be erroneous. And with RPT, it&#8217;s only recommended for multi-valued point data, as the implementation doesn&#8217;t scale very well and for single-valued fields, you should instead use a separate non-RPT field purely for distance sorting.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When used with <code>BBoxField</code>, additional options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>overlapRatio</code> - The relative overlap between the indexed shape &amp; query shape.</p>
</li>
<li>
<p><code>area</code> - haversine based area of the overlapping shapes expressed in terms of the <code>distanceUnits</code> configured for this field</p>
</li>
<li>
<p><code>area2D</code> - cartesian coordinates based area of the overlapping shapes expressed in terms of the <code>distanceUnits</code> configured for this field</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Advanced option; not supported by LatLonType (deprecated) or PointType). If you only want the query to score (with the above <code>score</code> local parameter), not filter, then set this local parameter to false.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="SpatialSearch-geofilt"><code>geofilt</code></h3>
<div class="paragraph">
<p>The <code>geofilt</code> filter allows you to retrieve results based on the geospatial distance (AKA the "great circle distance") from a given point. Another way of looking at it is that it creates a circular shape filter. For example, to find all documents within five kilometers of a given lat/lon point, you could enter <code>&amp;q=<strong>:</strong>&amp;fq={!geofilt sfield=store}&amp;pt=45.15,-93.85&amp;d=5</code>. This filter returns all results within a circle of the given radius around the initial point:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spatial-search/circle.png" alt="image">
</div>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-bbox"><code>bbox</code></h3>
<div class="paragraph">
<p>The <code>bbox</code> filter is very similar to <code>geofilt</code> except it uses the <em>bounding box</em> of the calculated circle. See the blue box in the diagram below. It takes the same parameters as geofilt. Here&#8217;s a sample query: <code>&amp;q=<strong>:</strong>&amp;fq={!bbox sfield=store}&amp;pt=45.15,-93.85&amp;d=5</code>. The rectangular shape is faster to compute and so it&#8217;s sometimes used as an alternative to geofilt when it&#8217;s acceptable to return points outside of the radius. However, if the ideal goal is a circle but you want it to run faster, then instead consider using the RPT field and try a large "distErrPct" value like <code>0.1</code> (10% radius). This will return results outside the radius but it will do so somewhat uniformly around the shape.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spatial-search/bbox.png" alt="image">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a bounding box includes a pole, the bounding box ends up being a "bounding bowl" (a <em>spherical cap</em>) that includes all values north of the lowest latitude of the circle if it touches the north pole (or south of the highest latitude if it touches the south pole).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-Filteringbyanarbitraryrectangle">Filtering by an arbitrary rectangle</h3>
<div class="paragraph">
<p>Sometimes the spatial search requirement calls for finding everything in a rectangular area, such as the area covered by a map the user is looking at. For this case, geofilt and bbox won&#8217;t cut it. This is somewhat of a trick, but you can use Solr&#8217;s range query syntax for this by supplying the lower-left corner as the start of the range and the upper-right corner as the end of the range. Here&#8217;s an example: <code>&amp;q=<strong>:</strong>&amp;fq=store:[45,-94 TO 46,-93]</code>. LatLonType (deprecated) does <strong>not</strong> support rectangles that cross the dateline. For RPT and BBoxField, if you are non-geospatial coordinates (<code>geo="false"</code>) then you must quote the points due to the space, e.g. <code>"x y"</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-Optimizing_CacheorNot">Optimizing: Cache or Not</h3>
<div class="paragraph">
<p>It&#8217;s most common to put a spatial query into an "fq" parameter – a filter query. By default, Solr will cache the query in the filter cache. If you know the filter query (be it spatial or not) is fairly unique and not likely to get a cache hit then specify <code>cache="false"</code> as a local-param as seen in the following example. The only spatial types which stand to benefit from this technique are LatLonPointSpatialField and LatLonType (deprecated). Enable docValues on the field (if it isn&#8217;t already). LatLonType (deprecated) additionally requires a <code>cost="100"</code> (or more) local-param.</p>
</div>
<div class="paragraph">
<p><code>&amp;q=&#8230;&#8203;mykeywords&#8230;&#8203;&amp;fq=&#8230;&#8203;someotherfilters&#8230;&#8203;&amp;fq={!geofilt cache=false}&amp;sfield=store&amp;pt=45.15,-93.85&amp;d=5</code></p>
</div>
<div class="paragraph">
<p>LLPSF does not support Solr&#8217;s "PostFilter".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-DistanceSortingorBoosting_FunctionQueries_">Distance Sorting or Boosting (Function Queries)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are four distance function queries: <code>geodist</code>, see below, usually the most appropriate; <a href="http://wiki.apache.org/solr/FunctionQuery#dist"><code>dist</code></a>, to calculate the p-norm distance between multi-dimensional vectors; <a href="http://wiki.apache.org/solr/FunctionQuery#hsin.2C_ghhsin_-" class="bare">http://wiki.apache.org/solr/FunctionQuery#hsin.2C_ghhsin_-</a><em>Haversine_Formula[<code>hsin</code>], to calculate the distance between two points on a sphere; and <a href="https://wiki.apache.org/solr/FunctionQuery#sqedist" class="bare">https://wiki.apache.org/solr/FunctionQuery#sqedist</a></em>-_Squared_Euclidean_Distance[<code>sqedist</code>], to calculate the squared Euclidean distance between two points. For more information about these function queries, see the section on <a href="function-queries.html#function-queries">Function Queries</a>.</p>
</div>
<div class="sect2">
<h3 id="SpatialSearch-geodist"><code>geodist</code></h3>
<div class="paragraph">
<p><code>geodist</code> is a distance function that takes three optional parameters: <code>(sfield,latitude,longitude)</code>. You can use the <code>geodist</code> function to sort results by distance or score return results.</p>
</div>
<div class="paragraph">
<p>For example, to sort your results by ascending distance, enter <code>&#8230;&#8203;&amp;q=<strong>:</strong>&amp;fq={!geofilt}&amp;sfield=store&amp;pt=45.15,-93.85&amp;d=50&amp;sort=geodist() asc</code>.</p>
</div>
<div class="paragraph">
<p>To return the distance as the document score, enter <code>&#8230;&#8203;&amp;q={!func}geodist()&amp;sfield=store&amp;pt=45.15,-93.85&amp;sort=score+asc</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-MoreExamples">More Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here are a few more useful examples of what you can do with spatial search in Solr.</p>
</div>
<div class="sect2">
<h3 id="SpatialSearch-UseasaSub-QuerytoExpandSearchResults">Use as a Sub-Query to Expand Search Results</h3>
<div class="paragraph">
<p>Here we will query for results in Jacksonville, Florida, or within 50 kilometers of 45.15,-93.85 (near Buffalo, Minnesota):</p>
</div>
<div class="paragraph">
<p><code>&amp;q=<strong>:</strong>&amp;fq=(state:"FL" AND city:"Jacksonville") OR {!geofilt}&amp;sfield=store&amp;pt=45.15,-93.85&amp;d=50&amp;sort=geodist()+asc</code></p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-FacetbyDistance">Facet by Distance</h3>
<div class="paragraph">
<p>To facet by distance, you can use the Frange query parser:</p>
</div>
<div class="paragraph">
<p><code>&amp;q=<strong>:</strong>&amp;sfield=store&amp;pt=45.15,-93.85&amp;facet.query={!frange l=0 u=5}geodist()&amp;facet.query={!frange l=5.001 u=3000}geodist()</code></p>
</div>
<div class="paragraph">
<p>There are other ways to do it too, like using a \{!geofilt} in each facet.query.</p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-BoostNearestResults">Boost Nearest Results</h3>
<div class="paragraph">
<p>Using the <a href="the-dismax-query-parser.html#the-dismax-query-parser">DisMax</a> or <a href="the-extended-dismax-query-parser.html#the-extended-dismax-query-parser">Extended DisMax</a>, you can combine spatial search with the boost function to boost the nearest results:</p>
</div>
<div class="paragraph">
<p><code>&amp;q.alt=<strong>:</strong>&amp;fq={!geofilt}&amp;sfield=store&amp;pt=45.15,-93.85&amp;d=50&amp;bf=recip(geodist(),2,200,20)&amp;sort=score desc</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-RPT">RPT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>RPT refers to either <code>SpatialRecursivePrefixTreeFieldType</code> (aka simply RPT) and an extended version: <code>RptWithGeometrySpatialField</code> (aka RPT with Geometry). RPT offers several functional improvements over LatLonPointSpatialField:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non-geodetic – geo=false general x &amp; y (<em>not</em> latitude and longitude)</p>
</li>
<li>
<p>Query by polygons and other complex shapes, in addition to circles &amp; rectangles</p>
</li>
<li>
<p>Ability to index non-point shapes (e.g. polygons) as well as points – see RptWithGeometrySpatialField</p>
</li>
<li>
<p>Heatmap grid faceting</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RPT <em>shares</em> various features in common with LatLonPointSpatialField. Some are listed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Latitude/Longitude indexed point data; possibly multi-valued</p>
</li>
<li>
<p>Fast filtering with geofilt, bbox filters, and range query syntax (dateline crossing is supported)</p>
</li>
<li>
<p>Sort/boost via geodist</p>
</li>
<li>
<p>Well-Known-Text (WKT) shape syntax (required for specifying polygons &amp; other complex shapes), and GeoJSON too. In addition to indexing and searching, this works with the <code>wt=geojson</code> (GeoJSON Solr response-writer) and <code>[geo f=myfield]</code> (geo Solr document-transformer).</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="SpatialSearch-Schemaconfiguration">Schema configuration</h3>
<div class="paragraph">
<p>To use RPT, the field type must be registered and configured in <code>schema.xml</code>. There are many options for this field type.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the field type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This should be <code>solr.SpatialRecursivePrefixTreeFieldType</code>. But be aware that the Lucene spatial module includes some other so-called "spatial strategies" other than RPT, notably TermQueryPT*, BBox, PointVector*, and SerializedDV. Solr requires a field type to parallel these in order to use them. The asterisked ones have them.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spatialContextFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a Java class name to an internal extension point governing support for shape definitions &amp; parsing. If you require polygon support, set this to <code>JTS</code> – an alias for <code>org.locationtech.spatial4j.context.jts.JtsSpatialContextFactory</code>; otherwise it can be omitted. See important info below about JTS. (note: prior to Solr 6, the "org.locationtech.spatial4j" part was "com.spatial4j.core" and there used to be no convenience JTS alias)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">geo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <strong>true</strong>, the default, latitude and longitude coordinates will be used and the mathematical model will generally be a sphere. If false, the coordinates will be generic X &amp; Y on a 2D plane using Euclidean/Cartesian geometry.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the shape syntax/format to be used. Defaults to <code>WKT</code> but <code>GeoJSON</code> is another popular format. Spatial4j governs this feature and supports <a href="https://locationtech.github.io/spatial4j/apidocs/org/locationtech/spatial4j/io/package-frame.html">other formats</a>. If a given shape is parseable as "lat,lon" or "x y" then that is always supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">distanceUnits</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>This is used to specify the units for distance measurements used throughout the use of this field. This can be <code>degrees</code>, <code>kilometers</code> or <code>miles</code>. It is applied to nearly all distance measurements involving the field: <code>maxDistErr</code>, <code>distErr</code>, <code>d</code>, <code>geodist</code> and the <code>score</code> when score is <code>distance</code>, <code>area</code>, or <code>area2d</code>. However, it doesn&#8217;t affect distances embedded in WKT strings, (eg: &#8220;BUFFER(POINT(200 10),0.2)&#8221;), which are still in degrees.</p>
</div>
<div class="paragraph">
<p><code>distanceUnits</code> defaults to either &#8220;<code>kilometers</code>&#8221; if <code>geo</code> is &#8220;<code>true</code>&#8221;, or &#8220;<code>degrees</code>&#8221; if <code>geo</code> is &#8220;<code>false</code>&#8221;.</p>
</div>
<div class="paragraph">
<p><code>distanceUnits</code> replaces the <code>units</code> attribute; which is now deprecated and mutually exclusive with this attribute.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">distErrPct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the default precision of non-point shapes (both index &amp; query), as a fraction between 0.0 (fully precise) to 0.5. The closer this number is to zero, the more accurate the shape will be. However, more precise indexed shapes use more disk space and take longer to index. Bigger distErrPct values will make queries faster but less accurate. At query time this can be overridden in the query syntax, such as to 0.0 so as to not approximate the search shape. The default for the RPT field is 0.025. Note: For RPTWithGeometrySpatialField (see below), there&#8217;s always complete accuracy with the serialized geometry and so this doesn&#8217;t control accuracy so much as it controls the trade-off of how big the index should be. distErrPct defaults to 0.15 for that field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxDistErr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the highest level of detail required for indexed data. If left blank, the default is one meter – just a bit less than 0.000009 degrees. This setting is used internally to compute an appropriate maxLevels (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">worldBounds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the valid numerical ranges for x and y, in the format of <code>ENVELOPE(minX, maxX, maxY, minY)</code>. If <code>geo="true"</code>, the standard lat-lon world boundaries are assumed. If <code>geo=false</code>, you should define your boundaries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">distCalculator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the distance calculation algorithm. If <code>geo=true</code>, "haversine" is the default. If <code>geo=false</code>, "cartesian" will be the default. Other possible values are "lawOfCosines", "vincentySphere" and "cartesian^2".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefixTree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the spatial grid implementation. Since a PrefixTree (such as RecursivePrefixTree) maps the world as a grid, each grid cell is decomposed to another set of grid cells at the next level. If <code>geo=true</code> then the default prefix tree is &#8220;<code>geohash</code>&#8221;, otherwise it&#8217;s &#8220;<code>quad</code>&#8221;. Geohash has 32 children at each level, quad has 4. Geohash can only be used for <code>geo=true</code> as it&#8217;s strictly geospatial. A third choice is &#8220;<code>packedQuad</code>&#8221;, which is generally more efficient than plain "quad", provided there are many levels&#8201;&#8212;&#8201;perhaps 20 or more.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxLevels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum grid depth for indexed data. Instead, it&#8217;s usually more intuitive to compute an appropriate maxLevels by specifying <code>maxDistErr</code> .</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong><em>And there are others:</em></strong> <code>normWrapLongitude</code> <em>,</em> <code>datelineRule</code>, <code>validationRule</code>, <code>autoIndex</code>, <code>allowMultiOverlap</code>, <code>precisionModel</code>. For further info, see notes below about spatialContextFactory implementations referenced above, especially the link to the JTS based one.</p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-JTSandPolygons">JTS and Polygons</h3>
<div class="paragraph">
<p>As indicated above, <code>spatialContextFactory</code> must be set to <code>JTS</code> for polygon support, including multi-polygon. All other shapes, including even line-strings, are supported without JTS. JTS stands for <a href="http://sourceforge.net/projects/jts-topo-suite/">JTS Topology Suite</a>, which does not come with Solr due to its LGPL license. You must download it (a JAR file) and put that in a special location internal to Solr: <code>SOLR_INSTALL/server/solr-webapp/webapp/WEB-INF/lib/</code>. You can readily download it here: <a href="https://repo1.maven.org/maven2/com/vividsolutions/jts-core/" class="bare">https://repo1.maven.org/maven2/com/vividsolutions/jts-core/</a>. It will not work if placed in other more typical Solr lib directories, unfortunately. When activated, there are additional configuration attributes available; see <a href="https://locationtech.github.io/spatial4j/apidocs/org/locationtech/spatial4j/context/jts/JtsSpatialContextFactory.html">org.locationtech.spatial4j.context.jts.JtsSpatialContextFactory</a> for the Javadocs, and remember to look at the superclass&#8217;s options in as well. One option in particular you should most likely enable is <code>autoIndex</code> (i.e., use JTS&#8217;s PreparedGeometry) as it&#8217;s been shown to be a major performance boost for non-trivial polygons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span style="color: #008000; font-weight: bold">&lt;fieldType</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;location_rpt&quot;</span>   <span style="color: #7D9029">class=</span><span style="color: #BA2121">&quot;solr.SpatialRecursivePrefixTreeFieldType&quot;</span>
               <span style="color: #7D9029">spatialContextFactory=</span><span style="color: #BA2121">&quot;org.locationtech.spatial4j.context.jts.JtsSpatialContextFactory&quot;</span>
               <span style="color: #7D9029">autoIndex=</span><span style="color: #BA2121">&quot;true&quot;</span>
               <span style="color: #7D9029">validationRule=</span><span style="color: #BA2121">&quot;repairBuffer0&quot;</span>
               <span style="color: #7D9029">distErrPct=</span><span style="color: #BA2121">&quot;0.025&quot;</span>
               <span style="color: #7D9029">maxDistErr=</span><span style="color: #BA2121">&quot;0.001&quot;</span>
               <span style="color: #7D9029">distanceUnits=</span><span style="color: #BA2121">&quot;kilometers&quot;</span> <span style="color: #008000; font-weight: bold">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the field type has been defined, define a field that uses it.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example polygon query for a field "geo" that can be either solr.SpatialRecursivePrefixTreeFieldType or RptWithGeometrySpatialField:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&amp;q=*:*&amp;fq={!field f=geo}Intersects(POLYGON((-10 30, -40 40, -10 -20, 40 20, 0 0, -10 30)))</pre>
</div>
</div>
<div class="paragraph">
<p>Inside the parenthesis following the search predicate is the shape definition. The format of that shape is governed by the <code>format</code> attribute on the field type, defaulting to WKT. If you prefer GeoJSON, you can specify that instead.</p>
</div>
<div class="paragraph">
<p><strong>Beyond this reference guide and Spatila4j&#8217;s docs, there are some details that remain at the Solr Wiki at</strong> <a href="http://wiki.apache.org/solr/SolrAdaptersForLuceneSpatial4" class="bare">http://wiki.apache.org/solr/SolrAdaptersForLuceneSpatial4</a></p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-RptWithGeometrySpatialField">RptWithGeometrySpatialField</h3>
<div class="paragraph">
<p>The <code>RptWithGeometrySpatialField</code> field type is a derivative of <code>SpatialRecursivePrefixTreeFieldType</code> that also stores the original geometry internally in Lucene DocValues, which it uses to achieve accurate search. It can also be used for indexed point fields. The Intersects predicate (the default) is particularly fast, since many search results can be returned as an accurate hit without requiring a geometry check. This field type is configured just like RPT except that the default <code>distErrPct</code> is 0.15 (higher than 0.025) because the grid squares are purely for performance and not to fundamentally represent the shape.</p>
</div>
<div class="paragraph">
<p>An optional in-memory cache can be defined in <code>solrconfig.xml</code>, which should be done when the data tends to have shapes with many vertices. Assuming you name your field "geom", you can configure an optional cache in solrconfig.xml by adding the following – notice the suffix of the cache name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span style="color: #008000; font-weight: bold">&lt;cache</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;perSegSpatialFieldCache_geom&quot;</span>
           <span style="color: #7D9029">class=</span><span style="color: #BA2121">&quot;solr.LRUCache&quot;</span>
           <span style="color: #7D9029">size=</span><span style="color: #BA2121">&quot;256&quot;</span>
           <span style="color: #7D9029">initialSize=</span><span style="color: #BA2121">&quot;0&quot;</span>
           <span style="color: #7D9029">autowarmCount=</span><span style="color: #BA2121">&quot;100%&quot;</span>
           <span style="color: #7D9029">regenerator=</span><span style="color: #BA2121">&quot;solr.NoOpRegenerator&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using this field type, you will likely <em>not</em> want to mark the field as stored because it&#8217;s redundant with the DocValues data and surely larger because of the formatting (be it WKT or GeoJSON). To retrieve the spatial data in search results from DocValues, use the <code>[geo]</code> transformer&#8201;&#8212;&#8201;<a href="transforming-result-documents.html#transforming-result-documents">Transforming Result Documents</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="SpatialSearch-HeatmapFaceting">Heatmap Faceting</h3>
<div class="paragraph">
<p>The RPT field supports generating a 2D grid of facet counts for documents having spatial data in each grid cell. For high-detail grids, this can be used to plot points, and for lesser detail it can be used for heatmap generation. The grid cells are determined at index-time based on RPT&#8217;s configuration. At facet counting time, the indexed cells in the region of interest are traversed and a grid of counters corresponding to each cell are incremented. Solr can return the data in a straight-forward 2D array of integers or in a PNG which compresses better for larger data sets but must be decoded.</p>
</div>
<div class="paragraph">
<p>The heatmap feature is accessed from Solr&#8217;s faceting feature. As a part of faceting, it supports the <code>key</code> local parameter as well as excluding tagged filter queries, just like other types of faceting do. This allows multiple heatmaps to be returned on the same field with different filters.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to enable faceting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The field name of type RPT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap.geom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The region to compute the heatmap on, specified using the rectangle-range syntax or WKT. It defaults to the world. ex: <code>["-180 -90" TO "180 90"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap.gridLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A specific grid level, which determines how big each grid cell is. Defaults to being computed via distErrPct (or distErr)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap.distErrPct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A fraction of the size of geom used to compute gridLevel. Defaults to 0.15. It&#8217;s computed the same as a similarly named parameter for RPT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap.distErr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A cell error distance used to pick the grid level indirectly. It&#8217;s computed the same as a similarly named parameter for RPT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">facet.heatmap.format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format, either <code>ints2D</code> (default) or <code>png</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Tip</div>
<div class="paragraph">
<p>You&#8217;ll experiment with different distErrPct values (probably 0.10 - 0.20) with various input geometries till the default size is what you&#8217;re looking for. The specific details of how it&#8217;s computed isn&#8217;t important. For high-detail grids used in point-plotting (loosely one cell per pixel), set distErr to be the number of decimal-degrees of several pixels or so of the map being displayed. Also, you probably don&#8217;t want to use a geohash based grid because the cell orientation between grid levels flip-flops between being square and rectangle. Quad is consistent and has more levels, albeit at the expense of a larger index.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s some sample output in JSON (with some &#8230;&#8203;.. inserted for brevity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span style="color: #666666">{</span>gridLevel<span style="color: #666666">=6,</span>columns<span style="color: #666666">=64,</span>rows<span style="color: #666666">=64,</span>minX<span style="color: #666666">=-180.0,</span>maxX<span style="color: #666666">=180.0,</span>minY<span style="color: #666666">=-90.0,</span>maxY<span style="color: #666666">=90.0,</span>
counts_ints2D<span style="color: #666666">=[[0,</span> <span style="color: #666666">0,</span> <span style="color: #666666">2,</span> <span style="color: #666666">1,</span> <span style="color: #666666">....],[1,</span> <span style="color: #666666">1,</span> <span style="color: #666666">3,</span> <span style="color: #666666">2,</span> <span style="color: #666666">...],...]}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output shows the gridLevel which is interesting since it&#8217;s often computed from other parameters. If an interface being developed allows an explicit resolution increase/decrease feature then subsequent requests can specify the gridLevel explicitly.</p>
</div>
<div class="paragraph">
<p>The <code>minX</code>, <code>maxX</code>, <code>minY</code>, <code>maxY</code> reports the region where the counts are. This is the minimally enclosing bounding rectangle of the input <code>geom</code> at the target grid level. This may wrap the dateline. The <code>columns</code> and <code>rows</code> values are how many columns and rows that the output rectangle is to be divided by evenly. Note: Don&#8217;t divide an on-screen projected map rectangle evenly to plot these rectangles/points since the cell data is in the coordinate space of decimal degrees if geo=true or whatever units were given if geo=false. This could be arranged to be the same as an on-screen map but won&#8217;t necessarily be.</p>
</div>
<div class="paragraph">
<p>The <code>counts_ints2D</code> key has a 2D array of integers. The initial outer level is in row order (top-down), then the inner arrays are the columns (left-right). If any array would be all zeros, a null is returned instead for efficiency reasons. The entire value is null if there is no matching spatial data.</p>
</div>
<div class="paragraph">
<p>If <code>format=png</code> then the output key is <code>counts_png</code>. It&#8217;s a base-64 encoded string of a 4-byte PNG. The PNG logically holds exactly the same data that the ints2D format does. Note that the alpha channel byte is flipped to make it easier to view the PNG for diagnostic purposes, since otherwise counts would have to exceed 2^24 before it becomes non-opague. Thus counts greater than this value will become opaque.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SpatialSearch-BBoxField">BBoxField</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>BBoxField</code> field type indexes a single rectangle (bounding box) per document field and supports searching via a bounding box. It supports most spatial search predicates, it has enhanced relevancy modes based on the overlap or area between the search rectangle and the indexed rectangle. It&#8217;s particularly useful for its relevancy modes. To configure it in the schema, use a configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span style="color: #008000; font-weight: bold">&lt;field</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;bbox&quot;</span> <span style="color: #7D9029">type=</span><span style="color: #BA2121">&quot;bbox&quot;</span> <span style="color: #008000; font-weight: bold">/&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;fieldType</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;bbox&quot;</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">&quot;solr.BBoxField&quot;</span>
        <span style="color: #7D9029">geo=</span><span style="color: #BA2121">&quot;true&quot;</span> <span style="color: #7D9029">units=</span><span style="color: #BA2121">&quot;kilometers&quot;</span> <span style="color: #7D9029">numberType=</span><span style="color: #BA2121">&quot;_bbox_coord&quot;</span> <span style="color: #7D9029">storeSubFields=</span><span style="color: #BA2121">&quot;false&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;fieldType</span> <span style="color: #7D9029">name=</span><span style="color: #BA2121">&quot;_bbox_coord&quot;</span> <span style="color: #7D9029">class=</span><span style="color: #BA2121">&quot;solr.TrieDoubleField&quot;</span> <span style="color: #7D9029">precisionStep=</span><span style="color: #BA2121">&quot;8&quot;</span> <span style="color: #7D9029">docValues=</span><span style="color: #BA2121">&quot;true&quot;</span> <span style="color: #7D9029">stored=</span><span style="color: #BA2121">&quot;false&quot;</span><span style="color: #008000; font-weight: bold">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>BBoxField is actually based off of 4 instances of another field type referred to by numberType. It also uses a boolean to flag a dateline cross. Assuming you want to use the relevancy feature, docValues is required. Some of the attributes are in common with the RPT field like geo, units, worldBounds, and spatialContextFactory because they share some of the same spatial infrastructure.</p>
</div>
<div class="paragraph">
<p>To index a box, add a field value to a bbox field that&#8217;s a string in the WKT/CQL ENVELOPE syntax. Example: <code>ENVELOPE(-10, 20, 15, 10)</code> which is minX, maxX, maxY, minY order. The parameter ordering is unintuitive but that&#8217;s what the spec calls for. Alternatively, you could provide a rectangular polygon in WKT (or GeoJSON if you set set <code>format="GeoJSON"</code>).</p>
</div>
<div class="paragraph">
<p>To search, you can use the <code>{!bbox}</code> query parser, or the range syntax e.g. <code>[10,-10 TO 15,20]</code>, or the ENVELOPE syntax wrapped in parenthesis with a leading search predicate. The latter is the only way to choose a predicate other than Intersects. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&amp;q={!field f=bbox}Contains(ENVELOPE(-10, 20, 15, 10))</pre>
</div>
</div>
<div class="paragraph">
<p>Now to sort the results by one of the relevancy modes, use it like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&amp;q={!field f=bbox score=overlapRatio}Intersects(ENVELOPE(-10, 20, 15, 10))</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>score</code> local parameter can be one of <code>overlapRatio</code>, <code>area</code>, and <code>area2D</code>. <code>area</code> scores by the document area using surface-of-a-sphere (assuming <code>geo=true</code>) math, while <code>area2D</code> uses simple width * height. <code>overlapRatio</code> computes a [0-1] ranged score based on how much overlap exists relative to the document&#8217;s area and the query area. The javadocs of <a href="https://lucene.apache.org/core/7_0_0//spatial-extras/org/apache/lucene/spatial/bbox/BBoxOverlapRatioValueSource.html">BBoxOverlapRatioValueSource</a> have more info on the formula. There is an additional parameter <code>queryTargetProportion</code> that allows you to weight the query side of the formula to the index (target) side of the formula. You can also use <code>&amp;debug=results</code> to see useful score computation info.</p>
</div>
</div>
</div>
</div>

<!-- Adds tags, if any -->
    <div class="tags">
        
    </div>

<!-- Adds nav links on each page -->
    
    
    <div class="scrollnav">
      
      <a class="btn btn-primary prev" href="result-clustering.html">Result Clustering</a>
      
      
      <a class="btn btn-primary next" href="the-terms-component.html">The Terms Component</a>
      
    </div>
    

</div>

<!-- Adds comments from Apache's Comment system -->

<div id="comments_thread">
</div>
<script type="text/javascript" src="https://comments.apache.org/show_comments.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=spatial-search" async="true">
</script>
<noscript>
<iframe width="100%" height="500" src="https://comments.apache.org/iframe.lua?site=solrcwiki&style=https://home.apache.org/~ctargett/RefGuidePOC/jekyll/css/comments.css&page=spatial-search"></iframe>
</noscript>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Apache Software Foundation. All rights reserved. <br />
 Site last generated: 2017-04-26 <br />
<p><img src="solr-sunOnly-small.png" alt="Apache Solr"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</div>

</body>

</html>
